(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[131],{WpQk:function(e,n,a){},"dMo/":function(e,n,a){"use strict";var t=a("q1tI"),l=a.n(t),r=a("hKI/"),c=a.n(r);a("WpQk");function o(e,n){return u(e)||m(e,n)||s(e,n)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,n){if(e){if("string"===typeof e)return d(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,n):void 0}}function d(e,n){(null==n||n>e.length)&&(n=e.length);for(var a=0,t=new Array(n);a<n;a++)t[a]=e[a];return t}function m(e,n){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var t,l,r=[],c=!0,o=!1;try{for(a=a.call(e);!(c=(t=a.next()).done);c=!0)if(r.push(t.value),n&&r.length===n)break}catch(i){o=!0,l=i}finally{try{c||null==a["return"]||a["return"]()}finally{if(o)throw l}}return r}}function u(e){if(Array.isArray(e))return e}var p=function(e){var n=e.children,a=Object(t["useRef"])(),r=Object(t["useState"])(!1),i=o(r,2),s=i[0],d=i[1],m=Object(t["useState"])(!1),u=o(m,2),p=u[0],E=u[1];return Object(t["useEffect"])((function(){var e=a.current,n=c()((function(){d(e.scrollLeft>0),E(e.scrollLeft<e.scrollWidth-e.offsetWidth)}),100);return n(),e.addEventListener("scroll",n),window.addEventListener("resize",n),function(){e.removeEventListener("scroll",n),window.removeEventListener("resize",n)}}),[]),l.a.createElement("div",{className:"__dumi-default-table"},l.a.createElement("div",{className:"__dumi-default-table-content",ref:a,"data-left-folded":s||void 0,"data-right-folded":p||void 0},l.a.createElement("table",null,n)))};n["a"]=p},wXpF:function(e,n,a){"use strict";a.r(n);var t=a("q1tI"),l=a.n(t),r=a("dEAq"),c=a("H1Ra"),o=a("dMo/"),i=l.a.memo((e=>{e.demos;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("h1",{id:"\u6155\u8bfe---docker\u5165\u95e8"},l.a.createElement(r["AnchorLink"],{to:"#\u6155\u8bfe---docker\u5165\u95e8","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6155\u8bfe - Docker\u5165\u95e8"),l.a.createElement("h2",{id:"11-\u5bb9\u5668\u6280\u672f\u4ecb\u7ecd"},l.a.createElement(r["AnchorLink"],{to:"#11-\u5bb9\u5668\u6280\u672f\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1.1 \u5bb9\u5668\u6280\u672f\u4ecb\u7ecd"),l.a.createElement("blockquote",null,l.a.createElement("p",null,"Note:"),l.a.createElement("p",null,"\u6ce8\u610f\u6211\u4eec\u8fd9\u91cc\u6240\u8bf4\u7684\u5bb9\u5668 container \u662f\u6307\u7684\u4e00\u79cd\u6280\u672f\uff0c\u800c Docker \u53ea\u662f\u4e2a\u5bb9\u5668\u6280\u672f\u7684\u5b9e\u73b0\uff0c\u6216\u8005\u8bf4\u8ba9\u5bb9\u5668\u6280\u672f\u666e\u53ca\u5f00\u6765\u7684\u6700\u6210\u529f\u7684\u5b9e\u73b0")),l.a.createElement("h3",{id:"\u4ec0\u4e48\u662fcontainer\u5bb9\u5668"},l.a.createElement(r["AnchorLink"],{to:"#\u4ec0\u4e48\u662fcontainer\u5bb9\u5668","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u4ec0\u4e48\u662fContainer(\u5bb9\u5668)?"),l.a.createElement("p",null,"\u5bb9\u5668\u662f\u4e00\u79cd\u5feb\u901f\u7684\u6253\u5305\u6280\u672f"),l.a.createElement("p",null,"Package Software into Standardized Units for  Development, Shipment and Deployment"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u6807\u51c6\u5316"),l.a.createElement("li",null,"\u8f7b\u91cf\u7ea7"),l.a.createElement("li",null,"\u6613\u79fb\u690d")),l.a.createElement("p",null,'Linux Container \u5bb9\u5668\u6280\u672f\u7684\u751f\uff082008 \u5e74\uff09\u5c31\u89e3\u51b3\u4e86 IT \u4e16\u754c\u91cc"\u96c6\u88c5\u7bb1\u8fd0\u8f93"\u7684\u9898\u3002Linux Container\uff08\u7b80\u79f0 LXC\uff09\u5b83\u662f\u4e00\u79cd\u5185\u6838\u8f7b\u91cf\u7ea7\u7684\u64cd\u4f5c\u7cfb\u7edf\u5c42\u865a\u62df\u5316\u6280\u672f\u3002Linux Container \u4e3b\u8981\u7531 Namespace \u548c Cgroups \u4e24\u5927\u673a\u5236\u6765\u4fdd\u8bc1\u5b9e\u73b0'),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"Namespace \u547d\u540d\u7a7a\u95f4\u4e3b\u8981\u7528\u4e8e\u8d44\u6e90\u7684\u9694\u79bb")),l.a.createElement("li",null,l.a.createElement("p",null,"Cgroup\u5c31\u8d1f\u8d23\u8d44\u6e90\u7ba1\u7406\u63a7\u5236\u4f5c\u7528, \u6bd4\u5982\u8fdb\u7a0b\u7ec4\u4f7f\u7528 CPU/MEM\u7684\u9650\u5236,\u8fdb\u7a0b\u7ec4\u7684\u4f18\u5148\u7ea7\u63a7\u5236\uff0c\u8fdb\u7a0b\u7ec4\u7684\u6302\u8d77\u548c\u6062\u590d\u7b49\u3002"))),l.a.createElement("h3",{id:"\u5bb9\u5668\u7684\u5feb\u901f\u53d1\u5c55\u548c\u666e\u53ca"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u7684\u5feb\u901f\u53d1\u5c55\u548c\u666e\u53ca","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u7684\u5feb\u901f\u53d1\u5c55\u548c\u666e\u53ca"),l.a.createElement("h3",{id:"\u5bb9\u5668\u7684\u6807\u51c6\u5316"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u7684\u6807\u51c6\u5316","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u7684\u6807\u51c6\u5316"),l.a.createElement("p",null,l.a.createElement("code",null,"docker != container")),l.a.createElement("p",null,"\u5728 2015 \u5e74\uff0c\u7531 Google, Docker\u3001\u7ea2\u5e3d\u7b49\u5382\u5546\u8054\u5408\u53d1\u8d77\u4e86OCI (Open Container Initiative\uff09\u7ec4\u7ec7\uff0c\u81f4\u529b\u4e8e\u5bb9\u5668\u6280\u672f\u7684\u6807\u51c6\u5316"),l.a.createElement("h4",{id:"\u5bb9\u5668\u8fd0\u884c\u65f6\u6807\u51c6runtime-spec"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u8fd0\u884c\u65f6\u6807\u51c6runtime-spec","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u8fd0\u884c\u65f6\u6807\u51c6\uff08runtime spec)"),l.a.createElement("p",null,"\u7b80\u5355\u6765\u8bb2\u5c31\u662f\u89c4\u5b9a\u4e86\u5bb9\u5668\u7684\u57fa\u672c\u64cd\u4f5c\u89c4\u8303\uff0c\u6bd4\u5982\u5982\u4f55\u4e0b\u8f09\u955c\u50cf\uff0c\u521b\u5efa\u5bb9\u5668\u5de5\u542f\u52a8\u5bb9\u5668\u7b49\u3002##"),l.a.createElement("h4",{id:"\u5bb9\u5668\u955c\u50cf\u6807\u51c6image-spec"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u955c\u50cf\u6807\u51c6image-spec","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u955c\u50cf\u6807\u51c6\uff08Image spec)"),l.a.createElement("p",null,"\u4e3b\u8981\u5b9a\u4e49\u955c\u50cf\u7684\u57fa\u672c\u683c\u5f0f\u3002"),l.a.createElement("h3",{id:"\u5bb9\u5668\u662f\u5173\u4e4e\u901f\u5ea6"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u662f\u5173\u4e4e\u901f\u5ea6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u662f\u5173\u4e4e\u901f\u5ea6"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5bb9\u5668\u4f1a\u52a0\u901f\u4f60\u7684\u8f6f\u4ef6\u5f00\u53d1"),l.a.createElement("li",null,"\u5bb9\u5668\u4f1a\u52a0\u901f\u4f60\u7684\u7a0b\u5e8f\u7f16\u8bd1\u548c\u6784\u5efa"),l.a.createElement("li",null,"\u5bb9\u5668\u4f1a\u52a0\u901f\u4f60\u7684\u6d4b\u8bd5"),l.a.createElement("li",null,"\u5bb9\u5668\u4f1a\u901f\u5ea6\u4f60\u7684\u90e8\u7f72"),l.a.createElement("li",null,"\u5bb9\u5668\u4f1a\u52a0\u901f\u4f60\u7684\u66f4\u65b0"),l.a.createElement("li",null,"\u5bb9\u5668\u4f1a\u901f\u5ea6\u4f60\u7684\u6545\u969c\u6062\u590d")),l.a.createElement("h1",{id:"2-\u5bb9\u5668\u5feb\u901f\u4e0a\u624b"},l.a.createElement(r["AnchorLink"],{to:"#2-\u5bb9\u5668\u5feb\u901f\u4e0a\u624b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2. \u5bb9\u5668\u5feb\u901f\u4e0a\u624b"),l.a.createElement("h2",{id:"21-docker-cli-\u547d\u4ee4\u884c\u4ecb\u7ecd"},l.a.createElement(r["AnchorLink"],{to:"#21-docker-cli-\u547d\u4ee4\u884c\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.1. Docker CLI \u547d\u4ee4\u884c\u4ecb\u7ecd"),l.a.createElement("ul",null,l.a.createElement("li",null,"docker version - \u67e5\u770bdocker\u7684\u7248\u672c\u53f7")),l.a.createElement("p",null,"docker + \u7ba1\u7406\u7684\u5bf9\u8c61\uff08\u6bd4\u5982\u5bb9\u5668\uff0c\u955c\u50cf\uff09 + \u5177\u4f53\u64cd\u4f5c\uff08\u6bd4\u5982\u521b\u5efa\uff0c\u542f\u52a8\uff0c\u505c\u6b62\uff0c\u5220\u9664\uff09"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"docker image pull nginx")," \u62c9\u53d6\u4e00\u4e2a\u53eb nginx \u7684 docker image \u955c\u50cf"),l.a.createElement("li",null,l.a.createElement("code",null,"docker container stop web")," \u505c\u6b62\u4e00\u4e2a\u53ebweb\u7684docker container\u5bb9\u5668")),l.a.createElement("h2",{id:"22-image-vs-container-\u955c\u50cf-vs-\u5bb9\u5668"},l.a.createElement(r["AnchorLink"],{to:"#22-image-vs-container-\u955c\u50cf-vs-\u5bb9\u5668","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.2 Image vs Container \u955c\u50cf vs \u5bb9\u5668"),l.a.createElement("h3",{id:"image-\u955c\u50cf"},l.a.createElement(r["AnchorLink"],{to:"#image-\u955c\u50cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"image \u955c\u50cf"),l.a.createElement("ul",null,l.a.createElement("li",null,"Docker image\u662f\u4e00\u4e2a ",l.a.createElement("code",null,"read-only")," \u6587\u4ef6"),l.a.createElement("li",null,"\u8fd9\u4e2a\u6587\u4ef6\u5305\u542b\u6587\u4ef6\u7cfb\u7edf\uff0c\u6e90\u7801\uff0c\u5e93\u6587\u4ef6\uff0c\u4f9d\u8d56\uff0c\u5de5\u5177\u7b49\u4e00\u4e9b\u8fd0\u884capplication\u6240\u9700\u8981\u7684\u6587\u4ef6"),l.a.createElement("li",null,"\u53ef\u4ee5\u7406\u89e3\u6210\u4e00\u4e2a\u6a21\u677f"),l.a.createElement("li",null,"docker image\u5177\u6709\u5206\u5c42\u7684\u6982\u5ff5")),l.a.createElement("h3",{id:"container\u5bb9\u5668"},l.a.createElement(r["AnchorLink"],{to:"#container\u5bb9\u5668","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"container\u5bb9\u5668"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u201c\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684docker image\u201d"),l.a.createElement("li",null,"\u5b9e\u8d28\u662f\u590d\u5236image\u5e76\u5728image\u6700\u4e0a\u5c42\u52a0\u4e0a\u4e00\u5c42 ",l.a.createElement("code",null,"read-write")," \u7684\u5c42 \uff08\u79f0\u4e4b\u4e3a ",l.a.createElement("code",null,"container layer")," ,\u5bb9\u5668\u5c42\uff09"),l.a.createElement("li",null,"\u57fa\u4e8e\u540c\u4e00\u4e2aimage\u53ef\u4ee5\u521b\u5efa\u591a\u4e2acontainer")),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-13-133509.png",alt:"docker-image-vs-container"})),l.a.createElement("h3",{id:"docker-image\u7684\u83b7\u53d6"},l.a.createElement(r["AnchorLink"],{to:"#docker-image\u7684\u83b7\u53d6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"docker image\u7684\u83b7\u53d6"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u81ea\u5df1\u5236\u4f5c"),l.a.createElement("li",null,"\u4eceregistry\u62c9\u53d6\uff08\u6bd4\u5982docker hub\uff09")),l.a.createElement("h2",{id:"23-\u5bb9\u5668\u7684\u57fa\u672c\u64cd\u4f5c"},l.a.createElement(r["AnchorLink"],{to:"#23-\u5bb9\u5668\u7684\u57fa\u672c\u64cd\u4f5c","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.3 \u5bb9\u5668\u7684\u57fa\u672c\u64cd\u4f5c"),l.a.createElement(o["a"],null,l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"\u64cd\u4f5c"),l.a.createElement("th",null,"\u547d\u4ee4(\u5168)"),l.a.createElement("th",null,"\u547d\u4ee4(\u7b80)"))),l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"\u5bb9\u5668\u7684\u521b\u5efa"),l.a.createElement("td",null,"docker container run ",l.a.createElement("code",null,"<image name>")),l.a.createElement("td",null,"docker run ",l.a.createElement("code",null,"<image name>"))),l.a.createElement("tr",null,l.a.createElement("td",null,"\u5bb9\u5668\u7684\u5217\u51fa(up)"),l.a.createElement("td",null,"docker container ls"),l.a.createElement("td",null,"docker ps")),l.a.createElement("tr",null,l.a.createElement("td",null,"\u5bb9\u5668\u7684\u5217\u51fa(up\u548cexit)"),l.a.createElement("td",null,"docker container ls -a"),l.a.createElement("td",null,"docker ps -a")),l.a.createElement("tr",null,l.a.createElement("td",null,"\u5bb9\u5668\u7684\u505c\u6b62"),l.a.createElement("td",null,"docker container stop ",l.a.createElement("code",null,"<name or ID>")),l.a.createElement("td",null,"docker stop ",l.a.createElement("code",null,"<container name or ID>"))),l.a.createElement("tr",null,l.a.createElement("td",null,"\u5bb9\u5668\u7684\u5220\u9664"),l.a.createElement("td",null,"docker container rm ",l.a.createElement("code",null,"<name or ID>")),l.a.createElement("td",null,"docker rm ",l.a.createElement("code",null,"<container name or ID>"))))),l.a.createElement("h2",{id:"24-docker-container-\u547d\u4ee4\u5c0f\u6280\u5de7"},l.a.createElement(r["AnchorLink"],{to:"#24-docker-container-\u547d\u4ee4\u5c0f\u6280\u5de7","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.4 docker container \u547d\u4ee4\u5c0f\u6280\u5de7"),l.a.createElement("h3",{id:"\u6279\u91cf\u505c\u6b62"},l.a.createElement(r["AnchorLink"],{to:"#\u6279\u91cf\u505c\u6b62","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6279\u91cf\u505c\u6b62"),l.a.createElement(c["a"],{code:'$ docker container ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES\ncd3a825fedeb   nginx     "/docker-entrypoint.\u2026"   7 seconds ago    Up 6 seconds    80/tcp    mystifying_leakey\n269494fe89fa   nginx     "/docker-entrypoint.\u2026"   9 seconds ago    Up 8 seconds    80/tcp    funny_gauss\n34b68af9deef   nginx     "/docker-entrypoint.\u2026"   12 seconds ago   Up 10 seconds   80/tcp    interesting_mahavira\n7513949674fc   nginx     "/docker-entrypoint.\u2026"   13 seconds ago   Up 12 seconds   80/tcp    kind_nobel',lang:"shell"}),l.a.createElement("p",null,"\u65b9\u6cd51"),l.a.createElement(c["a"],{code:"$ docker container rm cd3 269 34b 751",lang:"shell"}),l.a.createElement("p",null,"\u65b9\u6cd52"),l.a.createElement(c["a"],{code:'$ docker container stop $(docker container ps -q)\ncd3a825fedeb\n269494fe89fa\n34b68af9deef\n7513949674fc\n$ docker container ps -a\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES\ncd3a825fedeb   nginx     "/docker-entrypoint.\u2026"   30 seconds ago   Exited (0) 2 seconds ago             mystifying_leakey\n269494fe89fa   nginx     "/docker-entrypoint.\u2026"   32 seconds ago   Exited (0) 2 seconds ago             funny_gauss\n34b68af9deef   nginx     "/docker-entrypoint.\u2026"   35 seconds ago   Exited (0) 2 seconds ago             interesting_mahavira\n7513949674fc   nginx     "/docker-entrypoint.\u2026"   36 seconds ago   Exited (0) 2 seconds ago             kind_nobel\n$',lang:"shell"}),l.a.createElement("h3",{id:"\u6279\u91cf\u5220\u9664"},l.a.createElement(r["AnchorLink"],{to:"#\u6279\u91cf\u5220\u9664","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6279\u91cf\u5220\u9664"),l.a.createElement("p",null,"\u548c\u6279\u91cf\u505c\u6b62\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u4f7f\u7528 ",l.a.createElement("code",null,"docker container rm $(docker container ps -aq)")),l.a.createElement("blockquote",null,l.a.createElement("p",null,"Note"),l.a.createElement("p",null,l.a.createElement("code",null,"docker system prune -a -f")," \u53ef\u4ee5\u5feb\u901f\u5bf9\u7cfb\u7edf\u8fdb\u884c\u6e05\u7406\uff0c\u5220\u9664\u505c\u6b62\u7684\u5bb9\u5668\uff0c\u4e0d\u7528\u7684image\uff0c\u7b49\u7b49")),l.a.createElement("h2",{id:"25-\u8fde\u63a5\u5bb9\u5668\u7684-shell"},l.a.createElement(r["AnchorLink"],{to:"#25-\u8fde\u63a5\u5bb9\u5668\u7684-shell","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.5 \u8fde\u63a5\u5bb9\u5668\u7684 shell"),l.a.createElement("p",null,l.a.createElement("code",null,"docker container run -it")," \u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u5e76\u8fdb\u5165\u4ea4\u4e92\u5f0f\u6a21\u5f0f"),l.a.createElement(c["a"],{code:"\u279c  ~ docker container run -it busybox sh\n/ #\n/ #\n/ # ls\nbin   dev   etc   home  proc  root  sys   tmp   usr   var\n/ # ps\nPID   USER     TIME  COMMAND\n    1 root      0:00 sh\n    8 root      0:00 ps\n/ # exit",lang:"shell"}),l.a.createElement("p",null,l.a.createElement("code",null,"docker container exec -it")," \u5728\u4e00\u4e2a\u5df2\u7ecf\u8fd0\u884c\u7684\u5bb9\u5668\u91cc\u6267\u884c\u4e00\u4e2a\u989d\u5916\u7684command"),l.a.createElement(c["a"],{code:"\u279c  ~ docker container run -d nginx\n33d2ee50cfc46b5ee0b290f6ad75d724551be50217f691e68d15722328f11ef6\n\u279c  ~\n\u279c  ~ docker container exec -it 33d sh\n#\n#\n# ls\nbin  boot  dev  docker-entrypoint.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n#\n# exit\n\u279c  ~",lang:"shell"}),l.a.createElement("h2",{id:"26-\u5bb9\u5668\u548c\u865a\u62df\u673a-container-vs-vm"},l.a.createElement(r["AnchorLink"],{to:"#26-\u5bb9\u5668\u548c\u865a\u62df\u673a-container-vs-vm","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.6 \u5bb9\u5668\u548c\u865a\u62df\u673a Container vs VM"),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-13-134724.jpg",alt:"docker-vs-vm"})),l.a.createElement("h3",{id:"\u5bb9\u5668\u4e0d\u662fmini\u865a\u62df\u673a"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u4e0d\u662fmini\u865a\u62df\u673a","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u4e0d\u662fMini\u865a\u62df\u673a"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5bb9\u5668\u5176\u5b9e\u662f\u8fdb\u7a0bContainers are just processes"),l.a.createElement("li",null,"\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u88ab\u9650\u5236\u4e86\u5bf9CPU\u5185\u5b58\u7b49\u8d44\u6e90\u7684\u8bbf\u95ee"),l.a.createElement("li",null,"\u5f53\u8fdb\u7a0b\u505c\u6b62\u540e\uff0c\u5bb9\u5668\u5c31\u9000\u51fa\u4e86")),l.a.createElement("h3",{id:"\u5bb9\u5668\u7684\u8fdb\u7a0bprocess"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u7684\u8fdb\u7a0bprocess","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u7684\u8fdb\u7a0bprocess"),l.a.createElement("h2",{id:"27-docker-container-run-\u80cc\u540e\u53d1\u751f\u4e86\u4ec0\u4e48"},l.a.createElement(r["AnchorLink"],{to:"#27-docker-container-run-\u80cc\u540e\u53d1\u751f\u4e86\u4ec0\u4e48","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.7 docker container run \u80cc\u540e\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f"),l.a.createElement(c["a"],{code:"$ docker container run -d --publish 80:80 --name webhost nginx",lang:"shell"}),l.a.createElement("ol",null,l.a.createElement("li",null,"\u5728\u672c\u5730\u67e5\u627e\u662f\u5426\u6709nginx\u8fd9\u4e2aimage\u955c\u50cf\uff0c\u4f46\u662f\u6ca1\u6709\u53d1\u73b0"),l.a.createElement("li",null,"\u53bb\u8fdc\u7a0b\u7684image registry\u67e5\u627enginx\u955c\u50cf\uff08\u9ed8\u8ba4\u7684registry\u662fDocker Hub)"),l.a.createElement("li",null,"\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684nginx\u955c\u50cf \uff08nginx:latest \u9ed8\u8ba4)"),l.a.createElement("li",null,"\u57fa\u4e8enginx\u955c\u50cf\u6765\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bb9\u5668\uff0c\u5e76\u4e14\u51c6\u5907\u8fd0\u884c"),l.a.createElement("li",null,"docker engine\u5206\u914d\u7ed9\u8fd9\u4e2a\u5bb9\u5668\u4e00\u4e2a\u865a\u62dfIP\u5730\u5740"),l.a.createElement("li",null,"\u5728\u5bbf\u4e3b\u673a\u4e0a\u6253\u5f0080\u7aef\u53e3\u5e76\u628a\u5bb9\u5668\u768480\u7aef\u53e3\u8f6c\u53d1\u5230\u5bbf\u4e3b\u673a\u4e0a"),l.a.createElement("li",null,"\u542f\u52a8\u5bb9\u5668\uff0c\u8fd0\u884c\u6307\u5b9a\u7684\u547d\u4ee4\uff08\u8fd9\u91cc\u662f\u4e00\u4e2ashell\u811a\u672c\u53bb\u542f\u52a8nginx\uff09")),l.a.createElement("h1",{id:"3-\u955c\u50cf\u7684\u521b\u5efa\u7ba1\u7406\u548c\u53d1\u5e03"},l.a.createElement(r["AnchorLink"],{to:"#3-\u955c\u50cf\u7684\u521b\u5efa\u7ba1\u7406\u548c\u53d1\u5e03","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3. \u955c\u50cf\u7684\u521b\u5efa\u7ba1\u7406\u548c\u53d1\u5e03"),l.a.createElement("h2",{id:"31-\u955c\u50cf\u7684\u83b7\u53d6"},l.a.createElement(r["AnchorLink"],{to:"#31-\u955c\u50cf\u7684\u83b7\u53d6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3.1. \u955c\u50cf\u7684\u83b7\u53d6"),l.a.createElement("ul",null,l.a.createElement("li",null,"pull from ",l.a.createElement("code",null,"registry")," (online) \u4eceregistry\u62c9\u53d6",l.a.createElement("ul",null,l.a.createElement("li",null,"public\uff08\u516c\u6709\uff09"),l.a.createElement("li",null,"private\uff08\u79c1\u6709\uff09"))),l.a.createElement("li",null,"build from ",l.a.createElement("code",null,"Dockerfile")," (online) \u4eceDockerfile\u6784\u5efa"),l.a.createElement("li",null,"load from ",l.a.createElement("code",null,"file")," (offline) \u6587\u4ef6\u5bfc\u5165 \uff08\u79bb\u7ebf\uff09")),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-13-135640.png",alt:"docker-image"})),l.a.createElement("h2",{id:"32-\u955c\u50cf\u7684\u57fa\u672c\u64cd\u4f5c"},l.a.createElement(r["AnchorLink"],{to:"#32-\u955c\u50cf\u7684\u57fa\u672c\u64cd\u4f5c","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3.2 \u955c\u50cf\u7684\u57fa\u672c\u64cd\u4f5c"),l.a.createElement(c["a"],{code:"$ docker image\n\nUsage:  docker image COMMAND\n\nManage images\n\nCommands:\nbuild       Build an image from a Dockerfile\nhistory     Show the history of an image\nimport      Import the contents from a tarball to create a filesystem image\ninspect     Display detailed information on one or more images\nload        Load an image from a tar archive or STDIN\nls          List images\nprune       Remove unused images\npull        Pull an image or a repository from a registry\npush        Push an image or a repository to a registry\nrm          Remove one or more images\nsave        Save one or more images to a tar archive (streamed to STDOUT by default)\ntag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE\n\nRun 'docker image COMMAND --help' for more information on a command.",lang:"shell"}),l.a.createElement("h3",{id:"\u955c\u50cf\u7684\u62c9\u53d6-pull-image"},l.a.createElement(r["AnchorLink"],{to:"#\u955c\u50cf\u7684\u62c9\u53d6-pull-image","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u955c\u50cf\u7684\u62c9\u53d6 Pull Image"),l.a.createElement("p",null,"\u9ed8\u8ba4\u4eceDocker Hub\u62c9\u53d6\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u7248\u672c\uff0c\u4f1a\u62c9\u53d6\u6700\u65b0\u7248"),l.a.createElement(c["a"],{code:"$ docker pull nginx\nUsing default tag: latest\nlatest: Pulling from library/nginx\n69692152171a: Pull complete\n49f7d34d62c1: Pull complete\n5f97dc5d71ab: Pull complete\ncfcd0711b93a: Pull complete\nbe6172d7651b: Pull complete\nde9813870342: Pull complete\nDigest: sha256:df13abe416e37eb3db4722840dd479b00ba193ac6606e7902331dcea50f4f1f2\nStatus: Downloaded newer image for nginx:latest\ndocker.io/library/nginx:latest",lang:"shell"}),l.a.createElement("p",null,"\u6307\u5b9a\u7248\u672c"),l.a.createElement(c["a"],{code:"$ docker pull nginx:1.20.0\n1.20.0: Pulling from library/nginx\n69692152171a: Already exists\n965615a5cec8: Pull complete\nb141b026b9ce: Pull complete\n8d70dc384fb3: Pull complete\n525e372d6dee: Pull complete\nDigest: sha256:ea4560b87ff03479670d15df426f7d02e30cb6340dcd3004cdfc048d6a1d54b4\nStatus: Downloaded newer image for nginx:1.20.0\ndocker.io/library/nginx:1.20.0",lang:"shell"}),l.a.createElement("p",null,"\u4eceQuay\u4e0a\u62c9\u53d6\u955c\u50cf"),l.a.createElement(c["a"],{code:"$ docker pull quay.io/bitnami/nginx\nUsing default tag: latest\nlatest: Pulling from bitnami/nginx\n2e6370f1e2d3: Pull complete\n2d464c695e97: Pull complete\n83eb3b1671f4: Pull complete\n364c139450f9: Pull complete\ndc453d5ae92e: Pull complete\n09bd59934b83: Pull complete\n8d2bd62eedfb: Pull complete\n8ac060ae1ede: Pull complete\nc7c9bc2f4f9d: Pull complete\n6dd7098b85fa: Pull complete\n894a70299d18: Pull complete\nDigest: sha256:d143befa04e503472603190da62db157383797d281fb04e6a72c85b48e0b3239\nStatus: Downloaded newer image for quay.io/bitnami/nginx:latest\nquay.io/bitnami/nginx:latest",lang:"shell"}),l.a.createElement("h3",{id:"\u955c\u50cf\u67e5\u770b"},l.a.createElement(r["AnchorLink"],{to:"#\u955c\u50cf\u67e5\u770b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u955c\u50cf\u67e5\u770b"),l.a.createElement(c["a"],{code:"$ docker image ls\nREPOSITORY              TAG       IMAGE ID       CREATED       SIZE\nquay.io/bitnami/nginx   latest    0922eabe1625   6 hours ago   89.3MB\nnginx                   1.20.0    7ab27dbbfbdf   10 days ago   133MB\nnginx                   latest    f0b8a9a54136   10 days ago   133MB",lang:"shell"}),l.a.createElement("h3",{id:"\u955c\u50cf\u7684\u5220\u9664"},l.a.createElement(r["AnchorLink"],{to:"#\u955c\u50cf\u7684\u5220\u9664","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u955c\u50cf\u7684\u5220\u9664"),l.a.createElement(c["a"],{code:"$ docker image rm 0922eabe1625\nUntagged: quay.io/bitnami/nginx:latest\nUntagged:quay.io/bitnami/nginx@sha256:d143befa04e503472603190da62db157383797d281fb04e6a72c85b48e0b3239\nDeleted: sha256:0922eabe16250e2f4711146e31b7aac0e547f52daa6cf01c9d00cf64d49c68c8\nDeleted: sha256:5eee4ed0f6b242e2c6e4f4066c7aca26bf9b3b021b511b56a0dadd52610606bd\nDeleted: sha256:472a75325eda417558f9100ff8b4a97f4a5e8586a14eb9c8fc12f944b26a21f8\nDeleted: sha256:cdcb5872f8a64a0b5839711fcd2a87ba05795e5bf6a70ba9510b8066cdd25e76\nDeleted: sha256:e0f1b7345a521469bbeb7ec53ef98227bd38c87efa19855c5ba0db0ac25c8e83\nDeleted: sha256:11b9c2261cfc687fba8d300b83434854cc01e91a2f8b1c21dadd937e59290c99\nDeleted: sha256:4819311ec2867ad82d017253500be1148fc335ad13b6c1eb6875154da582fcf2\nDeleted: sha256:784480add553b8e8d5ee1bbd229ed8be92099e5fb61009ed7398b93d5705a560\nDeleted: sha256:e0c520d1a43832d5d2b1028e3f57047f9d9f71078c0187f4bb05e6a6a572993d\nDeleted: sha256:94d5b1d6c9e31de42ce58b8ce51eb6fb5292ec889a6d95763ad2905330b92762\nDeleted: sha256:95deba55c490bbb8de44551d3e6a89704758c93ba8503a593cb7c07dfbae0058\nDeleted: sha256:1ad1d903ef1def850cd44e2010b46542196e5f91e53317dbdb2c1eedfc2d770c",lang:"shell"}),l.a.createElement("h2",{id:"33-\u5173\u4e8e-scratch-\u955c\u50cf"},l.a.createElement(r["AnchorLink"],{to:"#33-\u5173\u4e8e-scratch-\u955c\u50cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3.3 \u5173\u4e8e scratch \u955c\u50cf"),l.a.createElement("p",null,"Scratch\u662f\u4e00\u4e2a\u7a7a\u7684Docker\u955c\u50cf\u3002"),l.a.createElement("p",null,"\u901a\u8fc7scratch\u6765\u6784\u5efa\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\u3002"),l.a.createElement(c["a"],{code:'hello.c\n#include <stdio.h>\nint main()\n{\n    printf("hello docker\\n");\n}',lang:"unknown"}),l.a.createElement("p",null,"\u7f16\u8bd1\u6210\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6"),l.a.createElement(c["a"],{code:"$ gcc --static -o hello hello.c\n$ ./hello\nhello docker\n$",lang:"shell"}),l.a.createElement(c["a"],{code:"Dockerfile",lang:"unknown"}),l.a.createElement(c["a"],{code:'FROM scratch\nADD hello /\nCMD ["/hello"]',lang:"shell"}),l.a.createElement("p",null,"\u6784\u5efa"),l.a.createElement(c["a"],{code:"$ docker build -t hello .\n$ docker image ls\nREPOSITORY   TAG       IMAGE ID       CREATED          SIZE\nhello        latest    2936e77a9daa   40 minutes ago   872kB",lang:"shell"}),l.a.createElement("p",null,"\u8fd0\u884c"),l.a.createElement(c["a"],{code:"$ docker container run -it hello\nhello docker",lang:"shell"}),l.a.createElement("h1",{id:"4-dockerfile\u5b8c\u5168\u6307\u5357"},l.a.createElement(r["AnchorLink"],{to:"#4-dockerfile\u5b8c\u5168\u6307\u5357","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4. Dockerfile\u5b8c\u5168\u6307\u5357"),l.a.createElement("h2",{id:"41-\u57fa\u7840\u955c\u50cf\u7684\u9009\u62e9from"},l.a.createElement(r["AnchorLink"],{to:"#41-\u57fa\u7840\u955c\u50cf\u7684\u9009\u62e9from","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.1 \u57fa\u7840\u955c\u50cf\u7684\u9009\u62e9\uff08FROM\uff09"),l.a.createElement("h3",{id:"\u57fa\u672c\u539f\u5219"},l.a.createElement(r["AnchorLink"],{to:"#\u57fa\u672c\u539f\u5219","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u57fa\u672c\u539f\u5219"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5b98\u65b9\u955c\u50cf\u4f18\u4e8e\u975e\u5b98\u65b9\u7684\u955c\u50cf\uff0c\u5982\u679c\u6ca1\u6709\u5b98\u65b9\u955c\u50cf\uff0c\u5219\u5c3d\u91cf\u9009\u62e9Dockerfile\u5f00\u6e90\u7684"),l.a.createElement("li",null,"\u56fa\u5b9a\u7248\u672ctag\u800c\u4e0d\u662f\u6bcf\u6b21\u90fd\u4f7f\u7528latest"),l.a.createElement("li",null,"\u5c3d\u91cf\u9009\u62e9\u4f53\u79ef\u5c0f\u7684\u955c\u50cf")),l.a.createElement(c["a"],{code:"$ docker image ls\nREPOSITORY      TAG             IMAGE ID       CREATED          SIZE\nbitnami/nginx   1.18.0          dfe237636dde   28 minutes ago   89.3MB\nnginx           1.21.0-alpine   a6eb2a334a9f   2 days ago       22.6MB\nnginx           1.21.0          d1a364dc548d   2 days ago       133MB",lang:"shell"}),l.a.createElement("h3",{id:"build\u4e00\u4e2anginx\u955c\u50cf"},l.a.createElement(r["AnchorLink"],{to:"#build\u4e00\u4e2anginx\u955c\u50cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Build\u4e00\u4e2aNginx\u955c\u50cf"),l.a.createElement("p",null,"\u5047\u5982\u6211\u4eec\u6709\u4e00\u4e2a ",l.a.createElement("code",null,"index.html")," \u6587\u4ef6"),l.a.createElement(c["a"],{code:"<h1>Hello Docker</h1>",lang:"html"}),l.a.createElement("p",null,"\u51c6\u5907\u4e00\u4e2aDockerfile"),l.a.createElement(c["a"],{code:"FROM nginx:1.21.0-alpine\n\nADD index.html /usr/share/nginx/html/index.html",lang:"dockerfile"}),l.a.createElement("h2",{id:"42-\u901a\u8fc7-run-\u6267\u884c\u6307\u4ee4"},l.a.createElement(r["AnchorLink"],{to:"#42-\u901a\u8fc7-run-\u6267\u884c\u6307\u4ee4","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.2 \u901a\u8fc7 RUN \u6267\u884c\u6307\u4ee4"),l.a.createElement("p",null,l.a.createElement("code",null,"RUN")," \u4e3b\u8981\u7528\u4e8e\u5728Image\u91cc\u6267\u884c\u6307\u4ee4\uff0c\u6bd4\u5982\u5b89\u88c5\u8f6f\u4ef6\uff0c\u4e0b\u8f7d\u6587\u4ef6\u7b49\u3002"),l.a.createElement(c["a"],{code:"$ apt-get update\n$ apt-get install wget\n$ wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz\n$ tar zxf ipinfo_2.0.1_linux_amd64.tar.gz\n$ mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo\n$ rm -rf ipinfo_2.0.1_linux_amd64.tar.gz",lang:"shell"}),l.a.createElement("h3",{id:"dockerfile"},l.a.createElement(r["AnchorLink"],{to:"#dockerfile","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Dockerfile"),l.a.createElement(c["a"],{code:"FROM ubuntu:21.04\nRUN apt-get update\nRUN apt-get install -y wget\nRUN wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz\nRUN tar zxf ipinfo_2.0.1_linux_amd64.tar.gz\nRUN mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo\nRUN rm -rf ipinfo_2.0.1_linux_amd64.tar.gz",lang:"dockerfile"}),l.a.createElement("p",null,"\u955c\u50cf\u7684\u5927\u5c0f\u548c\u5206\u5c42"),l.a.createElement(c["a"],{code:'$ docker image ls\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\nipinfo       latest    97bb429363fb   4 minutes ago   138MB\nubuntu       21.04     478aa0080b60   4 days ago      74.1MB\n$ docker image history 97b\nIMAGE          CREATED         CREATED BY                                      SIZE      COMMENT\n97bb429363fb   4 minutes ago   RUN /bin/sh -c rm -rf ipinfo_2.0.1_linux_amd\u2026   0B        buildkit.dockerfile.v0\n<missing>      4 minutes ago   RUN /bin/sh -c mv ipinfo_2.0.1_linux_amd64 /\u2026   9.36MB    buildkit.dockerfile.v0\n<missing>      4 minutes ago   RUN /bin/sh -c tar zxf ipinfo_2.0.1_linux_am\u2026   9.36MB    buildkit.dockerfile.v0\n<missing>      4 minutes ago   RUN /bin/sh -c wget https://github.com/ipinf\u2026   4.85MB    buildkit.dockerfile.v0\n<missing>      4 minutes ago   RUN /bin/sh -c apt-get install -y wget # bui\u2026   7.58MB    buildkit.dockerfile.v0\n<missing>      4 minutes ago   RUN /bin/sh -c apt-get update # buildkit        33MB      buildkit.dockerfile.v0\n<missing>      4 days ago      /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B\n<missing>      4 days ago      /bin/sh -c mkdir -p /run/systemd && echo \'do\u2026   7B\n<missing>      4 days ago      /bin/sh -c [ -z "$(apt-get indextargets)" ]     0B\n<missing>      4 days ago      /bin/sh -c set -xe   && echo \'#!/bin/sh\' > /\u2026   811B\n<missing>      4 days ago      /bin/sh -c #(nop) ADD file:d6b6ba642344138dc\u2026   74.1MB',lang:"shell"}),l.a.createElement("p",null,"\u6bcf\u4e00\u884c\u7684RUN\u547d\u4ee4\u90fd\u4f1a\u4ea7\u751f\u4e00\u5c42image layer, \u5bfc\u81f4\u955c\u50cf\u7684\u81c3\u80bf\u3002"),l.a.createElement("h3",{id:"\u6539\u8fdb\u7248dockerfile"},l.a.createElement(r["AnchorLink"],{to:"#\u6539\u8fdb\u7248dockerfile","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6539\u8fdb\u7248Dockerfile"),l.a.createElement(c["a"],{code:"FROM ubuntu:21.04\nRUN apt-get update && \\\n    apt-get install -y wget && \\\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz && \\\n    tar zxf ipinfo_2.0.1_linux_amd64.tar.gz && \\\n    mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo && \\\n    rm -rf ipinfo_2.0.1_linux_amd64.tar.gz",lang:"dockerfile"}),l.a.createElement(c["a"],{code:'$ docker image ls\nREPOSITORY   TAG       IMAGE ID       CREATED          SIZE\nipinfo-new   latest    fe551bc26b92   5 seconds ago    124MB\nipinfo       latest    97bb429363fb   16 minutes ago   138MB\nubuntu       21.04     478aa0080b60   4 days ago       74.1MB\n$ docker image history fe5\nIMAGE          CREATED          CREATED BY                                      SIZE      COMMENT\nfe551bc26b92   16 seconds ago   RUN /bin/sh -c apt-get update &&     apt-get\u2026   49.9MB    buildkit.dockerfile.v0\n<missing>      4 days ago       /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B\n<missing>      4 days ago       /bin/sh -c mkdir -p /run/systemd && echo \'do\u2026   7B\n<missing>      4 days ago       /bin/sh -c [ -z "$(apt-get indextargets)" ]     0B\n<missing>      4 days ago       /bin/sh -c set -xe   && echo \'#!/bin/sh\' > /\u2026   811B\n<missing>      4 days ago       /bin/sh -c #(nop) ADD file:d6b6ba642344138dc\u2026   74.1MB\n$',lang:"shell"}),l.a.createElement("h2",{id:"43-\u6587\u4ef6\u590d\u5236\u548c\u76ee\u5f55\u64cd\u4f5c-addcopyworkdir"},l.a.createElement(r["AnchorLink"],{to:"#43-\u6587\u4ef6\u590d\u5236\u548c\u76ee\u5f55\u64cd\u4f5c-addcopyworkdir","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.3 \u6587\u4ef6\u590d\u5236\u548c\u76ee\u5f55\u64cd\u4f5c (ADD,COPY,WORKDIR)"),l.a.createElement("p",null,"\u5f80\u955c\u50cf\u91cc\u590d\u5236\u6587\u4ef6\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c",l.a.createElement("code",null,"COPY")," \u548c ",l.a.createElement("code",null,"ADD")," , \u6211\u4eec\u6765\u770b\u4e00\u4e0b\u4e24\u8005\u7684\u4e0d\u540c\u3002"),l.a.createElement("h3",{id:"\u590d\u5236\u666e\u901a\u6587\u4ef6"},l.a.createElement(r["AnchorLink"],{to:"#\u590d\u5236\u666e\u901a\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u590d\u5236\u666e\u901a\u6587\u4ef6"),l.a.createElement("p",null,l.a.createElement("code",null,"COPY")," \u548c ",l.a.createElement("code",null,"ADD")," \u90fd\u53ef\u4ee5\u628alocal\u7684\u4e00\u4e2a\u6587\u4ef6\u590d\u5236\u5230\u955c\u50cf\u91cc\uff0c\u5982\u679c\u76ee\u6807\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u81ea\u52a8\u521b\u5efa"),l.a.createElement(c["a"],{code:"FROM python:3.9.5-alpine3.13\nCOPY hello.py /app/hello.py",lang:"dockerfile"}),l.a.createElement("p",null,"\u6bd4\u5982\u628a\u672c\u5730\u7684 hello.py \u590d\u5236\u5230 /app \u76ee\u5f55\u4e0b\u3002 /app\u8fd9\u4e2afolder\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u81ea\u52a8\u521b\u5efa"),l.a.createElement("h3",{id:"\u590d\u5236\u538b\u7f29\u6587\u4ef6"},l.a.createElement(r["AnchorLink"],{to:"#\u590d\u5236\u538b\u7f29\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u590d\u5236\u538b\u7f29\u6587\u4ef6"),l.a.createElement("p",null,l.a.createElement("code",null,"ADD")," \u6bd4 COPY\u9ad8\u7ea7\u4e00\u70b9\u7684\u5730\u65b9\u5c31\u662f\uff0c\u5982\u679c\u590d\u5236\u7684\u662f\u4e00\u4e2agzip\u7b49\u538b\u7f29\u6587\u4ef6\u65f6\uff0cADD\u4f1a\u5e2e\u52a9\u6211\u4eec\u81ea\u52a8\u53bb\u89e3\u538b\u7f29\u6587\u4ef6\u3002"),l.a.createElement(c["a"],{code:"FROM python:3.9.5-alpine3.13\nADD hello.tar.gz /app/",lang:"dockerfile"}),l.a.createElement("h3",{id:"\u5982\u4f55\u9009\u62e9"},l.a.createElement(r["AnchorLink"],{to:"#\u5982\u4f55\u9009\u62e9","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u9009\u62e9"),l.a.createElement("p",null,"\u56e0\u6b64\u5728 COPY \u548c ADD \u6307\u4ee4\u4e2d\u9009\u62e9\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u9075\u5faa\u8fd9\u6837\u7684\u539f\u5219\uff0c\u6240\u6709\u7684\u6587\u4ef6\u590d\u5236\u5747\u4f7f\u7528 COPY \u6307\u4ee4\uff0c\u4ec5\u5728\u9700\u8981\u81ea\u52a8\u89e3\u538b\u7f29\u7684\u573a\u5408\u4f7f\u7528 ADD\u3002"),l.a.createElement("h2",{id:"44-\u6784\u5efa\u53c2\u6570\u548c\u73af\u5883\u53d8\u91cf-arg-vs-env"},l.a.createElement(r["AnchorLink"],{to:"#44-\u6784\u5efa\u53c2\u6570\u548c\u73af\u5883\u53d8\u91cf-arg-vs-env","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.4 \u6784\u5efa\u53c2\u6570\u548c\u73af\u5883\u53d8\u91cf (ARG vs ENV)"),l.a.createElement("p",null,l.a.createElement("code",null,"ARG")," \u548c ",l.a.createElement("code",null,"ENV")," \u662f\u7ecf\u5e38\u5bb9\u6613\u88ab\u6df7\u6dc6\u7684\u4e24\u4e2aDockerfile\u7684\u8bed\u6cd5\uff0c\u90fd\u53ef\u4ee5\u7528\u6765\u8bbe\u7f6e\u4e00\u4e2a\u201c\u53d8\u91cf\u201d\u3002 \u4f46\u5b9e\u9645\u4e0a\u4e24\u8005\u6709\u5f88\u591a\u7684\u4e0d\u540c\u3002"),l.a.createElement(c["a"],{code:"FROM ubuntu:21.04\nRUN apt-get update && \\\n    apt-get install -y wget && \\\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz && \\\n    tar zxf ipinfo_2.0.1_linux_amd64.tar.gz && \\\n    mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo && \\\n    rm -rf ipinfo_2.0.1_linux_amd64.tar.gz",lang:"dockerfile"}),l.a.createElement("h3",{id:"env"},l.a.createElement(r["AnchorLink"],{to:"#env","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"ENV"),l.a.createElement(c["a"],{code:"FROM ubuntu:21.04\nENV VERSION=2.0.1\nRUN apt-get update && \\\n    apt-get install -y wget && \\\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-${VERSION}/ipinfo_${VERSION}_linux_amd64.tar.gz && \\\n    tar zxf ipinfo_${VERSION}_linux_amd64.tar.gz && \\\n    mv ipinfo_${VERSION}_linux_amd64 /usr/bin/ipinfo && \\\n    rm -rf ipinfo_${VERSION}_linux_amd64.tar.gz",lang:"dockerfile"}),l.a.createElement("h3",{id:"arg"},l.a.createElement(r["AnchorLink"],{to:"#arg","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"ARG"),l.a.createElement(c["a"],{code:"FROM ubuntu:21.04\nARG VERSION=2.0.1\nRUN apt-get update && \\\n    apt-get install -y wget && \\\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-${VERSION}/ipinfo_${VERSION}_linux_amd64.tar.gz && \\\n    tar zxf ipinfo_${VERSION}_linux_amd64.tar.gz && \\\n    mv ipinfo_${VERSION}_linux_amd64 /usr/bin/ipinfo && \\\n    rm -rf ipinfo_${VERSION}_linux_amd64.tar.gz",lang:"dockerfile"}),l.a.createElement("h3",{id:"\u533a\u522b"},l.a.createElement(r["AnchorLink"],{to:"#\u533a\u522b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u533a\u522b"),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-14-022222.png",alt:"docker-image"})),l.a.createElement("p",null,"ARG \u53ef\u4ee5\u5728\u955c\u50cfbuild\u7684\u65f6\u5019\u52a8\u6001\u4fee\u6539value, \u901a\u8fc7 ",l.a.createElement("code",null,"--build-arg")),l.a.createElement(c["a"],{code:"$ docker image build -f .\\Dockerfile-arg -t ipinfo-arg-2.0.0 --build-arg VERSION=2.0.0 .\n$ docker image ls\nREPOSITORY         TAG       IMAGE ID       CREATED          SIZE\nipinfo-arg-2.0.0   latest    0d9c964947e2   6 seconds ago    124MB\n$ docker container run -it ipinfo-arg-2.0.0\nroot@b64285579756:/#\nroot@b64285579756:/# ipinfo version\n2.0.0\nroot@b64285579756:/#",lang:"shell"}),l.a.createElement("p",null,"ENV \u8bbe\u7f6e\u7684\u53d8\u91cf\u53ef\u4ee5\u5728Image\u4e2d\u4fdd\u6301\uff0c\u5e76\u5728\u5bb9\u5668\u4e2d\u7684\u73af\u5883\u53d8\u91cf\u91cc"),l.a.createElement("h2",{id:"45-\u5bb9\u5668\u542f\u52a8\u547d\u4ee4-cmd"},l.a.createElement(r["AnchorLink"],{to:"#45-\u5bb9\u5668\u542f\u52a8\u547d\u4ee4-cmd","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.5 \u5bb9\u5668\u542f\u52a8\u547d\u4ee4 CMD"),l.a.createElement("p",null,"CMD\u53ef\u4ee5\u7528\u6765\u8bbe\u7f6e\u5bb9\u5668\u542f\u52a8\u65f6\u9ed8\u8ba4\u4f1a\u6267\u884c\u7684\u547d\u4ee4\u3002"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5bb9\u5668\u542f\u52a8\u65f6\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4"),l.a.createElement("li",null,"\u5982\u679cdocker container run\u542f\u52a8\u5bb9\u5668\u65f6\u6307\u5b9a\u4e86\u5176\u5b83\u547d\u4ee4\uff0c\u5219CMD\u547d\u4ee4\u4f1a\u88ab\u5ffd\u7565"),l.a.createElement("li",null,"\u5982\u679c\u5b9a\u4e49\u4e86\u591a\u4e2aCMD\uff0c\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u4f1a\u88ab\u6267\u884c\u3002")),l.a.createElement("h2",{id:"46-\u5bb9\u5668\u542f\u52a8\u547d\u4ee4-entrypoint"},l.a.createElement(r["AnchorLink"],{to:"#46-\u5bb9\u5668\u542f\u52a8\u547d\u4ee4-entrypoint","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.6 \u5bb9\u5668\u542f\u52a8\u547d\u4ee4 ENTRYPOINT"),l.a.createElement("p",null,"ENTRYPOINT \u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u5bb9\u5668\u542f\u52a8\u65f6\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u4f46\u662f\u548cCMD\u662f\u6709\u533a\u522b\u7684\u3002"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"CMD")," \u8bbe\u7f6e\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u5728docker container run \u65f6\u4f20\u5165\u5176\u5b83\u547d\u4ee4\uff0c\u8986\u76d6\u6389 ",l.a.createElement("code",null,"CMD")," \u7684\u547d\u4ee4\uff0c\u4f46\u662f ",l.a.createElement("code",null,"ENTRYPOINT")," \u6240\u8bbe\u7f6e\u7684\u547d\u4ee4\u662f\u4e00\u5b9a\u4f1a\u88ab\u6267\u884c\u7684\u3002"),l.a.createElement("li",null,l.a.createElement("code",null,"ENTRYPOINT")," \u548c ",l.a.createElement("code",null,"CMD")," \u53ef\u4ee5\u8054\u5408\u4f7f\u7528\uff0c",l.a.createElement("code",null,"ENTRYPOINT")," \u8bbe\u7f6e\u6267\u884c\u7684\u547d\u4ee4\uff0cCMD\u4f20\u9012\u53c2\u6570")),l.a.createElement(c["a"],{code:'FROM ubuntu:21.04\nCMD ["echo", "hello docker"]',lang:"dockerfile"}),l.a.createElement("p",null,"\u628a\u4e0a\u9762\u7684Dockerfile build\u6210\u4e00\u4e2a\u53eb ",l.a.createElement("code",null,"demo-cmd")," \u7684\u955c\u8c61"),l.a.createElement(c["a"],{code:"$ docker image ls\nREPOSITORY        TAG       IMAGE ID       CREATED      SIZE\ndemo-cmd          latest    5bb63bb9b365   8 days ago   74.1MB",lang:"shell"}),l.a.createElement(c["a"],{code:'FROM ubuntu:21.04\nENTRYPOINT ["echo", "hello docker"]',lang:"dockerfile"}),l.a.createElement("p",null,"build\u6210\u4e00\u4e2a\u53eb ",l.a.createElement("code",null,"demo-entrypoint")," \u7684\u955c\u50cf"),l.a.createElement(c["a"],{code:"$ docker image ls\nREPOSITORY        TAG       IMAGE ID       CREATED      SIZE\ndemo-entrypoint   latest    b1693a62d67a   8 days ago   74.1MB",lang:"shell"}),l.a.createElement("p",null,"CMD\u7684\u955c\u50cf\uff0c\u5982\u679c\u6267\u884c\u521b\u5efa\u5bb9\u5668\uff0c\u4e0d\u6307\u5b9a\u8fd0\u884c\u65f6\u7684\u547d\u4ee4\uff0c\u5219\u4f1a\u9ed8\u8ba4\u6267\u884cCMD\u6240\u5b9a\u4e49\u7684\u547d\u4ee4\uff0c\u6253\u5370\u51fahello docker"),l.a.createElement(c["a"],{code:"$ docker container run -it --rm demo-cmd\nhello docker",lang:"shell"}),l.a.createElement("p",null,"\u4f46\u662f\u5982\u679c\u6211\u4eecdocker container run\u7684\u65f6\u5019\u6307\u5b9a\u547d\u4ee4\uff0c\u5219\u8be5\u547d\u4ee4\u4f1a\u8986\u76d6\u6389CMD\u7684\u547d\u4ee4\uff0c\u5982\uff1a"),l.a.createElement(c["a"],{code:'$ docker container run -it --rm demo-cmd echo "hello world"\nhello world',lang:"shell"}),l.a.createElement("p",null,"\u4f46\u662fENTRYPOINT\u7684\u5bb9\u5668\u91ccENTRYPOINT\u6240\u5b9a\u4e49\u7684\u547d\u4ee4\u5219\u65e0\u6cd5\u8986\u76d6\uff0c\u4e00\u5b9a\u4f1a\u6267\u884c"),l.a.createElement(c["a"],{code:'$ docker container run -it --rm demo-entrypoint\nhello docker\n$ docker container run -it --rm demo-entrypoint echo "hello world"\nhello docker echo hello world\n$',lang:"shell"}),l.a.createElement("h2",{id:"47-shell-\u683c\u5f0f\u548c-exec-\u683c\u5f0f"},l.a.createElement(r["AnchorLink"],{to:"#47-shell-\u683c\u5f0f\u548c-exec-\u683c\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.7 Shell \u683c\u5f0f\u548c Exec \u683c\u5f0f"),l.a.createElement("p",null,"CMD\u548cENTRYPOINT\u540c\u65f6\u652f\u6301shell\u683c\u5f0f\u548cExec\u683c\u5f0f\u3002"),l.a.createElement("h3",{id:"shell\u683c\u5f0f"},l.a.createElement(r["AnchorLink"],{to:"#shell\u683c\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Shell\u683c\u5f0f"),l.a.createElement(c["a"],{code:'CMD echo "hello docker"',lang:"dockerfile"}),l.a.createElement(c["a"],{code:'ENTRYPOINT echo "hello docker"',lang:"dockerfile"}),l.a.createElement("h3",{id:"exec\u683c\u5f0f"},l.a.createElement(r["AnchorLink"],{to:"#exec\u683c\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Exec\u683c\u5f0f"),l.a.createElement("p",null,"\u4ee5\u53ef\u6267\u884c\u547d\u4ee4\u7684\u65b9\u5f0f"),l.a.createElement(c["a"],{code:'ENTRYPOINT ["echo", "hello docker"]',lang:"dockerfile"}),l.a.createElement(c["a"],{code:'CMD ["echo", "hello docker"]',lang:"dockerfile"}),l.a.createElement("p",null,"\u6ce8\u610fshell\u811a\u672c\u7684\u95ee\u9898"),l.a.createElement(c["a"],{code:'FROM ubuntu:21.04\nENV NAME=docker\nCMD echo "hello $NAME"',lang:"dockerfile"}),l.a.createElement("p",null,"\u5047\u5982\u6211\u4eec\u8981\u628a\u4e0a\u9762\u7684CMD\u6539\u6210Exec\u683c\u5f0f\uff0c\u4e0b\u9762\u8fd9\u6837\u6539\u662f\u4e0d\u884c\u7684, \u5927\u5bb6\u53ef\u4ee5\u8bd5\u8bd5\u3002"),l.a.createElement(c["a"],{code:'FROM ubuntu:21.04\nENV NAME=docker\nCMD ["echo", "hello $NAME"]',lang:"dockerfile"}),l.a.createElement("p",null,"\u5b83\u4f1a\u6253\u5370\u51fa ",l.a.createElement("code",null,"hello $NAME")," , \u800c\u4e0d\u662f ",l.a.createElement("code",null,"hello docker")," ,\u90a3\u4e48\u9700\u8981\u600e\u4e48\u5199\u5462\uff1f \u6211\u4eec\u9700\u8981\u4ee5shell\u811a\u672c\u7684\u65b9\u5f0f\u53bb\u6267\u884c"),l.a.createElement(c["a"],{code:'FROM ubuntu:21.04\nENV NAME=docker\nCMD ["sh", "-c", "echo hello $NAME"]',lang:"dockerfile"}),l.a.createElement("h2",{id:"48-\u4e00\u8d77\u6784\u5efa\u4e00\u4e2a-python-flask-\u955c\u50cf"},l.a.createElement(r["AnchorLink"],{to:"#48-\u4e00\u8d77\u6784\u5efa\u4e00\u4e2a-python-flask-\u955c\u50cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.8 \u4e00\u8d77\u6784\u5efa\u4e00\u4e2a Python Flask \u955c\u50cf"),l.a.createElement("p",null,"Python \u7a0b\u5e8f"),l.a.createElement(c["a"],{code:"from flask import Flask\n\napp = Flask(__name__)\n\n\n@app.route('/')\ndef hello_world():\n    return 'Hello, World!'",lang:"dockerfile"}),l.a.createElement("p",null,"Dockerfile"),l.a.createElement(c["a"],{code:'FROM python:3.9.5-slim\n\nCOPY app.py /src/app.py\n\nRUN pip install flask\n\nWORKDIR /src\nENV FLASK_APP=app.py\n\nEXPOSE 5000\n\nCMD ["flask", "run", "-h", "0.0.0.0"]',lang:"dockerfile"}),l.a.createElement("h2",{id:"49-dockerfile-\u6280\u5de7\u5408\u7406\u4f7f\u7528-dockerignore"},l.a.createElement(r["AnchorLink"],{to:"#49-dockerfile-\u6280\u5de7\u5408\u7406\u4f7f\u7528-dockerignore","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.9 Dockerfile \u6280\u5de7\u2014\u2014\u5408\u7406\u4f7f\u7528 .dockerignore"),l.a.createElement("h3",{id:"\u4ec0\u4e48\u662fdocker-build-context"},l.a.createElement(r["AnchorLink"],{to:"#\u4ec0\u4e48\u662fdocker-build-context","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u4ec0\u4e48\u662fDocker build context"),l.a.createElement("p",null,"Docker\u662fclient-server\u67b6\u6784\uff0c\u7406\u8bba\u4e0aClient\u548cServer\u53ef\u4ee5\u4e0d\u5728\u4e00\u53f0\u673a\u5668\u4e0a\u3002"),l.a.createElement("p",null,"\u5728\u6784\u5efadocker\u955c\u50cf\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a\u6240\u9700\u8981\u7684\u6587\u4ef6\u7531CLI\uff08client\uff09\u53d1\u7ed9Server\uff0c\u8fd9\u4e9b\u6587\u4ef6\u5b9e\u9645\u4e0a\u5c31\u662fbuild context"),l.a.createElement("p",null,"\u4e3e\u4f8b\uff1a"),l.a.createElement(c["a"],{code:'$ dockerfile-demo more Dockerfile\nFROM python:3.9.5-slim\n\nRUN pip install flask\n\nWORKDIR /src\nENV FLASK_APP=app.py\n\nCOPY app.py /src/app.py\n\nEXPOSE 5000\n\nCMD ["flask", "run", "-h", "0.0.0.0"]\n$ dockerfile-demo more app.py\nfrom flask import Flask\n\napp = Flask(__name__)\n\n\n@app.route(\'/\')\ndef hello_world():\n    return \'Hello, world!\'',lang:"shell"}),l.a.createElement("p",null,"\u6784\u5efa\u7684\u65f6\u5019\uff0c\u7b2c\u4e00\u884c\u8f93\u51fa\u5c31\u662f\u53d1\u9001build context\u300211.13MB \uff08\u8fd9\u91cc\u662fLinux\u73af\u5883\u4e0b\u7684log\uff09"),l.a.createElement(c["a"],{code:'$ docker image build -t demo .\nSending build context to Docker daemon  11.13MB\nStep 1/7 : FROM python:3.9.5-slim\n ---\x3e 609da079b03a\nStep 2/7 : RUN pip install flask\n ---\x3e Using cache\n ---\x3e 955ce495635e\nStep 3/7 : WORKDIR /src\n ---\x3e Using cache\n ---\x3e 1c2f968e9f9b\nStep 4/7 : ENV FLASK_APP=app.py\n ---\x3e Using cache\n ---\x3e dceb15b338cf\nStep 5/7 : COPY app.py /src/app.py\n ---\x3e Using cache\n ---\x3e 0d4dfef28b5f\nStep 6/7 : EXPOSE 5000\n ---\x3e Using cache\n ---\x3e 203e9865f0d9\nStep 7/7 : CMD ["flask", "run", "-h", "0.0.0.0"]\n ---\x3e Using cache\n ---\x3e 35b5efae1293\nSuccessfully built 35b5efae1293\nSuccessfully tagged demo:latest',lang:"shell"}),l.a.createElement("p",null,l.a.createElement("code",null,".")," \u8fd9\u4e2a\u53c2\u6570\u5c31\u662f\u4ee3\u8868\u4e86build context\u6240\u6307\u5411\u7684\u76ee\u5f55"),l.a.createElement("h3",{id:"dockerignore-\u6587\u4ef6"},l.a.createElement(r["AnchorLink"],{to:"#dockerignore-\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),".dockerignore \u6587\u4ef6"),l.a.createElement(c["a"],{code:".vscode/\nenv/",lang:"unknown"}),l.a.createElement("p",null,"\u6709\u4e86.dockerignore\u6587\u4ef6\u540e\uff0c\u6211\u4eec\u518dbuild, build context\u5c31\u5c0f\u4e86\u5f88\u591a\uff0c4.096kB"),l.a.createElement(c["a"],{code:'$ docker image build -t demo .\nSending build context to Docker daemon  4.096kB\nStep 1/7 : FROM python:3.9.5-slim\n---\x3e 609da079b03a\nStep 2/7 : RUN pip install flask\n---\x3e Using cache\n---\x3e 955ce495635e\nStep 3/7 : WORKDIR /src\n---\x3e Using cache\n---\x3e 1c2f968e9f9b\nStep 4/7 : ENV FLASK_APP=app.py\n---\x3e Using cache\n---\x3e dceb15b338cf\nStep 5/7 : COPY . /src/\n---\x3e a9a8f888fef3\nStep 6/7 : EXPOSE 5000\n---\x3e Running in c71f34d32009\nRemoving intermediate container c71f34d32009\n---\x3e fed6995d5a83\nStep 7/7 : CMD ["flask", "run", "-h", "0.0.0.0"]\n---\x3e Running in 7ea669f59d5e\nRemoving intermediate container 7ea669f59d5e\n---\x3e 079bae887a47\nSuccessfully built 079bae887a47\nSuccessfully tagged demo:latest',lang:"shell"}),l.a.createElement("h2",{id:"410-dockerfile-\u6280\u5de7\u955c\u50cf\u7684\u591a\u9636\u6bb5\u6784\u5efa"},l.a.createElement(r["AnchorLink"],{to:"#410-dockerfile-\u6280\u5de7\u955c\u50cf\u7684\u591a\u9636\u6bb5\u6784\u5efa","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.10 Dockerfile \u6280\u5de7\u2014\u2014\u955c\u50cf\u7684\u591a\u9636\u6bb5\u6784\u5efa"),l.a.createElement("p",null,"\u8fd9\u4e00\u8282\u6765\u804a\u804a\u591a\u9636\u6bb5\u6784\u5efa\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u5b83\u3002"),l.a.createElement("h3",{id:"c\u8bed\u8a00\u4f8b\u5b50"},l.a.createElement(r["AnchorLink"],{to:"#c\u8bed\u8a00\u4f8b\u5b50","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"C\u8bed\u8a00\u4f8b\u5b50"),l.a.createElement("p",null,"\u5047\u5982\u6709\u4e00\u4e2aC\u7684\u7a0b\u5e8f\uff0c\u6211\u4eec\u60f3\u7528Docker\u53bb\u505a\u7f16\u8bd1\uff0c\u7136\u540e\u6267\u884c\u53ef\u6267\u884c\u6587\u4ef6\u3002"),l.a.createElement(c["a"],{code:'#include <stdio.h>\n\nvoid main(int argc, char *argv[])\n{\n    printf("hello %s\\n", argv[argc - 1]);\n}',lang:"c"}),l.a.createElement("p",null,"\u672c\u5730\u6d4b\u8bd5\uff08\u5982\u679c\u4f60\u672c\u5730\u6709C\u73af\u5883\uff09"),l.a.createElement(c["a"],{code:"$ gcc --static -o hello hello.c\n$ ls\nhello  hello.c\n$ ./hello docker\nhello docker\n$ ./hello world\nhello world\n$ ./hello friends\nhello friends\n$",lang:"shell"}),l.a.createElement("p",null,"\u6784\u5efa\u4e00\u4e2aDocker\u955c\u50cf\uff0c\u56e0\u4e3a\u8981\u6709C\u7684\u73af\u5883\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9gcc\u8fd9\u4e2aimage"),l.a.createElement(c["a"],{code:'FROM gcc:9.4\n\nCOPY hello.c /src/hello.c\n\nWORKDIR /src\n\nRUN gcc --static -o hello hello.c\n\nENTRYPOINT [ "/src/hello" ]\n\nCMD []',lang:"dockerfile"}),l.a.createElement("p",null,"build\u548c\u6d4b\u8bd5"),l.a.createElement(c["a"],{code:'$ docker build -t hello .\nSending build context to Docker daemon   5.12kB\nStep 1/6 : FROM gcc:9.4\n---\x3e be1d0d9ce039\nStep 2/6 : COPY hello.c /src/hello.c\n---\x3e Using cache\n---\x3e 70a624e3749b\nStep 3/6 : WORKDIR /src\n---\x3e Using cache\n---\x3e 24e248c6b27c\nStep 4/6 : RUN gcc --static -o hello hello.c\n---\x3e Using cache\n---\x3e db8ae7b42aff\nStep 5/6 : ENTRYPOINT [ "/src/hello" ]\n---\x3e Using cache\n---\x3e 7f307354ee45\nStep 6/6 : CMD []\n---\x3e Using cache\n---\x3e 7cfa0cbe4e2a\nSuccessfully built 7cfa0cbe4e2a\nSuccessfully tagged hello:latest\n$ docker image ls\nREPOSITORY     TAG          IMAGE ID       CREATED       SIZE\nhello          latest       7cfa0cbe4e2a   2 hours ago   1.14GB\ngcc            9.4          be1d0d9ce039   9 days ago    1.14GB\n$ docker run --rm -it hello docker\nhello docker\n$ docker run --rm -it hello world\nhello world\n$ docker run --rm -it hello friends\nhello friends\n$',lang:"shell"}),l.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\u955c\u50cf\u975e\u5e38\u7684\u5927\uff0c1.14GB"),l.a.createElement("p",null,"\u5b9e\u9645\u4e0a\u5f53\u6211\u4eec\u628ahello.c\u7f16\u8bd1\u5b8c\u4ee5\u540e\uff0c\u5e76\u4e0d\u9700\u8981\u8fd9\u6837\u4e00\u4e2a\u5927\u7684GCC\u73af\u5883\uff0c\u4e00\u4e2a\u5c0f\u7684alpine\u955c\u50cf\u5c31\u53ef\u4ee5\u4e86\u3002"),l.a.createElement("p",null,"\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa\u4e86\u3002"),l.a.createElement(c["a"],{code:'FROM gcc:9.4 AS builder\n\nCOPY hello.c /src/hello.c\n\nWORKDIR /src\n\nRUN gcc --static -o hello hello.c\n\n\n\nFROM alpine:3.13.5\n\nCOPY --from=builder /src/hello /src/hello\n\nENTRYPOINT [ "/src/hello" ]\n\nCMD []',lang:"dockerfile"}),l.a.createElement("p",null,"\u6d4b\u8bd5"),l.a.createElement(c["a"],{code:'$ docker build -t hello-apline -f Dockerfile-new .\nSending build context to Docker daemon   5.12kB\nStep 1/8 : FROM gcc:9.4 AS builder\n---\x3e be1d0d9ce039\nStep 2/8 : COPY hello.c /src/hello.c\n---\x3e Using cache\n---\x3e 70a624e3749b\nStep 3/8 : WORKDIR /src\n---\x3e Using cache\n---\x3e 24e248c6b27c\nStep 4/8 : RUN gcc --static -o hello hello.c\n---\x3e Using cache\n---\x3e db8ae7b42aff\nStep 5/8 : FROM alpine:3.13.5\n---\x3e 6dbb9cc54074\nStep 6/8 : COPY --from=builder /src/hello /src/hello\n---\x3e Using cache\n---\x3e 18c2bce629fb\nStep 7/8 : ENTRYPOINT [ "/src/hello" ]\n---\x3e Using cache\n---\x3e 8dfb9d9d6010\nStep 8/8 : CMD []\n---\x3e Using cache\n---\x3e 446baf852214\nSuccessfully built 446baf852214\nSuccessfully tagged hello-apline:latest\n$ docker image ls\nREPOSITORY     TAG          IMAGE ID       CREATED       SIZE\nhello-alpine   latest       446baf852214   2 hours ago   6.55MB\nhello          latest       7cfa0cbe4e2a   2 hours ago   1.14GB\ndemo           latest       079bae887a47   2 hours ago   125MB\ngcc            9.4          be1d0d9ce039   9 days ago    1.14GB\n$ docker run --rm -it hello-alpine docker\nhello docker\n$ docker run --rm -it hello-alpine world\nhello world\n$ docker run --rm -it hello-alpine friends\nhello friends\n$',lang:"shell"}),l.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u955c\u50cf\u975e\u5e38\u5c0f\uff0c\u53ea\u67096.55MB"),l.a.createElement("h2",{id:"411-dockerfile-\u6280\u5de7\u5c3d\u91cf\u4f7f\u7528\u975eroot\u7528\u6237"},l.a.createElement(r["AnchorLink"],{to:"#411-dockerfile-\u6280\u5de7\u5c3d\u91cf\u4f7f\u7528\u975eroot\u7528\u6237","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.11 Dockerfile \u6280\u5de7\u2014\u2014\u5c3d\u91cf\u4f7f\u7528\u975eroot\u7528\u6237"),l.a.createElement("h3",{id:"root\u7684\u5371\u9669\u6027"},l.a.createElement(r["AnchorLink"],{to:"#root\u7684\u5371\u9669\u6027","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Root\u7684\u5371\u9669\u6027"),l.a.createElement("p",null,"docker\u7684root\u6743\u9650\u4e00\u76f4\u662f\u5176\u906d\u53d7\u8bdf\u75c5\u7684\u5730\u65b9\uff0cdocker\u7684root\u6743\u9650\u6709\u90a3\u4e48\u5371\u9669\u4e48\uff1f\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\u3002"),l.a.createElement("p",null,"\u5047\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u7528\u6237\uff0c\u53ebdemo\uff0c\u5b83\u672c\u8eab\u4e0d\u5177\u6709sudo\u7684\u6743\u9650\uff0c\u6240\u4ee5\u5c31\u6709\u5f88\u591a\u6587\u4ef6\u65e0\u6cd5\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u6bd4\u5982/root\u76ee\u5f55\u5b83\u662f\u65e0\u6cd5\u67e5\u770b\u7684\u3002"),l.a.createElement(c["a"],{code:"[demo@docker-host ~]$ sudo ls /root\n[sudo] password for demo:\ndemo is not in the sudoers file.  This incident will be reported.\n[demo@docker-host ~]$",lang:"shell"}),l.a.createElement("p",null,"\u4f46\u662f\u8fd9\u4e2a\u7528\u6237\u6709\u6267\u884cdocker\u7684\u6743\u9650\uff0c\u4e5f\u5c31\u662f\u5b83\u5728docker\u8fd9\u4e2agroup\u91cc\u3002"),l.a.createElement(c["a"],{code:"[demo@docker-host ~]$ groups\ndemo docker\n[demo@docker-host ~]$ docker image ls\nREPOSITORY   TAG       IMAGE ID       CREATED      SIZE\nbusybox      latest    a9d583973f65   2 days ago   1.23MB\n[demo@docker-host ~]$",lang:"shell"}),l.a.createElement("p",null,"\u8fd9\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7Docker\u505a\u5f88\u591a\u8d8a\u6743\u7684\u4e8b\u60c5\u4e86\uff0c\u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u65e0\u6cd5\u67e5\u770b\u7684/root\u76ee\u5f55\u6620\u5c04\u5230docker container\u91cc\uff0c\u4f60\u5c31\u53ef\u4ee5\u81ea\u7531\u8fdb\u884c\u67e5\u770b\u4e86\u3002"),l.a.createElement(c["a"],{code:"[demo@docker-host vagrant]$ docker run -it -v /root/:/root/tmp busybox sh\n/ # cd /root/tmp\n~/tmp # ls\nanaconda-ks.cfg  original-ks.cfg\n~/tmp # ls -l\ntotal 16\n-rw-------    1 root     root          5570 Apr 30  2020 anaconda-ks.cfg\n-rw-------    1 root     root          5300 Apr 30  2020 original-ks.cfg\n~/tmp #",lang:"unknown"}),l.a.createElement("p",null,"\u66f4\u751a\u81f3\u6211\u4eec\u53ef\u4ee5\u7ed9\u6211\u4eec\u81ea\u5df1\u52a0sudo\u6743\u9650\u3002\u6211\u4eec\u73b0\u5728\u6ca1\u6709sudo\u6743\u9650"),l.a.createElement(c["a"],{code:"[demo@docker-host ~]$ sudo vim /etc/sudoers\n[sudo] password for demo:\ndemo is not in the sudoers file.  This incident will be reported.\n[demo@docker-host ~]$",lang:"shell"}),l.a.createElement("p",null,"\u4f46\u662f\u6211\u53ef\u4ee5\u7ed9\u81ea\u5df1\u6dfb\u52a0\u3002"),l.a.createElement(c["a"],{code:'[demo@docker-host ~]$ docker run -it -v /etc/sudoers:/root/sudoers busybox sh\n/ # echo "demo    ALL=(ALL)       ALL" >> /root/sudoers\n/ # more /root/sudoers | grep demo\ndemo    ALL=(ALL)       ALL',lang:"shell"}),l.a.createElement("p",null,"\u7136\u540e\u9000\u51facontainer\uff0cbingo\uff0c\u6211\u4eec\u6709sudo\u6743\u9650\u4e86\u3002"),l.a.createElement(c["a"],{code:"[demo@docker-host ~]$ sudo more /etc/sudoers | grep demo\ndemo    ALL=(ALL)       ALL\n[demo@docker-host ~]$",lang:"shell"}),l.a.createElement("h3",{id:"\u5982\u4f55\u4f7f\u7528\u975eroot\u7528\u6237"},l.a.createElement(r["AnchorLink"],{to:"#\u5982\u4f55\u4f7f\u7528\u975eroot\u7528\u6237","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u4f7f\u7528\u975eroot\u7528\u6237"),l.a.createElement("p",null,"\u6211\u4eec\u51c6\u5907\u4e24\u4e2aDockerfile\uff0c\u7b2c\u4e00\u4e2aDockerfile\u5982\u4e0b\uff0c\u5176\u4e2dapp.py\u6587\u4ef6\u6e90\u7801\u8bf7\u53c2\u8003 \u4e00\u8d77\u6784\u5efa\u4e00\u4e2a Python Flask \u955c\u50cf \uff1a"),l.a.createElement(c["a"],{code:'FROM python:3.9.5-slim\n\nRUN pip install flask\n\nCOPY app.py /src/app.py\n\nWORKDIR /src\nENV FLASK_APP=app.py\n\nEXPOSE 5000\n\nCMD ["flask", "run", "-h", "0.0.0.0"]',lang:"dockerfile"}),l.a.createElement("p",null,"\u5047\u8bbe\u6784\u5efa\u7684\u955c\u50cf\u540d\u5b57\u4e3a ",l.a.createElement("code",null,"flask-demo")),l.a.createElement("p",null,"\u7b2c\u4e8c\u4e2aDockerfile\uff0c\u4f7f\u7528\u975eroot\u7528\u6237\u6765\u6784\u5efa\u8fd9\u4e2a\u955c\u50cf\uff0c\u540d\u5b57\u53eb ",l.a.createElement("code",null,"flask-no-root")," Dockerfile\u5982\u4e0b\uff1a"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u901a\u8fc7groupadd\u548cuseradd\u521b\u5efa\u4e00\u4e2aflask\u7684\u7ec4\u548c\u7528\u6237"),l.a.createElement("li",null,"\u901a\u8fc7USER\u6307\u5b9a\u540e\u9762\u7684\u547d\u4ee4\u8981\u4ee5flask\u8fd9\u4e2a\u7528\u6237\u7684\u8eab\u4efd\u8fd0\u884c")),l.a.createElement(c["a"],{code:'FROM python:3.9.5-slim\n\nRUN pip install flask && \\\n    groupadd -r flask && useradd -r -g flask flask && \\\n    mkdir /src && \\\n    chown -R flask:flask /src\n\nUSER flask\n\nCOPY app.py /src/app.py\n\nWORKDIR /src\nENV FLASK_APP=app.py\n\nEXPOSE 5000\n\nCMD ["flask", "run", "-h", "0.0.0.0"]',lang:"dockerfile"}),l.a.createElement(c["a"],{code:"$ docker image ls\nREPOSITORY      TAG          IMAGE ID       CREATED          SIZE\nflask-no-root   latest       80996843356e   41 minutes ago   126MB\nflask-demo      latest       2696c68b51ce   49 minutes ago   125MB\npython          3.9.5-slim   609da079b03a   2 weeks ago      115MB",lang:"shell"}),l.a.createElement("p",null,"\u5206\u522b\u4f7f\u7528\u8fd9\u4e24\u4e2a\u955c\u50cf\u521b\u5efa\u4e24\u4e2a\u5bb9\u5668"),l.a.createElement(c["a"],{code:'$ docker run -d --name flask-root flask-demo\nb31588bae216951e7981ce14290d74d377eef477f71e1506b17ee505d7994774\n$ docker run -d --name flask-no-root flask-no-root\n83aaa4a116608ec98afff2a142392119b7efe53617db213e8c7276ab0ae0aaa0\n$ docker container ps\nCONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS      NAMES\n83aaa4a11660   flask-no-root   "flask run -h 0.0.0.0"   4 seconds ago    Up 3 seconds    5000/tcp   flask-no-root\nb31588bae216   flask-demo      "flask run -h 0.0.0.0"   16 seconds ago   Up 15 seconds   5000/tcp   flask-root',lang:"shell"}),l.a.createElement("h1",{id:"5-docker\u7684\u5b58\u50a8"},l.a.createElement(r["AnchorLink"],{to:"#5-docker\u7684\u5b58\u50a8","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5. Docker\u7684\u5b58\u50a8"),l.a.createElement("h2",{id:"51-\u4ecb\u7ecd"},l.a.createElement(r["AnchorLink"],{to:"#51-\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5.1 \u4ecb\u7ecd"),l.a.createElement("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\u91cc\u521b\u5efa\u7684\u6587\u4ef6\uff0c\u88ab\u4fdd\u5b58\u5728\u4e00\u4e2a\u53ef\u5199\u7684\u5bb9\u5668\u5c42\uff1a"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5982\u679c\u5bb9\u5668\u88ab\u5220\u9664\u4e86\uff0c\u5219\u6570\u636e\u4e5f\u6ca1\u6709\u4e86"),l.a.createElement("li",null,"\u8fd9\u4e2a\u53ef\u5199\u7684\u5bb9\u5668\u5c42\u662f\u548c\u7279\u5b9a\u7684\u5bb9\u5668\u7ed1\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e9b\u6570\u636e\u65e0\u6cd5\u65b9\u4fbf\u7684\u548c\u5176\u5b83\u5bb9\u5668\u5171\u4eab")),l.a.createElement("p",null,"Docker\u4e3b\u8981\u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\u505a\u6570\u636e\u7684\u6301\u4e45\u5316"),l.a.createElement("ul",null,l.a.createElement("li",null,"Data Volume, \u7531Docker\u7ba1\u7406\uff0c(/var/lib/docker/volumes/ Linux), \u6301\u4e45\u5316\u6570\u636e\u7684\u6700\u597d\u65b9\u5f0f"),l.a.createElement("li",null,"Bind Mount\uff0c\u7531\u7528\u6237\u6307\u5b9a\u5b58\u50a8\u7684\u6570\u636e\u5177\u4f53mount\u5728\u7cfb\u7edf\u4ec0\u4e48\u4f4d\u7f6e")),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-14-025605.png",alt:"docker-volume"})),l.a.createElement("h2",{id:"52-data-volume"},l.a.createElement(r["AnchorLink"],{to:"#52-data-volume","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5.2 Data Volume"),l.a.createElement("p",null,"\u5982\u4f55\u8fdb\u884c\u6570\u636e\u7684\u6301\u4e45\u5316\u3002"),l.a.createElement("h3",{id:"\u73af\u5883\u51c6\u5907"},l.a.createElement(r["AnchorLink"],{to:"#\u73af\u5883\u51c6\u5907","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u51c6\u5907"),l.a.createElement("p",null,"\u51c6\u5907\u4e00\u4e2aDockerfile \u548c\u4e00\u4e2a my-cron\u7684\u6587\u4ef6"),l.a.createElement(c["a"],{code:'$ ls\nDockerfile  my-cron\n$ more Dockerfile\nFROM alpine:latest\nRUN apk update\nRUN apk --no-cache add curl\nENV SUPERCRONIC_URL=https://github.com/aptible/supercronic/releases/download/v0.1.12/supercronic-linux-amd64 \\\n    SUPERCRONIC=supercronic-linux-amd64 \\\n    SUPERCRONIC_SHA1SUM=048b95b48b708983effb2e5c935a1ef8483d9e3e\nRUN curl -fsSLO "$SUPERCRONIC_URL" \\\n    && echo "${SUPERCRONIC_SHA1SUM}  ${SUPERCRONIC}" | sha1sum -c - \\\n    && chmod +x "$SUPERCRONIC" \\\n    && mv "$SUPERCRONIC" "/usr/local/bin/${SUPERCRONIC}" \\\n    && ln -s "/usr/local/bin/${SUPERCRONIC}" /usr/local/bin/supercronic\nCOPY my-cron /app/my-cron\nWORKDIR /app\n\nVOLUME ["/app"]\n\n# RUN cron job\nCMD ["/usr/local/bin/supercronic", "/app/my-cron"]\n$\n$ more my-cron\n*/1 * * * * date >> /app/test.txt',lang:"shell"}),l.a.createElement("h3",{id:"\u6784\u5efa\u955c\u50cf"},l.a.createElement(r["AnchorLink"],{to:"#\u6784\u5efa\u955c\u50cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6784\u5efa\u955c\u50cf"),l.a.createElement(c["a"],{code:"$ docker image build -t my-cron .\n$ docker image ls\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\nmy-cron      latest    e9fbd9a562c9   4 seconds ago   24.7MB",lang:"shell"}),l.a.createElement("h3",{id:"\u521b\u5efa\u5bb9\u5668\u4e0d\u6307\u5b9a-v\u53c2\u6570"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efa\u5bb9\u5668\u4e0d\u6307\u5b9a-v\u53c2\u6570","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u5bb9\u5668(\u4e0d\u6307\u5b9a-v\u53c2\u6570)"),l.a.createElement("p",null,"\u6b64\u65f6Docker\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u968f\u673a\u540d\u5b57\u7684volume\uff0c\u53bb\u5b58\u50a8\u6211\u4eec\u5728Dockerfile\u5b9a\u4e49\u7684volume ",l.a.createElement("code",null,'VOLUME ["/app"]')),l.a.createElement(c["a"],{code:'$ docker run -d my-cron\n9a8fa93f03c42427a498b21ac520660752122e20bcdbf939661646f71d277f8f\n$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264\n$ docker volume inspect 043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264\n[\n    {\n        "CreatedAt": "2021-06-22T23:06:13+02:00",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264/_data",\n        "Name": "043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264",\n        "Options": null,\n        "Scope": "local"\n    }\n]',lang:"shell"}),l.a.createElement("p",null,"\u5728\u8fd9\u4e2aVolume\u7684mountpoint\u53ef\u4ee5\u53d1\u73b0\u5bb9\u5668\u521b\u5efa\u7684\u6587\u4ef6"),l.a.createElement("h3",{id:"\u521b\u5efa\u5bb9\u5668\u6307\u5b9a-v\u53c2\u6570"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efa\u5bb9\u5668\u6307\u5b9a-v\u53c2\u6570","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u5bb9\u5668(\u6307\u5b9a-v\u53c2\u6570)"),l.a.createElement("p",null,"\u5728\u521b\u5efa\u5bb9\u5668\u7684\u65f6\u5019\u901a\u8fc7 ",l.a.createElement("code",null,"-v")," \u53c2\u6570\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u7684\u6307\u5b9a\u9700\u8981\u521b\u5efaVolume\u7684\u540d\u5b57\uff0c\u4ee5\u53ca\u5bf9\u5e94\u4e8e\u5bb9\u5668\u5185\u7684\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u662f\u53ef\u4ee5\u4efb\u610f\u7684\uff0c\u4e0d\u5fc5\u9700\u8981\u5728Dockerfile\u91cc\u901a\u8fc7VOLUME\u5b9a\u4e49"),l.a.createElement("p",null,"\u6bd4\u5982\u6211\u4eec\u628a\u4e0a\u9762\u7684Dockerfile\u91cc\u7684VOLUME\u5220\u9664"),l.a.createElement(c["a"],{code:'FROM alpine:latest\nRUN apk update\nRUN apk --no-cache add curl\nENV SUPERCRONIC_URL=https://github.com/aptible/supercronic/releases/download/v0.1.12/supercronic-linux-amd64 \\\n    SUPERCRONIC=supercronic-linux-amd64 \\\n    SUPERCRONIC_SHA1SUM=048b95b48b708983effb2e5c935a1ef8483d9e3e\nRUN curl -fsSLO "$SUPERCRONIC_URL" \\\n    && echo "${SUPERCRONIC_SHA1SUM}  ${SUPERCRONIC}" | sha1sum -c - \\\n    && chmod +x "$SUPERCRONIC" \\\n    && mv "$SUPERCRONIC" "/usr/local/bin/${SUPERCRONIC}" \\\n    && ln -s "/usr/local/bin/${SUPERCRONIC}" /usr/local/bin/supercronic\nCOPY my-cron /app/my-cron\nWORKDIR /app\n\n# RUN cron job\nCMD ["/usr/local/bin/supercronic", "/app/my-cron"]',lang:"shell"}),l.a.createElement("p",null,"\u91cd\u65b0build\u955c\u50cf\uff0c\u7136\u540e\u521b\u5efa\u5bb9\u5668\uff0c\u52a0-v\u53c2\u6570"),l.a.createElement(c["a"],{code:'$ docker image build -t my-cron .\n$ docker container run -d -v cron-data:/app my-cron\n43c6d0357b0893861092a752c61ab01bdfa62ea766d01d2fcb8b3ecb6c88b3de\n$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     cron-data\n$ docker volume inspect cron-data\n[\n    {\n        "CreatedAt": "2021-06-22T23:25:02+02:00",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/cron-data/_data",\n        "Name": "cron-data",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n$ ls /var/lib/docker/volumes/cron-data/_data\nmy-cron\n$ ls /var/lib/docker/volumes/cron-data/_data\nmy-cron  test.txt',lang:"shell"}),l.a.createElement("p",null,"Volume\u4e5f\u521b\u5efa\u4e86\u3002"),l.a.createElement("h3",{id:"\u73af\u5883\u6e05\u7406"},l.a.createElement(r["AnchorLink"],{to:"#\u73af\u5883\u6e05\u7406","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u6e05\u7406"),l.a.createElement("p",null,"\u5f3a\u5236\u5220\u9664\u6240\u6709\u5bb9\u5668\uff0c\u7cfb\u7edf\u6e05\u7406\u548cvolume\u6e05\u7406"),l.a.createElement(c["a"],{code:"$ docker rm -f $(docker container ps -aq)\n$ docker system prune -f\n$ docker volume prune -f",lang:"shell"}),l.a.createElement("h2",{id:"53-data-volume-\u7ec3\u4e60-mysql"},l.a.createElement(r["AnchorLink"],{to:"#53-data-volume-\u7ec3\u4e60-mysql","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5.3 Data Volume \u7ec3\u4e60 MySQL"),l.a.createElement("p",null,"\u4f7f\u7528MySQL\u5b98\u65b9\u955c\u50cf\uff0ctag\u7248\u672c5.7"),l.a.createElement("p",null,"Dockerfile\u53ef\u4ee5\u5728\u8fd9\u91cc\u67e5\u770b ",l.a.createElement(r["Link"],{to:"https://github.com/docker-library/mysql/tree/master/5.7"},"https://github.com/docker-library/mysql/tree/master/5.7")),l.a.createElement("h3",{id:"\u51c6\u5907\u955c\u50cf"},l.a.createElement(r["AnchorLink"],{to:"#\u51c6\u5907\u955c\u50cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u51c6\u5907\u955c\u50cf"),l.a.createElement(c["a"],{code:"$ docker pull mysql:5.7\n$ docker image ls\nREPOSITORY   TAG       IMAGE ID       CREATED        SIZE\nmysql        5.7       2c9028880e58   5 weeks ago    447MB",lang:"shell"}),l.a.createElement("h3",{id:"\u521b\u5efa\u5bb9\u5668"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efa\u5bb9\u5668","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u5bb9\u5668"),l.a.createElement("p",null,"\u5173\u4e8eMySQL\u7684\u955c\u50cf\u4f7f\u7528\uff0c\u53ef\u4ee5\u53c2\u8003dockerhub ",l.a.createElement(r["Link"],{to:"https://hub.docker.com/_/mysql?tab=description&page=1&ordering=last_updated"},"https://hub.docker.com/_/mysql?tab=description&page=1&ordering=last_updated")),l.a.createElement("p",null,"\u5173\u4e8eDockerfile Volume\u7684\u5b9a\u4e49\uff0c\u53ef\u4ee5\u53c2\u8003 ",l.a.createElement(r["Link"],{to:"https://github.com/docker-library/mysql/tree/master/5.7"},"https://github.com/docker-library/mysql/tree/master/5.7")),l.a.createElement(c["a"],{code:'$ docker container run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d -v mysql-data:/var/lib/mysql mysql:5.7\n02206eb369be08f660bf86b9d5be480e24bb6684c8a938627ebfbcfc0fd9e48e\n$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     mysql-data\n$ docker volume inspect mysql-data\n[\n    {\n        "CreatedAt": "2021-06-21T23:55:23+02:00",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/mysql-data/_data",\n        "Name": "mysql-data",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n$',lang:"shell"}),l.a.createElement("h3",{id:"\u6570\u636e\u5e93\u5199\u5165\u6570\u636e"},l.a.createElement(r["AnchorLink"],{to:"#\u6570\u636e\u5e93\u5199\u5165\u6570\u636e","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6570\u636e\u5e93\u5199\u5165\u6570\u636e"),l.a.createElement("p",null,"\u8fdb\u5165MySQL\u7684shell\uff0c\u5bc6\u7801\u662f ",l.a.createElement("code",null,"my-secret-pw")),l.a.createElement(c["a"],{code:"$ docker container exec -it 022 sh\n# mysql -u root -p\nEnter password:\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2\nServer version: 5.7.34 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2021, Oracle and/or its affiliates.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n\nmysql> create database demo;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| demo               |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows in set (0.00 sec)\n\nmysql> exit\nBye\n# exit",lang:"shell"}),l.a.createElement("p",null,"\u521b\u5efa\u4e86\u4e00\u4e2a\u53eb demo\u7684\u6570\u636e\u5e93"),l.a.createElement("p",null,"\u67e5\u770bdata volume"),l.a.createElement(c["a"],{code:'$ docker volume inspect mysql-data\n[\n    {\n        "CreatedAt": "2021-06-22T00:01:34+02:00",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/mysql-data/_data",\n        "Name": "mysql-data",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n$ ls  /var/lib/docker/volumes/mysql-data/_data\nauto.cnf    client-cert.pem  ib_buffer_pool  ibdata1  performance_schema  server-cert.pem\nca-key.pem  client-key.pem   ib_logfile0     ibtmp1   private_key.pem     server-key.pem\nca.pem      demo             ib_logfile1     mysql    public_key.pem      sys\n$',lang:"shell"}),l.a.createElement("h2",{id:"53--\u591a\u4e2a\u673a\u5668\u4e4b\u95f4\u7684\u5bb9\u5668\u5171\u4eab\u6570\u636e"},l.a.createElement(r["AnchorLink"],{to:"#53--\u591a\u4e2a\u673a\u5668\u4e4b\u95f4\u7684\u5bb9\u5668\u5171\u4eab\u6570\u636e","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5.3  \u591a\u4e2a\u673a\u5668\u4e4b\u95f4\u7684\u5bb9\u5668\u5171\u4eab\u6570\u636e"),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-14-031247.png",alt:"multi-host-volume"})),l.a.createElement("p",null,"\u5b98\u65b9\u53c2\u8003\u94fe\u63a5 ",l.a.createElement(r["Link"],{to:"https://docs.docker.com/storage/volumes/#share-data-among-machines"},"https://docs.docker.com/storage/volumes/#share-data-among-machines")),l.a.createElement("p",null,"Docker\u7684volume\u652f\u6301\u591a\u79cddriver\u3002\u9ed8\u8ba4\u521b\u5efa\u7684volume driver\u90fd\u662flocal"),l.a.createElement(c["a"],{code:'$ docker volume inspect vscode\n[\n    {\n        "CreatedAt": "2021-06-23T21:33:57Z",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/vscode/_data",\n        "Name": "vscode",\n        "Options": null,\n        "Scope": "local"\n    }\n]',lang:"shell"}),l.a.createElement("p",null,"\u8fd9\u4e00\u8282\u6211\u4eec\u770b\u770b\u4e00\u4e2a\u53ebsshfs\u7684driver\uff0c\u5982\u4f55\u8ba9docker\u4f7f\u7528\u4e0d\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u505avolume"),l.a.createElement("h3",{id:"\u73af\u5883\u51c6\u5907-1"},l.a.createElement(r["AnchorLink"],{to:"#\u73af\u5883\u51c6\u5907-1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u51c6\u5907"),l.a.createElement("p",null,"\u51c6\u5907\u4e09\u53f0Linux\u673a\u5668\uff0c\u4e4b\u95f4\u53ef\u4ee5\u901a\u8fc7SSH\u76f8\u4e92\u901a\u4fe1\u3002"),l.a.createElement(o["a"],null,l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"hostname"),l.a.createElement("th",null,"ip"),l.a.createElement("th",null,"ssh username"),l.a.createElement("th",null,"ssh password"))),l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"docker-host1"),l.a.createElement("td",null,"192.168.200.10"),l.a.createElement("td",null,"vagrant"),l.a.createElement("td",null,"vagrant")),l.a.createElement("tr",null,l.a.createElement("td",null,"docker-host2"),l.a.createElement("td",null,"192.168.200.11"),l.a.createElement("td",null,"vagrant"),l.a.createElement("td",null,"vagrant")),l.a.createElement("tr",null,l.a.createElement("td",null,"docker-host3"),l.a.createElement("td",null,"192.168.200.12"),l.a.createElement("td",null,"vagrant"),l.a.createElement("td",null,"vagrant")))),l.a.createElement("h3",{id:"\u5b89\u88c5plugin"},l.a.createElement(r["AnchorLink"],{to:"#\u5b89\u88c5plugin","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5plugin"),l.a.createElement("p",null,"\u5728\u5176\u4e2d\u4e24\u53f0\u673a\u5668\u4e0a\u5b89\u88c5\u4e00\u4e2aplugin ",l.a.createElement("code",null,"vieux/sshfs")),l.a.createElement(c["a"],{code:"[vagrant@docker-host1 ~]$ docker plugin install --grant-all-permissions vieux/sshfs\nlatest: Pulling from vieux/sshfs\nDigest: sha256:1d3c3e42c12138da5ef7873b97f7f32cf99fb6edde75fa4f0bcf9ed277855811\n52d435ada6a4: Complete\nInstalled plugin vieux/sshfs",lang:"shell"}),l.a.createElement(c["a"],{code:"[vagrant@docker-host2 ~]$ docker plugin install --grant-all-permissions vieux/sshfs\nlatest: Pulling from vieux/sshfs\nDigest: sha256:1d3c3e42c12138da5ef7873b97f7f32cf99fb6edde75fa4f0bcf9ed277855811\n52d435ada6a4: Complete\nInstalled plugin vieux/sshfs",lang:"shell"}),l.a.createElement("h3",{id:"\u521b\u5efavolume"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efavolume","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efavolume"),l.a.createElement(c["a"],{code:"[vagrant@docker-host1 ~]$ docker volume create --driver vieux/sshfs \\\n                          -o sshcmd=vagrant@192.168.200.12:/home/vagrant \\\n                          -o password=vagrant \\\n                          sshvolume",lang:"shell"}),l.a.createElement("p",null,"\u67e5\u770b"),l.a.createElement(c["a"],{code:'[vagrant@docker-host1 ~]$ docker volume ls\nDRIVER               VOLUME NAME\nvieux/sshfs:latest   sshvolume\n[vagrant@docker-host1 ~]$ docker volume inspect sshvolume\n[\n    {\n        "CreatedAt": "0001-01-01T00:00:00Z",\n        "Driver": "vieux/sshfs:latest",\n        "Labels": {},\n        "Mountpoint": "/mnt/volumes/f59e848643f73d73a21b881486d55b33",\n        "Name": "sshvolume",\n        "Options": {\n            "password": "vagrant",\n            "sshcmd": "vagrant@192.168.200.12:/home/vagrant"\n        },\n        "Scope": "local"\n    }\n]',lang:"shell"}),l.a.createElement("h3",{id:"\u521b\u5efa\u5bb9\u5668\u6302\u8f7dvolume"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efa\u5bb9\u5668\u6302\u8f7dvolume","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u5bb9\u5668\u6302\u8f7dVolume"),l.a.createElement("p",null,"\u521b\u5efa\u5bb9\u5668\uff0c\u6302\u8f7dsshvolume\u5230/app\u76ee\u5f55\uff0c\u7136\u540e\u8fdb\u5165\u5bb9\u5668\u7684shell\uff0c\u5728/app\u76ee\u5f55\u521b\u5efa\u4e00\u4e2atest.txt\u6587\u4ef6"),l.a.createElement(c["a"],{code:"[vagrant@docker-host1 ~]$ docker run -it -v sshvolume:/app busybox sh\nUnable to find image 'busybox:latest' locally\nlatest: Pulling from library/busybox\nb71f96345d44: Pull complete\nDigest: sha256:930490f97e5b921535c153e0e7110d251134cc4b72bbb8133c6a5065cc68580d\nStatus: Downloaded newer image for busybox:latest\n/ #\n/ # ls\napp   bin   dev   etc   home  proc  root  sys   tmp   usr   var\n/ # cd /app\n/app # ls\n/app # echo \"this is ssh volume\"> test.txt\n/app # ls\ntest.txt\n/app # more test.txt\nthis is ssh volume\n/app #\n/app #",lang:"shell"}),l.a.createElement("p",null,"\u8fd9\u4e2a\u6587\u4ef6\u6211\u4eec\u53ef\u4ee5\u5728docker-host3\u4e0a\u770b\u5230"),l.a.createElement(c["a"],{code:"[vagrant@docker-host3 ~]$ pwd\n/home/vagrant\n[vagrant@docker-host3 ~]$ ls\ntest.txt\n[vagrant@docker-host3 ~]$ more test.txt\nthis is ssh volume",lang:"shell"}),l.a.createElement("h1",{id:"6-docker\u7684\u7f51\u7edc"},l.a.createElement(r["AnchorLink"],{to:"#6-docker\u7684\u7f51\u7edc","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"6. Docker\u7684\u7f51\u7edc"),l.a.createElement("h2",{id:"61-\u7f51\u7edc\u57fa\u7840\u77e5\u8bc6\u56de\u987e"},l.a.createElement(r["AnchorLink"],{to:"#61-\u7f51\u7edc\u57fa\u7840\u77e5\u8bc6\u56de\u987e","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"6.1 \u7f51\u7edc\u57fa\u7840\u77e5\u8bc6\u56de\u987e"),l.a.createElement("p",null,"IP\u3001\u5b50\u7f51\u63a9\u7801\u3001\u7f51\u5173\u3001DNS\u3001\u7aef\u53e3\u53f7"),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"https://zhuanlan.zhihu.com/p/65226634"},"https://zhuanlan.zhihu.com/p/65226634")),l.a.createElement("blockquote",null,l.a.createElement("p",null,"\u9762\u8bd5\u5e38\u95ee\u7684\u4e00\u4e2a\u9898\u76ee, \u5f53\u4f60\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165\u4e00\u4e2a\u7f51\u5740\uff08\u6bd4\u5982www.baidu.com\uff09\u5e76\u6572\u56de\u8f66\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u540e\u9762\u90fd\u53d1\u751f\u4e86\u4ec0\u4e48")),l.a.createElement("h3",{id:"internet\u5982\u4f55\u5de5\u4f5c\u7684"},l.a.createElement(r["AnchorLink"],{to:"#internet\u5982\u4f55\u5de5\u4f5c\u7684","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Internet\u5982\u4f55\u5de5\u4f5c\u7684"),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"https://www.hp.com/us-en/shop/tech-takes/how-does-the-internet-work"},"https://www.hp.com/us-en/shop/tech-takes/how-does-the-internet-work")),l.a.createElement("p",null,"\u4ece\u6570\u636e\u5305\u7684\u89d2\u5ea6\u8be6\u7ec6\u89e3\u6790"),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"https://www.homenethowto.com/advanced-topics/traffic-example-the-full-picture/"},"https://www.homenethowto.com/advanced-topics/traffic-example-the-full-picture/")),l.a.createElement("h2",{id:"62-\u7f51\u7edc\u5e38\u7528\u547d\u4ee4"},l.a.createElement(r["AnchorLink"],{to:"#62-\u7f51\u7edc\u5e38\u7528\u547d\u4ee4","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"6.2 \u7f51\u7edc\u5e38\u7528\u547d\u4ee4"),l.a.createElement("h3",{id:"ip\u5730\u5740\u7684\u67e5\u770b"},l.a.createElement(r["AnchorLink"],{to:"#ip\u5730\u5740\u7684\u67e5\u770b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"IP\u5730\u5740\u7684\u67e5\u770b"),l.a.createElement("p",null,"Windows"),l.a.createElement(c["a"],{code:"ipconfig",lang:"unknown"}),l.a.createElement("p",null,"Linux"),l.a.createElement(c["a"],{code:"ifconfig",lang:"unknown"}),l.a.createElement("p",null,"\u6216\u8005"),l.a.createElement(c["a"],{code:"ip addr",lang:"unknown"}),l.a.createElement("h3",{id:"\u7f51\u7edc\u8fde\u901a\u6027\u6d4b\u8bd5"},l.a.createElement(r["AnchorLink"],{to:"#\u7f51\u7edc\u8fde\u901a\u6027\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u7f51\u7edc\u8fde\u901a\u6027\u6d4b\u8bd5"),l.a.createElement("h4",{id:"ping\u547d\u4ee4"},l.a.createElement(r["AnchorLink"],{to:"#ping\u547d\u4ee4","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"ping\u547d\u4ee4"),l.a.createElement(c["a"],{code:"PS C:\\Users\\Peng Xiao> ping 192.168.178.1\n\nPinging 192.168.178.1 with 32 bytes of data:\nReply from 192.168.178.1: bytes=32 time=2ms TTL=64\nReply from 192.168.178.1: bytes=32 time=3ms TTL=64\nReply from 192.168.178.1: bytes=32 time=3ms TTL=64\nReply from 192.168.178.1: bytes=32 time=3ms TTL=64\n\nPing statistics for 192.168.178.1:\n    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),\nApproximate round trip times in milli-seconds:\n    Minimum = 2ms, Maximum = 3ms, Average = 2ms\nPS C:\\Users\\Peng Xiao>",lang:"unknown"}),l.a.createElement("h4",{id:"telnet\u547d\u4ee4"},l.a.createElement(r["AnchorLink"],{to:"#telnet\u547d\u4ee4","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"telnet\u547d\u4ee4"),l.a.createElement("p",null,"\u6d4b\u8bd5\u7aef\u53e3\u7684\u8fde\u901a\u6027"),l.a.createElement(c["a"],{code:"\u279c  ~ telnet www.baidu.com 80\nTrying 104.193.88.123...\nConnected to www.wshifen.com.\nEscape character is '^]'.\n\nHTTP/1.1 400 Bad Request\n\nConnection closed by foreign host.\n\u279c  ~",lang:"shell"}),l.a.createElement("h4",{id:"traceroute"},l.a.createElement(r["AnchorLink"],{to:"#traceroute","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"traceroute"),l.a.createElement("p",null,"\u8def\u5f84\u63a2\u6d4b\u8ddf\u8e2a"),l.a.createElement("p",null,"Linux\u4e0b\u4f7f\u7528 ",l.a.createElement("code",null,"tracepath")),l.a.createElement(c["a"],{code:"\u279c  ~ tracepath www.baidu.com\n1?: [LOCALHOST]                      pmtu 1500\n1:  DESKTOP-FQ0EO8J                                       0.430ms\n1:  DESKTOP-FQ0EO8J                                       0.188ms\n2:  192.168.178.1                                         3.371ms\n3:  no reply\n4:  gv-rc0052-cr102-et91-251.core.as33915.net            13.970ms\n5:  asd-tr0021-cr101-be156-10.core.as9143.net            19.190ms\n6:  nl-ams04a-ri3-ae51-0.core.as9143.net                213.589ms\n7:  63.218.65.33                                         16.887ms\n8:  HundredGE0-6-0-0.br04.sjo01.pccwbtn.net             176.099ms asymm 10\n9:  HundredGE0-6-0-0.br04.sjo01.pccwbtn.net             173.399ms asymm 10\n10:  63-219-23-98.static.pccwglobal.net                  177.337ms asymm 11\n11:  104.193.88.13                                       178.197ms asymm 12\n12:  no reply\n13:  no reply\n14:  no reply\n15:  no reply\n16:  no reply\n17:  no reply\n18:  no reply\n19:  no reply\n20:  no reply\n21:  no reply\n22:  no reply\n23:  no reply\n24:  no reply\n25:  no reply\n26:  no reply\n27:  no reply\n28:  no reply\n29:  no reply\n30:  no reply\n    Too many hops: pmtu 1500\n    Resume: pmtu 1500\n\u279c  ~",lang:"unknown"}),l.a.createElement("p",null,"Windows\u4e0b\u4f7f\u7528 ",l.a.createElement("code",null,"TRACERT.EXE")),l.a.createElement(c["a"],{code:"PS C:\\Users\\Peng Xiao> TRACERT.EXE www.baidu.com\n\nTracing route to www.wshifen.com [104.193.88.123]\nover a maximum of 30 hops:\n\n1     4 ms     3 ms     3 ms  192.168.178.1\n2     *        *        *     Request timed out.\n3    21 ms    18 ms    19 ms  gv-rc0052-cr102-et91-251.core.as33915.net [213.51.197.37]\n4    14 ms    13 ms    12 ms  asd-tr0021-cr101-be156-10.core.as9143.net [213.51.158.2]\n5    23 ms    19 ms    14 ms  nl-ams04a-ri3-ae51-0.core.as9143.net [213.51.64.194]\n6    15 ms    14 ms    13 ms  63.218.65.33\n7   172 ms   169 ms   167 ms  HundredGE0-6-0-0.br04.sjo01.pccwbtn.net [63.223.60.58]\n8   167 ms   168 ms   168 ms  HundredGE0-6-0-0.br04.sjo01.pccwbtn.net [63.223.60.58]\n9   168 ms   173 ms   167 ms  63-219-23-98.static.pccwglobal.net [63.219.23.98]\n10   172 ms   170 ms   171 ms",lang:"unknown"}),l.a.createElement("h4",{id:"curl\u547d\u4ee4"},l.a.createElement(r["AnchorLink"],{to:"#curl\u547d\u4ee4","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"curl\u547d\u4ee4"),l.a.createElement("p",null,"\u8bf7\u6c42web\u670d\u52a1\u7684"),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"http://www.ruanyifeng.com/blog/2019/09/curl-reference.html"},"http://www.ruanyifeng.com/blog/2019/09/curl-reference.html")),l.a.createElement("h2",{id:"63-docker-bridge-\u7f51\u7edc"},l.a.createElement(r["AnchorLink"],{to:"#63-docker-bridge-\u7f51\u7edc","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"6.3 Docker Bridge \u7f51\u7edc"),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-14-032225.png",alt:"docker-volume"})),l.a.createElement("h3",{id:"\u521b\u5efa\u4e24\u4e2a\u5bb9\u5668"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efa\u4e24\u4e2a\u5bb9\u5668","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u4e24\u4e2a\u5bb9\u5668"),l.a.createElement(c["a"],{code:'$ docker container run -d --rm --name box1 busybox /bin/sh -c "while true; do sleep 3600; done"\n$ docker container run -d --rm --name box2 busybox /bin/sh -c "while true; do sleep 3600; done"\n$ docker container ls\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES\n4f3303c84e53   busybox   "/bin/sh -c \'while t\u2026"   49 minutes ago   Up 49 minutes             box2\n03494b034694   busybox   "/bin/sh -c \'while t\u2026"   49 minutes ago   Up 49 minutes             box1',lang:"shell"}),l.a.createElement("h3",{id:"\u5bb9\u5668\u95f4\u901a\u4fe1"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u95f4\u901a\u4fe1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u95f4\u901a\u4fe1"),l.a.createElement("p",null,"\u4e24\u4e2a\u5bb9\u5668\u90fd\u8fde\u63a5\u5230\u4e86\u4e00\u4e2a\u53eb docker0 \u7684Linux bridge\u4e0a"),l.a.createElement(c["a"],{code:'$ docker network ls\nNETWORK ID     NAME      DRIVER    SCOPE\n1847e179a316   bridge    bridge    local\na647a4ad0b4f   host      host      local\nfbd81b56c009   none      null      local\n$ docker network inspect bridge\n[\n    {\n        "Name": "bridge",\n        "Id": "1847e179a316ee5219c951c2c21cf2c787d431d1ffb3ef621b8f0d1edd197b24",\n        "Created": "2021-07-01T15:28:09.265408946Z",\n        "Scope": "local",\n        "Driver": "bridge",\n        "EnableIPv6": false,\n        "IPAM": {\n            "Driver": "default",\n            "Options": null,\n            "Config": [\n                {\n                    "Subnet": "172.17.0.0/16",\n                    "Gateway": "172.17.0.1"\n                }\n            ]\n        },\n        "Internal": false,\n        "Attachable": false,\n        "Ingress": false,\n        "ConfigFrom": {\n            "Network": ""\n        },\n        "ConfigOnly": false,\n        "Containers": {\n            "03494b034694982fa085cc4052b6c7b8b9c046f9d5f85f30e3a9e716fad20741": {\n                "Name": "box1",\n                "EndpointID": "072160448becebb7c9c333dce9bbdf7601a92b1d3e7a5820b8b35976cf4fd6ff",\n                "MacAddress": "02:42:ac:11:00:02",\n                "IPv4Address": "172.17.0.2/16",\n                "IPv6Address": ""\n            },\n            "4f3303c84e5391ea37db664fd08683b01decdadae636aaa1bfd7bb9669cbd8de": {\n                "Name": "box2",\n                "EndpointID": "4cf0f635d4273066acd3075ec775e6fa405034f94b88c1bcacdaae847612f2c5",\n                "MacAddress": "02:42:ac:11:00:03",\n                "IPv4Address": "172.17.0.3/16",\n                "IPv6Address": ""\n            }\n        },\n        "Options": {\n            "com.docker.network.bridge.default_bridge": "true",\n            "com.docker.network.bridge.enable_icc": "true",\n            "com.docker.network.bridge.enable_ip_masquerade": "true",\n            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",\n            "com.docker.network.bridge.name": "docker0",\n            "com.docker.network.driver.mtu": "1500"\n        },\n        "Labels": {}\n    }\n]',lang:"shell"}),l.a.createElement("blockquote",null,l.a.createElement(c["a"],{code:"brctl` \u4f7f\u7528\u524d\u9700\u8981\u5b89\u88c5, \u5bf9\u4e8eCentOS, \u53ef\u4ee5\u901a\u8fc7 `sudo yum install -y bridge-utils` \u5b89\u88c5. \u5bf9\u4e8eUbuntu, \u53ef\u4ee5\u901a\u8fc7 `sudo apt-get install -y bridge-utils",lang:"unknown"})),l.a.createElement(c["a"],{code:"$ brctl show\nbridge name     bridge id               STP enabled     interfaces\ndocker0         8000.0242759468cf       no              veth8c9bb82\n                                                        vethd8f9afb",lang:"shell"}),l.a.createElement("h3",{id:"\u5bb9\u5668\u5bf9\u5916\u901a\u4fe1"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u5bf9\u5916\u901a\u4fe1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u5bf9\u5916\u901a\u4fe1"),l.a.createElement("p",null,"\u67e5\u770b\u8def\u7531"),l.a.createElement(c["a"],{code:"$ ip route\ndefault via 10.0.2.2 dev eth0 proto dhcp metric 100\n10.0.2.0/24 dev eth0 proto kernel scope link src 10.0.2.15 metric 100\n172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1\n192.168.200.0/24 dev eth1 proto kernel scope link src 192.168.200.10 metric 101",lang:"shell"}),l.a.createElement("p",null,"iptable ",l.a.createElement(r["Link"],{to:"https://dockertips.readthedocs.io/en/latest/single-host-network/docker-bridge.html#f4"},"1")," \u8f6c\u53d1\u89c4\u5219"),l.a.createElement(c["a"],{code:"$ sudo iptables --list -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination\nDOCKER     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL\n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDOCKER     all  --  anywhere            !loopback/8           ADDRTYPE match dst-type LOCAL\n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination\nMASQUERADE  all  --  172.17.0.0/16        anywhere\n\nChain DOCKER (2 references)\ntarget     prot opt source               destination\nRETURN     all  --  anywhere             anywhere",lang:"shell"}),l.a.createElement("h3",{id:"\u7aef\u53e3\u8f6c\u53d1"},l.a.createElement(r["AnchorLink"],{to:"#\u7aef\u53e3\u8f6c\u53d1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u7aef\u53e3\u8f6c\u53d1"),l.a.createElement("p",null,"\u521b\u5efa\u5bb9\u5668"),l.a.createElement(c["a"],{code:"$ docker container run -d --rm --name web -p 8080:80 nginx\n$ docker container inspect --format '{{.NetworkSettings.IPAddress}}' web\n$ docker container run -d --rm --name client busybox /bin/sh -c \"while true; do sleep 3600; done\"\n$ docker container inspect --format '{{.NetworkSettings.IPAddress}}' client\n$ docker container exec -it client wget http://172.17.0.2",lang:"shell"}),l.a.createElement("p",null,"\u67e5\u770biptables\u7684\u7aef\u53e3\u8f6c\u53d1\u89c4\u5219"),l.a.createElement(c["a"],{code:"[vagrant@docker-host1 ~]$ sudo iptables -t nat -nvxL\nChain PREROUTING (policy ACCEPT 10 packets, 1961 bytes)\n    pkts      bytes target     prot opt in     out     source               destination\n    1       52 DOCKER     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL\n\nChain INPUT (policy ACCEPT 9 packets, 1901 bytes)\n    pkts      bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 2 packets, 120 bytes)\n    pkts      bytes target     prot opt in     out     source               destination\n    0        0 DOCKER     all  --  *      *       0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL\n\nChain POSTROUTING (policy ACCEPT 4 packets, 232 bytes)\n    pkts      bytes target     prot opt in     out     source               destination\n    3      202 MASQUERADE  all  --  *      !docker0  172.17.0.0/16        0.0.0.0/0\n    0        0 MASQUERADE  tcp  --  *      *       172.17.0.2           172.17.0.2           tcp dpt:80\n\nChain DOCKER (2 references)\n    pkts      bytes target     prot opt in     out     source               destination\n    0        0 RETURN     all  --  docker0 *       0.0.0.0/0            0.0.0.0/0\n    1       52 DNAT       tcp  --  !docker0 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8080 to:172.17.0.2:80",lang:"shell"}),l.a.createElement("h1",{id:"7-docker-compose"},l.a.createElement(r["AnchorLink"],{to:"#7-docker-compose","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7. Docker Compose"),l.a.createElement("h2",{id:"71-\u4ecb\u7ecd"},l.a.createElement(r["AnchorLink"],{to:"#71-\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7.1 \u4ecb\u7ecd"),l.a.createElement("p",null,l.a.createElement("img",{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2021-11-14-032816.png",alt:"docker-compose-intro"})),l.a.createElement("h2",{id:"72-docker-compose-\u7684\u5b89\u88c5"},l.a.createElement(r["AnchorLink"],{to:"#72-docker-compose-\u7684\u5b89\u88c5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7.2 docker compose \u7684\u5b89\u88c5"),l.a.createElement("p",null,"Windows\u548cMac\u5728\u9ed8\u8ba4\u5b89\u88c5\u4e86docker desktop\u4ee5\u540e\uff0cdocker-compose\u968f\u4e4b\u81ea\u52a8\u5b89\u88c5"),l.a.createElement(c["a"],{code:"PS C:\\Users\\Peng Xiao\\docker.tips> docker-compose --version\ndocker-compose version 1.29.2, build 5becea4c",lang:"shell"}),l.a.createElement("p",null,"Linux\u7528\u6237\u9700\u8981\u81ea\u884c\u5b89\u88c5"),l.a.createElement("p",null,"\u6700\u65b0\u7248\u672c\u53f7\u53ef\u4ee5\u5728\u8fd9\u91cc\u67e5\u8be2 ",l.a.createElement(r["Link"],{to:"https://github.com/docker/compose/releases"},"https://github.com/docker/compose/releases")),l.a.createElement(c["a"],{code:'$ sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n$ sudo chmod +x /usr/local/bin/docker-compose\n$ docker-compose --version\ndocker-compose version 1.29.2, build 5becea4c',lang:"shell"}),l.a.createElement("p",null,"\u719f\u6089python\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u4f7f\u7528pip\u53bb\u5b89\u88c5docker-Compose"),l.a.createElement(c["a"],{code:"$ pip install docker-compose",lang:"shell"}),l.a.createElement("h2",{id:"73-compose-\u6587\u4ef6\u7684\u7ed3\u6784\u548c\u7248\u672c"},l.a.createElement(r["AnchorLink"],{to:"#73-compose-\u6587\u4ef6\u7684\u7ed3\u6784\u548c\u7248\u672c","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7.3 compose \u6587\u4ef6\u7684\u7ed3\u6784\u548c\u7248\u672c"),l.a.createElement("h3",{id:"compose-\u6587\u4ef6\u7684\u7ed3\u6784\u548c\u7248\u672c"},l.a.createElement(r["AnchorLink"],{to:"#compose-\u6587\u4ef6\u7684\u7ed3\u6784\u548c\u7248\u672c","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"compose \u6587\u4ef6\u7684\u7ed3\u6784\u548c\u7248\u672c"),l.a.createElement("p",null,"docker compose\u6587\u4ef6\u7684\u8bed\u6cd5\u8bf4\u660e ",l.a.createElement(r["Link"],{to:"https://docs.docker.com/compose/compose-file/"},"https://docs.docker.com/compose/compose-file/")),l.a.createElement("h3",{id:"\u57fa\u672c\u8bed\u6cd5\u7ed3\u6784"},l.a.createElement(r["AnchorLink"],{to:"#\u57fa\u672c\u8bed\u6cd5\u7ed3\u6784","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u57fa\u672c\u8bed\u6cd5\u7ed3\u6784"),l.a.createElement(c["a"],{code:'version: "3.8"\n\nservices: # \u5bb9\u5668\n  servicename: # \u670d\u52a1\u540d\u5b57\uff0c\u8fd9\u4e2a\u540d\u5b57\u4e5f\u662f\u5185\u90e8 bridge\u7f51\u7edc\u53ef\u4ee5\u4f7f\u7528\u7684 DNS name\n    image: # \u955c\u50cf\u7684\u540d\u5b57\n    command: # \u53ef\u9009\uff0c\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u4f1a\u8986\u76d6\u9ed8\u8ba4\u955c\u50cf\u91cc\u7684 CMD\u547d\u4ee4\n    environment: # \u53ef\u9009\uff0c\u76f8\u5f53\u4e8e docker run\u91cc\u7684 --env\n    volumes: # \u53ef\u9009\uff0c\u76f8\u5f53\u4e8edocker run\u91cc\u7684 -v\n    networks: # \u53ef\u9009\uff0c\u76f8\u5f53\u4e8e docker run\u91cc\u7684 --network\n    ports: # \u53ef\u9009\uff0c\u76f8\u5f53\u4e8e docker run\u91cc\u7684 -p\n  servicename2:\n\nvolumes: # \u53ef\u9009\uff0c\u76f8\u5f53\u4e8e docker volume create\n\nnetworks: # \u53ef\u9009\uff0c\u76f8\u5f53\u4e8e docker network create',lang:"yml"}),l.a.createElement("p",null,"\u4ee5 Python Flask + Redis\u7ec3\u4e60\uff1a\u4e3a\u4f8b\u5b50\uff0c\u6539\u9020\u6210\u4e00\u4e2adocker-compose\u6587\u4ef6"),l.a.createElement(c["a"],{code:"docker image pull redis\ndocker image build -t flask-demo .\n\n# create network\ndocker network create -d bridge demo-network\n\n# create container\ndocker container run -d --name redis-server --network demo-network redis\ndocker container run -d --network demo-network --name flask-demo --env REDIS_HOST=redis-server -p 5000:5000 flask-demo",lang:"shell"}),l.a.createElement("p",null,"docker-compose.yml \u6587\u4ef6\u5982\u4e0b"),l.a.createElement(c["a"],{code:'version: "3.8"\n\nservices:\n  flask-demo:\n    image: flask-demo:latest\n    environment:\n      - REDIS_HOST=redis-server\n    networks:\n      - demo-network\n    ports:\n      - 8080:5000\n\n  redis-server:\n    image: redis:latest\n    networks:\n     - demo-network\n\nnetworks:\n  demo-network:',lang:"yml"}),l.a.createElement("h3",{id:"docker-compose-\u8bed\u6cd5\u7248\u672c"},l.a.createElement(r["AnchorLink"],{to:"#docker-compose-\u8bed\u6cd5\u7248\u672c","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"docker-compose \u8bed\u6cd5\u7248\u672c"),l.a.createElement("p",null,"\u5411\u540e\u517c\u5bb9"),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"https://docs.docker.com/compose/compose-file/"},"https://docs.docker.com/compose/compose-file/")),l.a.createElement("h2",{id:"74-docker-compose-\u6c34\u5e73\u6269\u5c55"},l.a.createElement(r["AnchorLink"],{to:"#74-docker-compose-\u6c34\u5e73\u6269\u5c55","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7.4 docker compose \u6c34\u5e73\u6269\u5c55"),l.a.createElement("h3",{id:"\u73af\u5883\u6e05\u7406-1"},l.a.createElement(r["AnchorLink"],{to:"#\u73af\u5883\u6e05\u7406-1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u6e05\u7406"),l.a.createElement("p",null,"\u5220\u9664\u6240\u6709\u5bb9\u5668\u548c\u955c\u50cf"),l.a.createElement(c["a"],{code:"$ docker container rm -f $(docker container ps -aq)\n$ docker system prune -a -f",lang:"shell"}),l.a.createElement("h3",{id:"\u542f\u52a8"},l.a.createElement(r["AnchorLink"],{to:"#\u542f\u52a8","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u542f\u52a8"),l.a.createElement("p",null,"\u4e0b\u8f7d\u6e90\u7801\uff0c\u8fdb\u5165\u6e90\u7801\u76ee\u5f55"),l.a.createElement(c["a"],{code:'$ docker-compose pull\n$ docker-compose build\n$ docker-compose up -d\nCreating network "compose-scale-example_default" with the default driver\nCreating compose-scale-example_flask_1        ... done\nCreating compose-scale-example_client_1       ... done\nCreating compose-scale-example_redis-server_1 ... done\n$ docker-compose ps\n                Name                              Command               State    Ports\n----------------------------------------------------------------------------------------\ncompose-scale-example_client_1         sh -c while true; do sleep ...   Up\ncompose-scale-example_flask_1          flask run -h 0.0.0.0             Up      5000/tcp\ncompose-scale-example_redis-server_1   docker-entrypoint.sh redis ...   Up      6379/tcp',lang:"shell"}),l.a.createElement("h3",{id:"\u6c34\u5e73\u6269\u5c55-scale"},l.a.createElement(r["AnchorLink"],{to:"#\u6c34\u5e73\u6269\u5c55-scale","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6c34\u5e73\u6269\u5c55 scale"),l.a.createElement(c["a"],{code:"$ docker-compose up -d --scale flask=3\ncompose-scale-example_client_1 is up-to-date\ncompose-scale-example_redis-server_1 is up-to-date\nCreating compose-scale-example_flask_2 ... done\nCreating compose-scale-example_flask_3 ... done\n$ docker-compose ps\n                Name                              Command               State    Ports\n----------------------------------------------------------------------------------------\ncompose-scale-example_client_1         sh -c while true; do sleep ...   Up\ncompose-scale-example_flask_1          flask run -h 0.0.0.0             Up      5000/tcp\ncompose-scale-example_flask_2          flask run -h 0.0.0.0             Up      5000/tcp\ncompose-scale-example_flask_3          flask run -h 0.0.0.0             Up      5000/tcp\ncompose-scale-example_redis-server_1   docker-entrypoint.sh redis ...   Up      6379/tcp",lang:"shell"}),l.a.createElement("h2",{id:"75-docker-compose-\u73af\u5883\u53d8\u91cf"},l.a.createElement(r["AnchorLink"],{to:"#75-docker-compose-\u73af\u5883\u53d8\u91cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7.5 docker compose \u73af\u5883\u53d8\u91cf"),l.a.createElement("p",null,"\u53c2\u8003\u6587\u6863\uff1a",l.a.createElement(r["Link"],{to:"https://docs.docker.com/compose/environment-variables/"},"https://docs.docker.com/compose/environment-variables/")),l.a.createElement("h2",{id:"76-docker-compose-\u670d\u52a1\u4f9d\u8d56\u548c\u5065\u5eb7\u68c0\u67e5"},l.a.createElement(r["AnchorLink"],{to:"#76-docker-compose-\u670d\u52a1\u4f9d\u8d56\u548c\u5065\u5eb7\u68c0\u67e5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7.6 docker compose \u670d\u52a1\u4f9d\u8d56\u548c\u5065\u5eb7\u68c0\u67e5"),l.a.createElement("p",null,"Dockerfile healthcheck ",l.a.createElement(r["Link"],{to:"https://docs.docker.com/engine/reference/builder/#healthcheck"},"https://docs.docker.com/engine/reference/builder/#healthcheck")),l.a.createElement("p",null,"docker compose ",l.a.createElement(r["Link"],{to:"https://docs.docker.com/compose/compose-file/compose-file-v3/#healthcheck"},"https://docs.docker.com/compose/compose-file/compose-file-v3/#healthcheck")),l.a.createElement("p",null,"\u5065\u5eb7\u68c0\u67e5\u662f\u5bb9\u5668\u8fd0\u884c\u72b6\u6001\u7684\u9ad8\u7ea7\u68c0\u67e5\uff0c\u4e3b\u8981\u662f\u68c0\u67e5\u5bb9\u5668\u6240\u8fd0\u884c\u7684\u8fdb\u7a0b\u662f\u5426\u80fd\u6b63\u5e38\u7684\u5bf9\u5916\u63d0\u4f9b\u201c\u670d\u52a1\u201d\uff0c\u6bd4\u5982\u4e00\u4e2a\u6570\u636e\u5e93\u5bb9\u5668\uff0c\u6211\u4eec\u4e0d\u5149 \u9700\u8981\u8fd9\u4e2a\u5bb9\u5668\u662fup\u7684\u72b6\u6001\uff0c\u6211\u4eec\u8fd8\u8981\u6c42\u8fd9\u4e2a\u5bb9\u5668\u7684\u6570\u636e\u5e93\u8fdb\u7a0b\u80fd\u591f\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u5065\u5eb7\u68c0\u67e5\u3002"),l.a.createElement("h3",{id:"\u5bb9\u5668\u7684\u5065\u5eb7\u68c0\u67e5"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u7684\u5065\u5eb7\u68c0\u67e5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u7684\u5065\u5eb7\u68c0\u67e5"),l.a.createElement("p",null,"\u5bb9\u5668\u672c\u8eab\u6709\u4e00\u4e2a\u5065\u5eb7\u68c0\u67e5\u7684\u529f\u80fd\uff0c\u4f46\u662f\u9700\u8981\u5728Dockerfile\u91cc\u5b9a\u4e49\uff0c\u6216\u8005\u5728\u6267\u884cdocker container run \u7684\u65f6\u5019\uff0c\u901a\u8fc7\u4e0b\u9762\u7684\u4e00\u4e9b\u53c2\u6570\u6307\u5b9a"),l.a.createElement(c["a"],{code:"--health-cmd string              Command to run to check health\n--health-interval duration       Time between running the check\n                                (ms|s|m|h) (default 0s)\n--health-retries int             Consecutive failures needed to\n                                report unhealthy\n--health-start-period duration   Start period for the container to\n                                initialize before starting\n                                health-retries countdown\n                                (ms|s|m|h) (default 0s)\n--health-timeout duration        Maximum time to allow one check to",lang:"shell"}),l.a.createElement("h3",{id:"\u793a\u4f8b\u6e90\u7801"},l.a.createElement(r["AnchorLink"],{to:"#\u793a\u4f8b\u6e90\u7801","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u793a\u4f8b\u6e90\u7801"),l.a.createElement("p",null,"\u6211\u4eec\u4ee5\u4e0b\u9762\u7684\u8fd9\u4e2aflask\u5bb9\u5668\u4e3a\u4f8b\uff0c\u76f8\u5173\u7684\u4ee3\u7801\u5982\u4e0b"),l.a.createElement(c["a"],{code:"PS C:\\Users\\Peng Xiao\\code-demo\\compose-env\\flask> dir\n\n\n    \u76ee\u5f55: C:\\Users\\Peng Xiao\\code-demo\\compose-env\\flask\n\n\nMode                 LastWriteTime         Length Name\n----                 -------------         ------ ----\n-a----         2021/7/13     15:52            448 app.py\n-a----         2021/7/14      0:32            471 Dockerfile\n\n\nPS C:\\Users\\Peng Xiao\\code-demo\\compose-env\\flask> more .\\app.py\nfrom flask import Flask\nfrom redis import StrictRedis\nimport os\nimport socket\n\napp = Flask(__name__)\nredis = StrictRedis(host=os.environ.get('REDIS_HOST', '127.0.0.1'),\n                    port=6379, password=os.environ.get('REDIS_PASS'))\n\n\n@app.route('/')\ndef hello():\n    redis.incr('hits')\n    return f\"Hello Container World! I have been seen {redis.get('hits').decode('utf-8')} times and my hostname is {socket.gethostname()}.\\n\"\n\nPS C:\\Users\\Peng Xiao\\code-demo\\compose-env\\flask> more .\\Dockerfile\nFROM python:3.9.5-slim\n\nRUN pip install flask redis && \\\n    apt-get update && \\\n    apt-get install -y curl && \\\n    groupadd -r flask && useradd -r -g flask flask && \\\n    mkdir /src && \\\n    chown -R flask:flask /src\n\nUSER flask\n\nCOPY app.py /src/app.py\n\nWORKDIR /src\n\nENV FLASK_APP=app.py REDIS_HOST=redis\n\nEXPOSE 5000\n\nHEALTHCHECK --interval=30s --timeout=3s \\\n    CMD curl -f http://localhost:5000/ || exit 1\n\nCMD [\"flask\", \"run\", \"-h\", \"0.0.0.0\"]",lang:"shell"}),l.a.createElement("p",null,"\u4e0a\u9762Dockerfili\u91cc\u7684HEALTHCHECK \u5c31\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5065\u5eb7\u68c0\u67e5\u3002 \u4f1a\u6bcf\u969430\u79d2\u68c0\u67e5\u4e00\u6b21\uff0c\u5982\u679c\u5931\u8d25\u5c31\u4f1a\u9000\u51fa\uff0c\u9000\u51fa\u4ee3\u7801\u662f1"),l.a.createElement("h3",{id:"\u6784\u5efa\u955c\u50cf\u548c\u521b\u5efa\u5bb9\u5668"},l.a.createElement(r["AnchorLink"],{to:"#\u6784\u5efa\u955c\u50cf\u548c\u521b\u5efa\u5bb9\u5668","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6784\u5efa\u955c\u50cf\u548c\u521b\u5efa\u5bb9\u5668"),l.a.createElement("p",null,"\u6784\u5efa\u955c\u50cf\uff0c\u521b\u5efa\u4e00\u4e2abridge\u7f51\u7edc\uff0c\u7136\u540e\u542f\u52a8\u5bb9\u5668\u8fde\u5230bridge\u7f51\u7edc"),l.a.createElement(c["a"],{code:"$ docker image build -t flask-demo .\n$ docker network create mybridge\n$ docker container run -d --network mybridge --env REDIS_PASS=abc123 flask-demo",lang:"unknown"}),l.a.createElement("p",null,"\u67e5\u770b\u5bb9\u5668\u72b6\u6001"),l.a.createElement(c["a"],{code:'$ docker container ls\nCONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS                            PORTS      NAMES\n059c12486019   flask-demo   "flask run -h 0.0.0.0"   4 hours ago   Up 8 seconds (health: starting)   5000/tcp   dazzling_tereshkova',lang:"unknown"}),l.a.createElement("p",null,"\u4e5f\u53ef\u4ee5\u901a\u8fc7docker container inspect 059 \u67e5\u770b\u8be6\u60c5\uff0c \u5176\u4e2d\u6709\u6709\u5173health\u7684"),l.a.createElement(c["a"],{code:'"Health": {\n"Status": "starting",\n"FailingStreak": 1,\n"Log": [\n    {\n        "Start": "2021-07-14T19:04:46.4054004Z",\n        "End": "2021-07-14T19:04:49.4055393Z",\n        "ExitCode": -1,\n        "Output": "Health check exceeded timeout (3s)"\n    }\n]',lang:"unknown"}),l.a.createElement("p",null,"\u7ecf\u8fc73\u6b21\u68c0\u67e5\uff0c\u4e00\u76f4\u662f\u4e0d\u901a\u7684\uff0c\u7136\u540ehealth\u7684\u72b6\u6001\u4f1a\u4ecestarting\u53d8\u4e3a unhealthy"),l.a.createElement(c["a"],{code:'docker container ls\nCONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS                     PORTS      NAMES\n059c12486019   flask-demo   "flask run -h 0.0.0.0"   4 hours ago   Up 2 minutes (unhealthy)   5000/tcp   dazzling_tereshkova',lang:"unknown"}),l.a.createElement("h3",{id:"\u542f\u52a8redis\u670d\u52a1\u5668"},l.a.createElement(r["AnchorLink"],{to:"#\u542f\u52a8redis\u670d\u52a1\u5668","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u542f\u52a8redis\u670d\u52a1\u5668"),l.a.createElement("p",null,"\u542f\u52a8redis\uff0c\u8fde\u5230mybridge\u4e0a\uff0cname=redis\uff0c \u6ce8\u610f\u5bc6\u7801"),l.a.createElement(c["a"],{code:"$ docker container run -d --network mybridge --name redis redis:latest redis-server --requirepass abc123",lang:"unknown"}),l.a.createElement("p",null,"\u7ecf\u8fc7\u51e0\u79d2\u949f\uff0c\u6211\u4eec\u7684flask \u53d8\u6210\u4e86healthy"),l.a.createElement(c["a"],{code:'$ docker container ls\nCONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                   PORTS      NAMES\nbc4e826ee938   redis:latest   "docker-entrypoint.s\u2026"   18 seconds ago   Up 16 seconds            6379/tcp   redis\n059c12486019   flask-demo     "flask run -h 0.0.0.0"   4 hours ago      Up 6 minutes (healthy)   5000/tcp   dazzling_tereshkova',lang:"shell"}),l.a.createElement("h3",{id:"docker-compose-\u5065\u5eb7\u68c0\u67e5"},l.a.createElement(r["AnchorLink"],{to:"#docker-compose-\u5065\u5eb7\u68c0\u67e5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"docker-compose \u5065\u5eb7\u68c0\u67e5"),l.a.createElement("p",null,"\u793a\u4f8b\u4ee3\u7801\u4e0b\u8f7d(flask healthcheck) ",l.a.createElement(r["Link"],{to:"https://dockertips.readthedocs.io/en/latest/_downloads/df3430ebd5e1f962f0c10136565257e1/compose-healthcheck-flask.zip"},l.a.createElement("code",null,"\u672c\u8282\u6e90\u7801"))),l.a.createElement("p",null,"\u793a\u4f8b\u4ee3\u7801\u4e0b\u8f7d(flask + redis healthcheck) ",l.a.createElement(r["Link"],{to:"https://dockertips.readthedocs.io/en/latest/_downloads/529c888c2faf46a0906548ed7510d12b/compose-healthcheck-redis.zip"},l.a.createElement("code",null,"\u672c\u8282\u6e90\u7801"))),l.a.createElement("p",null,"\u4e00\u4e2ahealthcheck\u4e0d\u9519\u7684\u4f8b\u5b50 ",l.a.createElement(r["Link"],{to:"https://gist.github.com/phuysmans/4f67a7fa1b0c6809a86f014694ac6c3a"},"https://gist.github.com/phuysmans/4f67a7fa1b0c6809a86f014694ac6c3a")),l.a.createElement("h1",{id:"8-docker-swarm"},l.a.createElement(r["AnchorLink"],{to:"#8-docker-swarm","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8. Docker Swarm"),l.a.createElement("h2",{id:"81-docker-swarm-\u4ecb\u7ecd"},l.a.createElement(r["AnchorLink"],{to:"#81-docker-swarm-\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.1 Docker Swarm \u4ecb\u7ecd"),l.a.createElement("h3",{id:"\u4e3a\u4ec0\u4e48\u4e0d\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528-docker-compose"},l.a.createElement(r["AnchorLink"],{to:"#\u4e3a\u4ec0\u4e48\u4e0d\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528-docker-compose","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u4e3a\u4ec0\u4e48\u4e0d\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 docker-compose"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u591a\u673a\u5668\u5982\u4f55\u7ba1\u7406\uff1f"),l.a.createElement("li",null,"\u5982\u679c\u8de8\u673a\u5668\u505ascale\u6a2a\u5411\u6269\u5c55\uff1f"),l.a.createElement("li",null,"\u5bb9\u5668\u5931\u8d25\u9000\u51fa\u65f6\u5982\u4f55\u65b0\u5efa\u5bb9\u5668\u786e\u4fdd\u670d\u52a1\u6b63\u5e38\u8fd0\u884c\uff1f"),l.a.createElement("li",null,"\u5982\u4f55\u786e\u4fdd\u96f6\u5b95\u673a\u65f6\u95f4\uff1f"),l.a.createElement("li",null,"\u5982\u4f55\u7ba1\u7406\u5bc6\u7801\uff0ckey\u7b49\u654f\u611f\u6570\u636e\uff1f"),l.a.createElement("li",null,"\u5176\u4ed6")),l.a.createElement("h3",{id:"\u5bb9\u5668\u7f16\u6392-swarm"},l.a.createElement(r["AnchorLink"],{to:"#\u5bb9\u5668\u7f16\u6392-swarm","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5bb9\u5668\u7f16\u6392 swarm"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-023349.png",alt:"docker-swarm-intro"})),l.a.createElement("p",null,"Swarm\u7684\u57fa\u672c\u67b6\u6784"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-023522.png",alt:"docker-swarm-arch"})),l.a.createElement("h3",{id:"docker-swarm-vs-kubernetes"},l.a.createElement(r["AnchorLink"],{to:"#docker-swarm-vs-kubernetes","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"docker swarm vs kubernetes"),l.a.createElement("p",null,"k8s\u5728\u5bb9\u5668\u7f16\u6392\u9886\u57df\u5904\u4e8e\u7edd\u5bf9\u9886\u5148\u7684\u5730\u4f4d"),l.a.createElement("h2",{id:"82-swarm-\u5355\u8282\u70b9\u5feb\u901f\u4e0a\u624b"},l.a.createElement(r["AnchorLink"],{to:"#82-swarm-\u5355\u8282\u70b9\u5feb\u901f\u4e0a\u624b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.2 Swarm \u5355\u8282\u70b9\u5feb\u901f\u4e0a\u624b"),l.a.createElement("h3",{id:"\u521d\u59cb\u5316"},l.a.createElement(r["AnchorLink"],{to:"#\u521d\u59cb\u5316","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521d\u59cb\u5316"),l.a.createElement("p",null,l.a.createElement("code",null,"docker info")," \u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u6211\u4eec\u7684docker engine\u6709\u6ca1\u6709\u6fc0\u6d3bswarm\u6a21\u5f0f\uff0c \u9ed8\u8ba4\u662f\u6ca1\u6709\u7684\uff0c\u6211\u4eec\u4f1a\u770b\u5230"),l.a.createElement(c["a"],{code:"Swarm: inactive",lang:"unknown"}),l.a.createElement("p",null,"\u6fc0\u6d3bswarm\uff0c\u6709\u4e24\u4e2a\u65b9\u6cd5\uff1a"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u521d\u59cb\u5316\u4e00\u4e2aswarm\u96c6\u7fa4\uff0c\u81ea\u5df1\u6210\u4e3amanager"),l.a.createElement("li",null,"\u52a0\u5165\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684swarm\u96c6\u7fa4")),l.a.createElement(c["a"],{code:"PS C:\\Users\\Peng Xiao\\code-demo> docker swarm init\nSwarm initialized: current node (vjtstrkxntsacyjtvl18hcbe4) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-33ci17l1n34fh6v4r1qq8qmocjo347saeuer2xrxflrn25jgjx-7vphgu8a0gsa4anof6ffrgwqb 192.168.65.3:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n\nPS C:\\Users\\Peng Xiao\\code-demo> docker node ls\nID                            HOSTNAME         STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\nvjtstrkxntsacyjtvl18hcbe4 *   docker-desktop   Ready     Active         Leader           20.10.7\nPS C:\\Users\\Peng Xiao\\code-demo>",lang:"unknown"}),l.a.createElement("h3",{id:"docker-swarm-init-\u80cc\u540e\u53d1\u751f\u4e86\u4ec0\u4e48"},l.a.createElement(r["AnchorLink"],{to:"#docker-swarm-init-\u80cc\u540e\u53d1\u751f\u4e86\u4ec0\u4e48","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"docker swarm init \u80cc\u540e\u53d1\u751f\u4e86\u4ec0\u4e48"),l.a.createElement("p",null,"\u4e3b\u8981\u662f PKI \u548c\u5b89\u5168\u76f8\u5173\u7684\u81ea\u52a8\u5316"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u521b\u5efaswarm\u96c6\u7fa4\u7684\u6839\u8bc1\u4e66"),l.a.createElement("li",null,"manager\u8282\u70b9\u7684\u8bc1\u4e66"),l.a.createElement("li",null,"\u5176\u5b83\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\u9700\u8981\u7684 tokens")),l.a.createElement("p",null,"\u521b\u5efaRaft\u6570\u636e\u5e93\u7528\u4e8e\u5b58\u50a8\u8bc1\u4e66\uff0c\u914d\u7f6e\uff0c\u5bc6\u7801\u7b49\u6570\u636e"),l.a.createElement("p",null,"RAFT\u76f8\u5173\u8d44\u6599"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement(r["Link"],{to:"http://thesecretlivesofdata.com/raft/"},"http://thesecretlivesofdata.com/raft/")),l.a.createElement("li",null,l.a.createElement(r["Link"],{to:"https://raft.github.io/"},"https://raft.github.io/")),l.a.createElement("li",null,l.a.createElement(r["Link"],{to:"https://docs.docker.com/engine/swarm/raft/"},"https://docs.docker.com/engine/swarm/raft/"))),l.a.createElement("p",null,"\u770b\u52a8\u753b\u5b66\u4f1a Raft \u7b97\u6cd5"),l.a.createElement("h2",{id:"83-swarm-\u4e09\u8282\u70b9\u96c6\u7fa4\u642d\u5efa"},l.a.createElement(r["AnchorLink"],{to:"#83-swarm-\u4e09\u8282\u70b9\u96c6\u7fa4\u642d\u5efa","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.3 Swarm \u4e09\u8282\u70b9\u96c6\u7fa4\u642d\u5efa"),l.a.createElement("p",null,"\u521b\u5efa3\u8282\u70b9swarm cluster\u7684\u65b9\u6cd5"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement(r["Link"],{to:"https://labs.play-with-docker.com/"},"https://labs.play-with-docker.com/")," play with docker \u7f51\u7ad9\uff0c \u4f18\u70b9\u662f\u5feb\u901f\u65b9\u4fbf\uff0c\u7f3a\u70b9\u662f\u73af\u5883\u4e0d\u6301\u4e45\uff0c4\u4e2a\u5c0f\u65f6\u540e\u73af\u5883\u4f1a\u88ab\u91cd\u7f6e"),l.a.createElement("li",null,"\u5728\u672c\u5730\u901a\u8fc7\u865a\u62df\u5316\u8f6f\u4ef6\u642d\u5efaLinux\u865a\u62df\u673a\uff0c\u4f18\u70b9\u662f\u7a33\u5b9a\uff0c\u65b9\u4fbf\uff0c\u7f3a\u70b9\u662f\u5360\u7528\u7cfb\u7edf\u8d44\u6e90\uff0c\u9700\u8981\u7535\u8111\u5185\u5b58\u6700\u597d8G\u53ca\u5176\u4ee5\u4e0a"),l.a.createElement("li",null,"\u5728\u4e91\u4e0a\u4f7f\u7528\u4e91\u4e3b\u673a\uff0c \u4e9a\u9a6c\u900a\uff0cGoogle\uff0c\u5fae\u8f6fAzure\uff0c\u963f\u91cc\u4e91\uff0c\u817e\u8baf\u4e91\u7b49\uff0c\u7f3a\u70b9\u662f\u9700\u8981\u6d88\u8017\u91d1\u94b1\uff08\u4f46\u662f\u6709\u4e9b\u4e91\u670d\u52a1\uff0c\u6709\u514d\u8d39\u8bd5\u7528\uff09")),l.a.createElement("p",null,"\u591a\u8282\u70b9\u7684\u73af\u5883\u6d89\u53ca\u5230\u673a\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u9700\u6c42\uff0c\u6240\u4ee5\u9632\u706b\u5899\u548c\u7f51\u7edc\u5b89\u5168\u7b56\u7565\u7ec4\u662f\u5927\u5bb6\u4e00\u5b9a\u8981\u8003\u8651\u7684\u95ee\u9898\uff0c\u7279\u522b\u662f\u5728\u4e91\u4e0a\u4f7f\u7528\u4e91\u4e3b\u673a\u7684\u60c5\u51b5\uff0c\u4e0b\u9762\u8fd9\u4e9b\u7aef\u53e3\u8bb0\u5f97\u6253\u5f00 ",l.a.createElement("code",null,"\u9632\u706b\u5899")," \u4ee5\u53ca ",l.a.createElement("code",null,"\u8bbe\u7f6e\u5b89\u5168\u7b56\u7565\u7ec4")),l.a.createElement("ul",null,l.a.createElement("li",null,"TCP port ",l.a.createElement("code",null,"2376")),l.a.createElement("li",null,"TCP port ",l.a.createElement("code",null,"2377")),l.a.createElement("li",null,"TCP and UDP port ",l.a.createElement("code",null,"7946")),l.a.createElement("li",null,"UDP port ",l.a.createElement("code",null,"4789"))),l.a.createElement("p",null,"\u4e3a\u4e86\u7b80\u5316\uff0c\u4ee5\u4e0a\u6240\u6709\u7aef\u53e3\u90fd\u5141\u8bb8\u8282\u70b9\u4e4b\u95f4\u81ea\u7531\u8bbf\u95ee\u5c31\u884c\u3002"),l.a.createElement("h2",{id:"84-swarm-\u7684-overlay-\u7f51\u7edc\u8be6\u89e3"},l.a.createElement(r["AnchorLink"],{to:"#84-swarm-\u7684-overlay-\u7f51\u7edc\u8be6\u89e3","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.4 Swarm \u7684 overlay \u7f51\u7edc\u8be6\u89e3"),l.a.createElement("p",null,"\u5bf9\u4e8e\u7406\u89e3swarm\u7684\u7f51\u7edc\u6765\u8bb2\uff0c\u4e2a\u4eba\u8ba4\u4e3a\u6700\u91cd\u8981\u7684\u4e24\u4e2a\u70b9\uff1a"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u7b2c\u4e00\u662f\u5916\u90e8\u5982\u4f55\u8bbf\u95ee\u90e8\u7f72\u8fd0\u884c\u5728swarm\u96c6\u7fa4\u5185\u7684\u670d\u52a1\uff0c\u53ef\u4ee5\u79f0\u4e4b\u4e3a ",l.a.createElement("code",null,"\u5165\u65b9\u5411")," \u6d41\u91cf\uff0c\u5728swarm\u91cc\u6211\u4eec\u901a\u8fc7 ",l.a.createElement("code",null,"ingress")," \u6765\u89e3\u51b3"),l.a.createElement("li",null,"\u7b2c\u4e8c\u662f\u90e8\u7f72\u5728swarm\u96c6\u7fa4\u91cc\u7684\u670d\u52a1\uff0c\u5982\u4f55\u5bf9\u5916\u8fdb\u884c\u8bbf\u95ee\uff0c\u8fd9\u90e8\u5206\u53c8\u5206\u4e3a\u4e24\u5757:",l.a.createElement("ul",null,l.a.createElement("li",null,"\u7b2c\u4e00\uff0c",l.a.createElement("code",null,"\u4e1c\u897f\u5411\u6d41\u91cf")," \uff0c\u4e5f\u5c31\u662f\u4e0d\u540cswarm\u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u4e4b\u95f4\u5982\u4f55\u901a\u4fe1\uff0cswarm\u901a\u8fc7 ",l.a.createElement("code",null,"overlay")," \u7f51\u7edc\u6765\u89e3\u51b3\uff1b"),l.a.createElement("li",null,"\u7b2c\u4e8c\uff0c",l.a.createElement("code",null,"\u5357\u5317\u5411\u6d41\u91cf")," \uff0c\u4e5f\u5c31\u662fswarm\u96c6\u7fa4\u91cc\u7684\u5bb9\u5668\u5982\u4f55\u5bf9\u5916\u8bbf\u95ee\uff0c\u6bd4\u5982\u4e92\u8054\u7f51\uff0c\u8fd9\u4e2a\u662f ",l.a.createElement("code",null,"Linux bridge + iptables NAT")," \u6765\u89e3\u51b3\u7684")))),l.a.createElement("h3",{id:"\u521b\u5efa-overlay-\u7f51\u7edc"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efa-overlay-\u7f51\u7edc","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa overlay \u7f51\u7edc"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker network create -d overlay mynet",lang:"unknown"}),l.a.createElement("p",null,"\u8fd9\u4e2a\u7f51\u7edc\u4f1a\u540c\u6b65\u5230\u6240\u6709\u7684swarm\u8282\u70b9\u4e0a"),l.a.createElement("h3",{id:"\u521b\u5efa\u670d\u52a1"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efa\u670d\u52a1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u670d\u52a1"),l.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2a\u670d\u52a1\u8fde\u63a5\u5230\u8fd9\u4e2a overlay\u7f51\u7edc\uff0c name \u662f test \uff0c replicas \u662f 2"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker service create --network mynet --name test --replicas 2 busybox ping 8.8.8.8\nvagrant@swarm-manager:~$ docker service ps test\nID             NAME      IMAGE            NODE            DESIRED STATE   CURRENT STATE            ERROR     PORTS\nyf5uqm1kzx6d   test.1    busybox:latest   swarm-worker1   Running         Running 18 seconds ago\n3tmp4cdqfs8a   test.2    busybox:latest   swarm-worker2   Running         Running 18 seconds ago",lang:"unknown"}),l.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\u8fd9\u4e24\u4e2a\u5bb9\u5668\u5206\u522b\u88ab\u521b\u5efa\u5728worker1\u548cworker2\u4e24\u4e2a\u8282\u70b9\u4e0a"),l.a.createElement("h3",{id:"\u7f51\u7edc\u67e5\u770b"},l.a.createElement(r["AnchorLink"],{to:"#\u7f51\u7edc\u67e5\u770b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u7f51\u7edc\u67e5\u770b"),l.a.createElement("p",null,"\u5230worker1\u548cworker2\u4e0a\u5206\u522b\u67e5\u770b\u5bb9\u5668\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5"),l.a.createElement(c["a"],{code:'vagrant@swarm-worker1:~$ docker container ls\nCONTAINER ID   IMAGE            COMMAND          CREATED      STATUS      PORTS     NAMES\ncac4be28ced7   busybox:latest   "ping 8.8.8.8"   2 days ago   Up 2 days             test.1.yf5uqm1kzx6dbt7n26e4akhsu\nvagrant@swarm-worker1:~$ docker container exec -it cac sh\n/ # ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    valid_lft forever preferred_lft forever\n24: eth0@if25: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1450 qdisc noqueue\n    link/ether 02:42:0a:00:01:08 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.1.8/24 brd 10.0.1.255 scope global eth0\n    valid_lft forever preferred_lft forever\n26: eth1@if27: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue\n    link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 172.18.0.3/16 brd 172.18.255.255 scope global eth1\n    valid_lft forever preferred_lft forever\n/ #',lang:"unknown"}),l.a.createElement("p",null,"\u8fd9\u4e2a\u5bb9\u5668\u6709\u4e24\u4e2a\u63a5\u53e3 eth0\u548ceth1\uff0c \u5176\u4e2deth0\u662f\u8fde\u5230\u4e86mynet\u8fd9\u4e2a\u7f51\u7edc\uff0ceth1\u662f\u8fde\u5230docker_gwbridge\u8fd9\u4e2a\u7f51\u7edc"),l.a.createElement(c["a"],{code:"vagrant@swarm-worker1:~$ docker network ls\nNETWORK ID     NAME              DRIVER    SCOPE\na631a4e0b63c   bridge            bridge    local\n56945463a582   docker_gwbridge   bridge    local\n9bdfcae84f94   host              host      local\n14fy2l7a4mci   ingress           overlay   swarm\nlpirdge00y3j   mynet             overlay   swarm\nc1837f1284f8   none              null      local",lang:"unknown"}),l.a.createElement("p",null,"\u5728\u8fd9\u4e2a\u5bb9\u5668\u91cc\u662f\u53ef\u4ee5\u76f4\u63a5ping\u901aworker2\u4e0a\u5bb9\u5668\u7684IP 10.0.1.9\u7684"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-035633.png",alt:"docker-swarm-overlay"})),l.a.createElement("h2",{id:"85-swarm-\u7684-ingress\u7f51\u7edc"},l.a.createElement(r["AnchorLink"],{to:"#85-swarm-\u7684-ingress\u7f51\u7edc","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.5 Swarm \u7684 ingress\u7f51\u7edc"),l.a.createElement("p",null,"docker swarm\u7684ingress\u7f51\u7edc\u53c8\u53eb ",l.a.createElement("code",null,"Ingress Routing Mesh")),l.a.createElement("p",null,"\u4e3b\u8981\u662f\u4e3a\u4e86\u5b9e\u73b0\u628aservice\u7684\u670d\u52a1\u7aef\u53e3\u5bf9\u5916\u53d1\u5e03\u51fa\u53bb\uff0c\u8ba9\u5176\u80fd\u591f\u88ab\u5916\u90e8\u7f51\u7edc\u8bbf\u95ee\u5230\u3002"),l.a.createElement("p",null,"ingress routing mesh\u662fdocker swarm\u7f51\u7edc\u91cc\u6700\u590d\u6742\u7684\u4e00\u90e8\u5206\u5185\u5bb9\uff0c\u5305\u62ec\u591a\u65b9\u9762\u7684\u5185\u5bb9\uff1a"),l.a.createElement("ul",null,l.a.createElement("li",null,"iptables\u7684 Destination NAT\u6d41\u91cf\u8f6c\u53d1"),l.a.createElement("li",null,"Linux bridge, network namespace"),l.a.createElement("li",null,"\u4f7f\u7528IPVS\u6280\u672f\u505a\u8d1f\u8f7d\u5747\u8861"),l.a.createElement("li",null,"\u5305\u62ec\u5bb9\u5668\u95f4\u7684\u901a\u4fe1\uff08overlay\uff09\u548c\u5165\u65b9\u5411\u6d41\u91cf\u7684\u7aef\u53e3\u8f6c\u53d1")),l.a.createElement("h3",{id:"service\u521b\u5efa"},l.a.createElement(r["AnchorLink"],{to:"#service\u521b\u5efa","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"service\u521b\u5efa"),l.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2aservice\uff0c\u6307\u5b9a\u7f51\u7edc\u662foverlay\u7684mynet\uff0c \u901a\u8fc7-p\u628a\u7aef\u53e3\u6620\u5c04\u51fa\u6765"),l.a.createElement("p",null,"\u6211\u4eec\u4f7f\u7528\u7684\u955c\u50cf ",l.a.createElement("code",null,"containous/whoami")," \u662f\u4e00\u4e2a\u7b80\u5355\u7684web\u670d\u52a1\uff0c\u80fd\u8fd4\u56de\u670d\u52a1\u5668\u7684hostname\uff0c\u548c\u57fa\u672c\u7684\u7f51\u7edc\u4fe1\u606f\uff0c\u6bd4\u5982IP\u5730\u5740"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker service create --name web --network mynet -p 8080:80 --replicas 2 containous/whoami\na9cn3p0ovg5jcz30rzz89lyfz\noverall progress: 2 out of 2 tasks\n1/2: running   [==================================================>]\n2/2: running   [==================================================>]\nverify: Service converged\nvagrant@swarm-manager:~$ docker service ls\nID             NAME      MODE         REPLICAS   IMAGE                      PORTS\na9cn3p0ovg5j   web       replicated   2/2        containous/whoami:latest   *:8080->80/tcp\nvagrant@swarm-manager:~$ docker service ps web\nID             NAME      IMAGE                      NODE            DESIRED STATE   CURRENT STATE            ERROR     PORTS\nudlzvsraha1x   web.1     containous/whoami:latest   swarm-worker1   Running         Running 16 seconds ago\nmms2c65e5ygt   web.2     containous/whoami:latest   swarm-manager   Running         Running 16 seconds ago\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("h3",{id:"service\u7684\u8bbf\u95ee"},l.a.createElement(r["AnchorLink"],{to:"#service\u7684\u8bbf\u95ee","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"service\u7684\u8bbf\u95ee"),l.a.createElement("p",null,"8080\u8fd9\u4e2a\u7aef\u53e3\u5230\u5e95\u6620\u5c04\u5230\u54ea\u91cc\u4e86\uff1f\u5c1d\u8bd5\u4e09\u4e2aswarm\u8282\u70b9\u7684IP\u52a0\u7aef\u53e38080"),l.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\u4e09\u4e2a\u8282\u70b9IP\u90fd\u53ef\u4ee5\u8bbf\u95ee\uff0c\u5e76\u4e14\u56de\u5e94\u7684\u5bb9\u5668\u662f\u4e0d\u540c\u7684\uff08hostname\uff09\uff0c\u4e5f\u5c31\u662f\u6709\u8d1f\u8f7d\u5747\u8861\u7684\u6548\u679c"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ curl 192.168.200.10:8080\nHostname: fdf7c1354507\nIP: 127.0.0.1\nIP: 10.0.0.7\nIP: 172.18.0.3\nIP: 10.0.1.14\nRemoteAddr: 10.0.0.2:36828\nGET / HTTP/1.1\nHost: 192.168.200.10:8080\nUser-Agent: curl/7.68.0\nAccept: */*\n\nvagrant@swarm-manager:~$ curl 192.168.200.11:8080\nHostname: fdf7c1354507\nIP: 127.0.0.1\nIP: 10.0.0.7\nIP: 172.18.0.3\nIP: 10.0.1.14\nRemoteAddr: 10.0.0.3:54212\nGET / HTTP/1.1\nHost: 192.168.200.11:8080\nUser-Agent: curl/7.68.0\nAccept: */*\n\nvagrant@swarm-manager:~$ curl 192.168.200.12:8080\nHostname: c83ee052787a\nIP: 127.0.0.1\nIP: 10.0.0.6\nIP: 172.18.0.3\nIP: 10.0.1.13\nRemoteAddr: 10.0.0.4:49820\nGET / HTTP/1.1\nHost: 192.168.200.12:8080\nUser-Agent: curl/7.68.0\nAccept: */*",lang:"unknown"}),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-041801.png",alt:"docker-swarm-ingress-logic"})),l.a.createElement("h3",{id:"ingress-\u6570\u636e\u5305\u7684\u8d70\u5411"},l.a.createElement(r["AnchorLink"],{to:"#ingress-\u6570\u636e\u5305\u7684\u8d70\u5411","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"ingress \u6570\u636e\u5305\u7684\u8d70\u5411"),l.a.createElement("p",null,"\u4ee5manager\u8282\u70b9\u4e3a\u4f8b\uff0c\u6570\u636e\u5230\u5e95\u662f\u5982\u4f55\u8fbe\u5230service\u7684container\u7684"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ sudo iptables -nvL -t nat\nChain PREROUTING (policy ACCEPT 388 packets, 35780 bytes)\npkts bytes target     prot opt in     out     source               destination\n296 17960 DOCKER-INGRESS  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL\n21365 1282K DOCKER     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL\n\nChain INPUT (policy ACCEPT 388 packets, 35780 bytes)\npkts bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 340 packets, 20930 bytes)\npkts bytes target     prot opt in     out     source               destination\n    8   590 DOCKER-INGRESS  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL\n    1    60 DOCKER     all  --  *      *       0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL\n\nChain POSTROUTING (policy ACCEPT 340 packets, 20930 bytes)\npkts bytes target     prot opt in     out     source               destination\n    2   120 MASQUERADE  all  --  *      docker_gwbridge  0.0.0.0/0            0.0.0.0/0            ADDRTYPE match src-type LOCAL\n    3   252 MASQUERADE  all  --  *      !docker0  172.17.0.0/16        0.0.0.0/0\n    0     0 MASQUERADE  all  --  *      !docker_gwbridge  172.18.0.0/16        0.0.0.0/0\n\nChain DOCKER (2 references)\npkts bytes target     prot opt in     out     source               destination\n    0     0 RETURN     all  --  docker0 *       0.0.0.0/0            0.0.0.0/0\n    0     0 RETURN     all  --  docker_gwbridge *       0.0.0.0/0            0.0.0.0/0\n\nChain DOCKER-INGRESS (2 references)\npkts bytes target     prot opt in     out     source               destination\n    2   120 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8080 to:172.18.0.2:8080\n302 18430 RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0",lang:"unknown"}),l.a.createElement("p",null,"\u901a\u8fc7iptables\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u6761DNAT\u7684\u89c4\u5219\uff0c\u6240\u6709\u8bbf\u95ee\u672c\u57308080\u7aef\u53e3\u7684\u6d41\u91cf\u90fd\u88ab\u8f6c\u53d1\u5230 172.18.0.2:8080"),l.a.createElement("p",null,"\u90a3\u8fd9\u4e2a172.18.0.2 \u662f\u4ec0\u4e48\uff1f"),l.a.createElement("p",null,"\u9996\u5148\u3000172.18.0.0/16\u3000\u8fd9\u4e2a\u7f51\u6bb5\u662f ",l.a.createElement("code",null,"docker_gwbridge")," \u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5730\u5740\u80af\u5b9a\u662f\u8fde\u5728\u4e86 ",l.a.createElement("code",null,"docker_gwbridge")," \u4e0a\u3002"),l.a.createElement("p",null,l.a.createElement("code",null,"docker network inspect docker_gwbridge")," \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u7f51\u7edc\u8fde\u63a5\u4e86\u4e00\u4e2a\u53eb\u3000",l.a.createElement("code",null,"ingress-sbox"),"\u3000\u7684\u5bb9\u5668\u3002\u5b83\u7684\u5730\u5740\u5c31\u662f\u3000172.18.0.2/16"),l.a.createElement("p",null,"\u8fd9\u4e2a\u3000",l.a.createElement("code",null,"ingress-sbox"),"\u3000\u5176\u5b9e\u5e76\u4e0d\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u800c\u662f\u4e00\u4e2a\u7f51\u7edc\u7684\u547d\u540d\u7a7a\u95f4\u3000network namespace,\u3000\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u5f0f\u8fdb\u5165\u5230\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$\u3000docker run -it --rm -v /var/run/docker/netns:/netns --privileged=true nicolaka/netshoot nsenter --net=/netns/ingress_sbox sh\n~ # ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n8: eth0@if9: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default\n    link/ether 02:42:0a:00:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.0.2/24 brd 10.0.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 10.0.0.5/32 scope global eth0\n       valid_lft forever preferred_lft forever\n10: eth1@if11: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth1\n       valid_lft forever preferred_lft forever",lang:"unknown"}),l.a.createElement("p",null,"\u901a\u8fc7\u67e5\u770b\u5730\u5740\uff0c\u53d1\u73b0\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u8fde\u63a5\u4e86\u4e24\u4e2a\u7f51\u7edc\uff0c\u4e00\u4e2aeth1\u662f\u8fde\u63a5\u4e86\u3000",l.a.createElement("code",null,"docker_gwbridge"),"\u3000\uff0c\u53e6\u5916\u4e00\u4e2aeth0\u8fde\u63a5\u4e86\u3000",l.a.createElement("code",null,"ingress")," \u8fd9\u4e2a\u7f51\u7edc\u3002"),l.a.createElement(c["a"],{code:"~ # ip route\ndefault via 172.18.0.1 dev eth1\n10.0.0.0/24 dev eth0 proto kernel scope link src 10.0.0.2\n172.18.0.0/16 dev eth1 proto kernel scope link src 172.18.0.2\n\n~ # iptables -nvL -t mangle\nChain PREROUTING (policy ACCEPT 22 packets, 2084 bytes)\n pkts bytes target     prot opt in     out     source               destination\n   12   806 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8080 MARK set 0x100\n\nChain INPUT (policy ACCEPT 14 packets, 1038 bytes)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 MARK       all  --  *      *       0.0.0.0/0            10.0.0.5             MARK set 0x100\n\nChain FORWARD (policy ACCEPT 8 packets, 1046 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 14 packets, 940 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain POSTROUTING (policy ACCEPT 22 packets, 1986 bytes)\n pkts bytes target     prot opt in     out     source               destination\n~ # ipvsadm\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nFWM  256 rr\n  -> 10.0.0.6:0                   Masq    1      0          0\n  -> 10.0.0.7:0                   Masq    1      0          0\n~ #",lang:"unknown"}),l.a.createElement("p",null,"\u901a\u8fc7ipvs\u505a\u4e86\u8d1f\u8f7d\u5747\u8861"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-041931.png",alt:"docker-swarm-routing-mesh"})),l.a.createElement("p",null,"\u5173\u4e8e\u8fd9\u91cc\u7684\u8d1f\u8f7d\u5747\u8861"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u8fd9\u662f\u4e00\u4e2astateless load balancing"),l.a.createElement("li",null,"\u8fd9\u662f\u4e09\u5c42\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u4e0d\u662f\u56db\u5c42\u7684 LB is at OSI Layer 3 (TCP), not Layer 4 (DNS)"),l.a.createElement("li",null,"\u4ee5\u4e0a\u4e24\u4e2a\u9650\u5236\u53ef\u4ee5\u901a\u8fc7Nginx\u6216\u8005HAProxy LB proxy\u89e3\u51b3 \uff08",l.a.createElement(r["Link"],{to:"https://docs.docker.com/engine/swarm/ingress/%EF%BC%89"},"https://docs.docker.com/engine/swarm/ingress/\uff09"))),l.a.createElement("h2",{id:"86-\u5185\u90e8\u8d1f\u8f7d\u5747\u8861\u548c-vip"},l.a.createElement(r["AnchorLink"],{to:"#86-\u5185\u90e8\u8d1f\u8f7d\u5747\u8861\u548c-vip","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.6 \u5185\u90e8\u8d1f\u8f7d\u5747\u8861\u548c VIP"),l.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2amynet\u7684overlay\u7f51\u7edc\uff0c\u521b\u5efa\u4e00\u4e2aservice"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker network ls\nNETWORK ID     NAME              DRIVER    SCOPE\nafc8f54c1d07   bridge            bridge    local\n128fd1cb0fae   docker_gwbridge   bridge    local\n0ea68b0d28b9   host              host      local\n14fy2l7a4mci   ingress           overlay   swarm\nlpirdge00y3j   mynet             overlay   swarm\na8edf1804fb6   none              null      local\nvagrant@swarm-manager:~$ docker service create --name web --network mynet --replicas 2 containous/whoami\njozc1x1c1zpyjl9b5j5abzm0g\noverall progress: 2 out of 2 tasks\n1/2: running   [==================================================>]\n2/2: running   [==================================================>]\nverify: Service converged\nvagrant@swarm-manager:~$ docker service ls\nID             NAME      MODE         REPLICAS   IMAGE                      PORTS\njozc1x1c1zpy   web       replicated   2/2        containous/whoami:latest\nvagrant@swarm-manager:~$ docker service ps web\nID             NAME      IMAGE                      NODE            DESIRED STATE   CURRENT STATE            ERROR     PORTS\npwi87g86kbxd   web.1     containous/whoami:latest   swarm-worker1   Running         Running 47 seconds ago\nxbri2akxy2e8   web.2     containous/whoami:latest   swarm-worker2   Running         Running 44 seconds ago\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2aclient"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker service create --name client --network mynet xiaopeng163/net-box:latest ping 8.8.8.8\nskbcdfvgidwafbm4nciq82env\noverall progress: 1 out of 1 tasks\n1/1: running   [==================================================>]\nverify: Service converged\nvagrant@swarm-manager:~$ docker service ls\nID             NAME      MODE         REPLICAS   IMAGE                        PORTS\nskbcdfvgidwa   client    replicated   1/1        xiaopeng163/net-box:latest\njozc1x1c1zpy   web       replicated   2/2        containous/whoami:latest\nvagrant@swarm-manager:~$ docker service ps client\nID             NAME       IMAGE                        NODE            DESIRED STATE   CURRENT STATE            ERROR     PORTS\nsg9b3dqrgru4   client.1   xiaopeng163/net-box:latest   swarm-manager   Running         Running 28 seconds ago\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("p",null,"\u5c1d\u8bd5\u8fdb\u5165client\u8fd9\u4e2a\u5bb9\u5668\uff0c\u53bbping web\u8fd9\u4e2aservice name\uff0c \u83b7\u53d6\u5230\u7684IP 10.0.1.30\uff0c\u79f0\u4e4b\u4e3aVIP\uff08\u865a\u62dfIP\uff09"),l.a.createElement(c["a"],{code:'vagrant@swarm-manager:~$ docker container ls\nCONTAINER ID   IMAGE                        COMMAND          CREATED          STATUS          PORTS     NAMES\n36dce35d56e8   xiaopeng163/net-box:latest   "ping 8.8.8.8"   19 minutes ago   Up 19 minutes             client.1.sg9b3dqrgru4f14k2tpxzg2ei\nvagrant@swarm-manager:~$ docker container exec -it 36dc sh\n/omd # curl web\nHostname: 6039865a1e5d\nIP: 127.0.0.1\nIP: 10.0.1.32\nIP: 172.18.0.3\nRemoteAddr: 10.0.1.37:40972\nGET / HTTP/1.1\nHost: web\nUser-Agent: curl/7.69.1\nAccept: */*\n\n/omd # curl web\nHostname: c3b3e99b9bb1\nIP: 127.0.0.1\nIP: 10.0.1.31\nIP: 172.18.0.3\nRemoteAddr: 10.0.1.37:40974\nGET / HTTP/1.1\nHost: web\nUser-Agent: curl/7.69.1\nAccept: */*\n\n/omd # curl web\nHostname: 6039865a1e5d\nIP: 127.0.0.1\nIP: 10.0.1.32\nIP: 172.18.0.3\nRemoteAddr: 10.0.1.37:40976\nGET / HTTP/1.1\nHost: web\nUser-Agent: curl/7.69.1\nAccept: */*\n\n/omd #\n/omd # ping web -c 2\nPING web (10.0.1.30): 56 data bytes\n64 bytes from 10.0.1.30: seq=0 ttl=64 time=0.044 ms\n64 bytes from 10.0.1.30: seq=1 ttl=64 time=0.071 ms\n\n--- web ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.044/0.057/0.071 ms\n/omd #',lang:"unknown"}),l.a.createElement("p",null,"\u8fd9\u4e2a\u865a\u62dfIP\u5728\u4e00\u4e2a\u7279\u6b8a\u7684\u7f51\u7edc\u547d\u4ee4\u7a7a\u95f4\u91cc\uff0c\u8fd9\u4e2a\u7a7a\u95f4\u8fde\u63a5\u5728\u6211\u4eec\u7684mynet\u8fd9\u4e2aoverlay\u7684\u7f51\u7edc\u4e0a"),l.a.createElement("p",null,"\u901a\u8fc7 docker network inspect mynet \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u53eblb-mynet"),l.a.createElement(c["a"],{code:'"Containers": {\n"36dce35d56e87d43d08c5b9a94678fe789659cb3b1a5c9ddccd7de4b26e8d588": {\n    "Name": "client.1.sg9b3dqrgru4f14k2tpxzg2ei",\n    "EndpointID": "e8972d0091afaaa091886799aca164b742ca93408377d9ee599bdf91188416c1",\n    "MacAddress": "02:42:0a:00:01:24",\n    "IPv4Address": "10.0.1.36/24",\n    "IPv6Address": ""\n},\n"lb-mynet": {\n    "Name": "mynet-endpoint",\n    "EndpointID": "e299d083b25a1942f6e0f7989436c3c3e8d79c7395a80dd50b7709825022bfac",\n    "MacAddress": "02:42:0a:00:01:25",\n    "IPv4Address": "10.0.1.37/24",\n    "IPv6Address": ""\n}',lang:"unknown"}),l.a.createElement("p",null,"\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u627e\u5230\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u7684\u540d\u5b57"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ sudo ls /var/run/docker/netns/\n1-14fy2l7a4m  1-lpirdge00y  dfb766d83076  ingress_sbox  lb_lpirdge00\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("p",null,"\u540d\u5b57\u53eb ",l.a.createElement("code",null,"lb_lpirdge00")),l.a.createElement("p",null,"\u901a\u8fc7nsenter\u8fdb\u5165\u5230\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u7684sh\u91cc\uff0c \u53ef\u4ee5\u770b\u5230\u521a\u624d\u7684VIP\u5730\u574010.0.1.30"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ sudo nsenter --net=/var/run/docker/netns/lb_lpirdge00 sh\n#\n# ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    valid_lft forever preferred_lft forever\n50: eth0@if51: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default\n    link/ether 02:42:0a:00:01:25 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.1.37/24 brd 10.0.1.255 scope global eth0\n    valid_lft forever preferred_lft forever\n    inet 10.0.1.30/32 scope global eth0\n    valid_lft forever preferred_lft forever\n    inet 10.0.1.35/32 scope global eth0\n    valid_lft forever preferred_lft forever\n#",lang:"unknown"}),l.a.createElement("p",null,"\u548cingress\u7f51\u7edc\u4e00\u6837\uff0c\u53ef\u4ee5\u67e5\u770biptables\uff0cipvs\u7684\u8d1f\u8f7d\u5747\u8861\uff0c \u57fa\u672c\u5c31\u53ef\u4ee5\u7406\u89e3\u8d1f\u8f7d\u5747\u8861\u662f\u600e\u4e48\u4e00\u56de\u4e8b\u4e86\u3002 Mark=0x106, \u4e5f\u5c31\u662f262\uff08\u5341\u8fdb\u5236\uff09\uff0c\u4f1a\u8f6e\u8be2\u628a\u8bf7\u6c42\u53d1\u7ed910.0.1.31 \u548c 10.0.1.32"),l.a.createElement(c["a"],{code:"# iptables -nvL -t mangle\nChain PREROUTING (policy ACCEPT 128 packets, 11198 bytes)\npkts bytes target     prot opt in     out     source               destination\n\nChain INPUT (policy ACCEPT 92 packets, 6743 bytes)\npkts bytes target     prot opt in     out     source               destination\n72  4995 MARK       all  --  *      *       0.0.0.0/0            10.0.1.30            MARK set 0x106\n    0     0 MARK       all  --  *      *       0.0.0.0/0            10.0.1.35            MARK set 0x107\n\nChain FORWARD (policy ACCEPT 36 packets, 4455 bytes)\npkts bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 101 packets, 7535 bytes)\npkts bytes target     prot opt in     out     source               destination\n\nChain POSTROUTING (policy ACCEPT 128 packets, 11198 bytes)\npkts bytes target     prot opt in     out     source               destination\n# ipvsadm\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n-> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nFWM  262 rr\n-> 10.0.1.31:0                  Masq    1      0          0\n-> 10.0.1.32:0                  Masq    1      0          0\nFWM  263 rr\n-> 10.0.1.36:0                  Masq    1      0          0\n#",lang:"unknown"}),l.a.createElement("p",null,"\u8fd9\u4e2a\u6d41\u91cf\u4f1a\u8d70\u6211\u4eec\u7684mynet\u8fd9\u4e2aoverlay\u7f51\u7edc\u3002"),l.a.createElement("h2",{id:"87-\u90e8\u7f72\u591a-service-\u5e94\u7528"},l.a.createElement(r["AnchorLink"],{to:"#87-\u90e8\u7f72\u591a-service-\u5e94\u7528","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.7 \u90e8\u7f72\u591a service \u5e94\u7528"),l.a.createElement("p",null,"\u5982\u4f55\u50cfdocker-compose\u4e00\u6837\u90e8\u7f72\u591a\u670d\u52a1\u5e94\u7528\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u5148\u770b\u624b\u52a8\u7684\u65b9\u5f0f"),l.a.createElement("p",null,"\u672c\u8282\u8bfe\u6240\u7528\u7684\u6e90\u7801\u6587\u4ef6 ",l.a.createElement(r["Link"],{to:"https://github.com/xiaopeng163/flask-redis"},"https://github.com/xiaopeng163/flask-redis")),l.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2amynet\u7684overlay\u7f51\u7edc"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker network ls\nNETWORK ID     NAME              DRIVER    SCOPE\nafc8f54c1d07   bridge            bridge    local\n128fd1cb0fae   docker_gwbridge   bridge    local\n0ea68b0d28b9   host              host      local\n14fy2l7a4mci   ingress           overlay   swarm\nlpirdge00y3j   mynet             overlay   swarm\na8edf1804fb6   none              null      local\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2aredis\u7684service"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker service create --network mynet --name redis redis:latest redis-server --requirepass ABC123\nqh3nfeth3wc7uoz9ozvzta5ea\noverall progress: 1 out of 1 tasks\n1/1: running   [==================================================>]\nverify: Service converged\nvagrant@swarm-manager:~$ docker servce ls\ndocker: 'servce' is not a docker command.\nSee 'docker --help'\nvagrant@swarm-manager:~$ docker service ls\nID             NAME      MODE         REPLICAS   IMAGE          PORTS\nqh3nfeth3wc7   redis     replicated   1/1        redis:latest\nvagrant@swarm-manager:~$ docker service ps redis\nID             NAME      IMAGE          NODE            DESIRED STATE   CURRENT STATE            ERROR     PORTS\n111cpkjn4a0k   redis.1   redis:latest   swarm-worker2   Running         Running 19 seconds ago\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2aflask\u7684service"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker service create --network mynet --name flask --env REDIS_HOST=redis --env REDIS_PASS=ABC123 -p 8080\n:5000 xiaopeng163/flask-redis:latest\ny7garhvlxah592j5lmqv8a3xj\noverall progress: 1 out of 1 tasks\n1/1: running   [==================================================>]\nverify: Service converged\nvagrant@swarm-manager:~$ docker service ls\nID             NAME      MODE         REPLICAS   IMAGE                            PORTS\ny7garhvlxah5   flask     replicated   1/1        xiaopeng163/flask-redis:latest   *:8080->5000/tcp\nqh3nfeth3wc7   redis     replicated   1/1        redis:latest\nvagrant@swarm-manager:~$ docker service ps flask\nID             NAME      IMAGE                            NODE            DESIRED STATE   CURRENT STATE            ERROR     PORTS\nquptcq7vb48w   flask.1   xiaopeng163/flask-redis:latest   swarm-worker1   Running         Running 15 seconds ago\nvagrant@swarm-manager:~$ curl 127.0.0.1:8080\nHello Container World! I have been seen 1 times and my hostname is d4de54036614.\nvagrant@swarm-manager:~$ curl 127.0.0.1:8080\nHello Container World! I have been seen 2 times and my hostname is d4de54036614.\nvagrant@swarm-manager:~$ curl 127.0.0.1:8080\nHello Container World! I have been seen 3 times and my hostname is d4de54036614.\nvagrant@swarm-manager:~$ curl 127.0.0.1:8080\nHello Container World! I have been seen 4 times and my hostname is d4de54036614.\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("h2",{id:"88-swarm-stack-\u90e8\u7f72\u591a-service-\u5e94\u7528"},l.a.createElement(r["AnchorLink"],{to:"#88-swarm-stack-\u90e8\u7f72\u591a-service-\u5e94\u7528","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.8 swarm stack \u90e8\u7f72\u591a service \u5e94\u7528"),l.a.createElement("p",null,"\u5148\u5728swarm manager\u8282\u70b9\u4e0a\u5b89\u88c5\u4e00\u4e0b docker-compose"),l.a.createElement(c["a"],{code:'vagrant@swarm-manager:~$ sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\nvagrant@swarm-manager:~$ sudo chmod +x /usr/local/bin/docker-compose',lang:"unknown"}),l.a.createElement("p",null,"clone\u6211\u4eec\u7684\u4ee3\u7801\u4ed3\u5e93"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ git clone https://github.com/xiaopeng163/flask-redis\nCloning into 'flask-redis'...\nremote: Enumerating objects: 22, done.\nremote: Counting objects: 100% (22/22), done.\nremote: Compressing objects: 100% (19/19), done.\nremote: Total 22 (delta 9), reused 7 (delta 2), pack-reused 0\nUnpacking objects: 100% (22/22), 8.60 KiB | 1.07 MiB/s, done.\nvagrant@swarm-manager:~$ cd flask-redis\nvagrant@swarm-manager:~/flask-redis$ ls\nDockerfile  LICENSE  README.md  app.py  docker-compose.yml\nvagrant@swarm-manager:~/flask-redis$",lang:"unknown"}),l.a.createElement("p",null,"\u73af\u5883\u6e05\u7406"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~/flask-redis$ docker system prune -a -f",lang:"unknown"}),l.a.createElement("p",null,"\u955c\u50cf\u6784\u5efa\u548c\u63d0\u4ea4\uff0c \u5982\u679c\u4f60\u60f3\u505a\u8fd9\u4e00\u6b65\uff0c\u53ef\u4ee5\u628adocker-compose.yml\u91cc\u7684 ",l.a.createElement("code",null,"xiaopeng163/flask-redis")," \u6539\u6210\u4f60\u7684dockerhub id"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~/flask-redis$ docker-compose build\nvagrant@swarm-manager:~/flask-redis$ docker image ls\nREPOSITORY                TAG          IMAGE ID       CREATED         SIZE\nxiaopeng163/flask-redis   latest       5efb4fcbcfc3   6 seconds ago   126MB\npython                    3.9.5-slim   c71955050276   3 weeks ago     115MB",lang:"unknown"}),l.a.createElement("p",null,"\u63d0\u4ea4\u955c\u50cf\u5230dockerhub"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~/flask-redis$ docker login\nLogin with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.\nUsername: xiaopeng163\nPassword:\nWARNING! Your password will be stored unencrypted in /home/vagrant/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\nvagrant@swarm-manager:~/flask-redis$ docker-compose push\nWARNING: The REDIS_PASSWORD variable is not set. Defaulting to a blank string.\nPushing flask (xiaopeng163/flask-redis:latest)...\nThe push refers to repository [docker.io/xiaopeng163/flask-redis]\nf447d33c161b: Pushed\nf7395da2fd9c: Pushed\n5b156295b5a3: Layer already exists\n115e0863702d: Layer already exists\ne10857b94a57: Layer already exists\n8d418cbfaf25: Layer already exists\n764055ebc9a7: Layer already exists\nlatest: digest: sha256:c909100fda2f4160b593b4e0fb692b89046cebb909ae90546627deca9827b676 size: 1788\nvagrant@swarm-manager:~/flask-redis$",lang:"unknown"}),l.a.createElement("p",null,"\u901a\u8fc7stack\u542f\u52a8\u670d\u52a1"),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~/flask-redis$ env REDIS_PASSWORD=ABC123 docker stack deploy --compose-file docker-compose.yml flask-demo\nIgnoring unsupported options: build\n\nCreating network flask-demo_default\nCreating service flask-demo_flask\nCreating service flask-demo_redis-server\nvagrant@swarm-manager:~/flask-redis$\nvagrant@swarm-manager:~/flask-redis$ docker stack ls\nNAME         SERVICES   ORCHESTRATOR\nflask-demo   2          Swarm\nvagrant@swarm-manager:~/flask-redis$ docker stack ps flask-demo\nID             NAME                        IMAGE                            NODE            DESIRED STATE   CURRENT STATE\nERROR     PORTS\nlzm6i9inoa8e   flask-demo_flask.1          xiaopeng163/flask-redis:latest   swarm-manager   Running         Running 23 seconds ago\n\nejojb0o5lbu0   flask-demo_redis-server.1   redis:latest                     swarm-worker2   Running         Running 21 seconds ago\n\nvagrant@swarm-manager:~/flask-redis$ docker stack services flask-demo\nID             NAME                      MODE         REPLICAS   IMAGE                            PORTS\nmpx75z1rrlwn   flask-demo_flask          replicated   1/1        xiaopeng163/flask-redis:latest   *:8080->5000/tcp\nz85n16zsldr1   flask-demo_redis-server   replicated   1/1        redis:latest\nvagrant@swarm-manager:~/flask-redis$ docker service ls\nID             NAME                      MODE         REPLICAS   IMAGE                            PORTS\nmpx75z1rrlwn   flask-demo_flask          replicated   1/1        xiaopeng163/flask-redis:latest   *:8080->5000/tcp\nz85n16zsldr1   flask-demo_redis-server   replicated   1/1        redis:latest\nvagrant@swarm-manager:~/flask-redis$ curl 127.0.0.1:8080\nHello Container World! I have been seen 1 times and my hostname is 21d63a8bfb57.\nvagrant@swarm-manager:~/flask-redis$ curl 127.0.0.1:8080\nHello Container World! I have been seen 2 times and my hostname is 21d63a8bfb57.\nvagrant@swarm-manager:~/flask-redis$ curl 127.0.0.1:8080\nHello Container World! I have been seen 3 times and my hostname is 21d63a8bfb57.\nvagrant@swarm-manager:~/flask-redis$",lang:"unknown"}),l.a.createElement("h2",{id:"89-\u5728-swarm-\u4e2d\u4f7f\u7528-secret"},l.a.createElement(r["AnchorLink"],{to:"#89-\u5728-swarm-\u4e2d\u4f7f\u7528-secret","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.9 \u5728 swarm \u4e2d\u4f7f\u7528 secret"),l.a.createElement("h3",{id:"\u521b\u5efasecret"},l.a.createElement(r["AnchorLink"],{to:"#\u521b\u5efasecret","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efasecret"),l.a.createElement("p",null,"\u6709\u4e24\u79cd\u65b9\u5f0f"),l.a.createElement("h4",{id:"\u4ece\u6807\u51c6\u7684\u6536\u5165\u8bfb\u53d6"},l.a.createElement(r["AnchorLink"],{to:"#\u4ece\u6807\u51c6\u7684\u6536\u5165\u8bfb\u53d6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u4ece\u6807\u51c6\u7684\u6536\u5165\u8bfb\u53d6"),l.a.createElement(c["a"],{code:'vagrant@swarm-manager:~$ echo abc123 | docker secret create mysql_pass -\n4nkx3vpdd41tbvl9qs24j7m6w\nvagrant@swarm-manager:~$ docker secret ls\nID                          NAME         DRIVER    CREATED         UPDATED\n4nkx3vpdd41tbvl9qs24j7m6w   mysql_pass             8 seconds ago   8 seconds ago\nvagrant@swarm-manager:~$ docker secret inspect mysql_pass\n[\n    {\n        "ID": "4nkx3vpdd41tbvl9qs24j7m6w",\n        "Version": {\n            "Index": 4562\n        },\n        "CreatedAt": "2021-07-25T22:36:51.544523646Z",\n        "UpdatedAt": "2021-07-25T22:36:51.544523646Z",\n        "Spec": {\n            "Name": "mysql_pass",\n            "Labels": {}\n        }\n    }\n]\nvagrant@swarm-manager:~$ docker secret rm mysql_pass\nmysql_pass\nvagrant@swarm-manager:~$',lang:"unknown"}),l.a.createElement("h4",{id:"\u4ece\u6587\u4ef6\u8bfb\u53d6"},l.a.createElement(r["AnchorLink"],{to:"#\u4ece\u6587\u4ef6\u8bfb\u53d6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u4ece\u6587\u4ef6\u8bfb\u53d6"),l.a.createElement(c["a"],{code:'vagrant@swarm-manager:~$ ls\nmysql_pass.txt\nvagrant@swarm-manager:~$ more mysql_pass.txt\nabc123\nvagrant@swarm-manager:~$ docker secret create mysql_pass mysql_pass.txt\nelsodoordd7zzpgsdlwgynq3f\nvagrant@swarm-manager:~$ docker secret inspect mysql_pass\n[\n    {\n        "ID": "elsodoordd7zzpgsdlwgynq3f",\n        "Version": {\n            "Index": 4564\n        },\n        "CreatedAt": "2021-07-25T22:38:14.143954043Z",\n        "UpdatedAt": "2021-07-25T22:38:14.143954043Z",\n        "Spec": {\n            "Name": "mysql_pass",\n            "Labels": {}\n        }\n    }\n]\nvagrant@swarm-manager:~$',lang:"unknown"}),l.a.createElement("h3",{id:"secret-\u7684\u4f7f\u7528"},l.a.createElement(r["AnchorLink"],{to:"#secret-\u7684\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"secret \u7684\u4f7f\u7528"),l.a.createElement("p",null,"\u53c2\u8003 ",l.a.createElement(r["Link"],{to:"https://hub.docker.com/_/mysql"},"https://hub.docker.com/_/mysql")),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ docker service create --name mysql-demo --secret mysql_pass --env MYSQL_ROOT_PASSWORD_FILE=/run/secrets/mysql_pass mysql:5.7\nwb4z2ximgqaefephu9f4109c7\noverall progress: 1 out of 1 tasks\n1/1: running   [==================================================>]\nverify: Service converged\nvagrant@swarm-manager:~$ docker service ls\nID             NAME         MODE         REPLICAS   IMAGE       PORTS\nwb4z2ximgqae   mysql-demo   replicated   1/1        mysql:5.7\nvagrant@swarm-manager:~$ docker service ps mysql-demo\nID             NAME           IMAGE       NODE            DESIRED STATE   CURRENT STATE            ERROR     PORTS\n909429p4uovy   mysql-demo.1   mysql:5.7   swarm-worker2   Running         Running 32 seconds ago\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("h2",{id:"810-swarm-\u4f7f\u7528-local-volume"},l.a.createElement(r["AnchorLink"],{to:"#810-swarm-\u4f7f\u7528-local-volume","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.10 swarm \u4f7f\u7528 local volume"),l.a.createElement("p",null,"\u672c\u8282\u6e90\u7801\uff0c\u4e24\u4e2a\u6587\u4ef6"),l.a.createElement(c["a"],{code:"docker-compose.yml",lang:"unknown"}),l.a.createElement(c["a"],{code:'version: "3.8"\n\nservices:\n  db:\n    image: mysql:5.7\n    environment:\n      - MYSQL_ROOT_PASSWORD_FILE=/run/secrets/mysql_pass\n    secrets:\n      - mysql_pass\n    volumes:\n      - data:/var/lib/mysql\n\nvolumes:\n  data:\n\nsecrets:\n  mysql_pass:\n    file: mysql_pass.txt',lang:"unknown"}),l.a.createElement("p",null,l.a.createElement("code",null,"mysql_pass.txt")),l.a.createElement(c["a"],{code:"vagrant@swarm-manager:~$ more mysql_pass.txt\nabc123\nvagrant@swarm-manager:~$",lang:"unknown"}),l.a.createElement("h1",{id:"9-docker-vs-podman"},l.a.createElement(r["AnchorLink"],{to:"#9-docker-vs-podman","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9 Docker vs Podman"),l.a.createElement("h2",{id:"91-podman-\u4ecb\u7ecd"},l.a.createElement(r["AnchorLink"],{to:"#91-podman-\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9.1 Podman \u4ecb\u7ecd"),l.a.createElement("h3",{id:"what-is-podman"},l.a.createElement(r["AnchorLink"],{to:"#what-is-podman","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"What is Podman?"),l.a.createElement("p",null,l.a.createElement("code",null,"Podman")," \u662f\u4e00\u4e2a\u57fa\u4e8e ",l.a.createElement("code",null,"Linux")," \u7cfb\u7edf\u7684 ",l.a.createElement("code",null,"daemon-less")," \u7684\u5bb9\u5668\u5f15\u64ce\u3002 \u53ef\u4ee5\u7528\u6765\u5f00\u53d1\uff0c\u7ba1\u7406\u548c\u8fd0\u884c ",l.a.createElement("code",null,"OCI")," \u6807\u51c6\u7684\u5bb9\u5668. podman\u53ef\u4ee5\u8fd0\u884c\u5728root\u6216\u8005\u975eroot\u7528\u6237\u6a21\u5f0f\u3002"),l.a.createElement("p",null,"Podman \u662f Red Hat \u57282018\u5e74\u63a8\u51fa\u7684\uff0c\u6e90\u4ee3\u7801\u5f00\u653e\u3002"),l.a.createElement("p",null,"\u5b98\u65b9\u7f51\u7ad9 ",l.a.createElement(r["Link"],{to:"https://podman.io/"},"https://podman.io/")),l.a.createElement("p",null,"OCI ",l.a.createElement(r["Link"],{to:"https://opencontainers.org/"},"https://opencontainers.org/")),l.a.createElement("h2",{id:"92-\u548c-docker-\u7684\u533a\u522b"},l.a.createElement(r["AnchorLink"],{to:"#92-\u548c-docker-\u7684\u533a\u522b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9.2 \u548c docker \u7684\u533a\u522b"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u6700\u4e3b\u8981\u7684\u533a\u522b\u662fpodman\u662fDaemonless\u7684\uff0c\u800cDocker\u5728\u6267\u884c\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u4f9d\u8d56\u4e8e\u540e\u53f0\u7684docker daemon"),l.a.createElement("li",null,"podman\u4e0d\u9700\u8981\u4f7f\u7528root\u7528\u6237\u6216\u8005root\u6743\u9650\uff0c\u6240\u4ee5\u66f4\u5b89\u5168\u3002"),l.a.createElement("li",null,"podman\u53ef\u4ee5\u521b\u5efapod\uff0cpod\u7684\u6982\u5ff5\u548cKubernetes \u91cc\u5b9a\u4e49\u7684pod\u7c7b\u4f3c"),l.a.createElement("li",null,"podman\u8fd0\u884c\u628a\u955c\u50cf\u548c\u5bb9\u5668\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u5730\u65b9\uff0c\u4f46\u662fdocker\u5fc5\u987b\u5b58\u50a8\u5728docker engineer\u6240\u5728\u7684\u672c\u5730"),l.a.createElement("li",null,"podman\u662f\u4f20\u7edf\u7684fork-exec \u6a21\u5f0f\uff0c\u800cdocker\u662f client-server \u67b6\u6784")),l.a.createElement("p",null,"Docker\u67b6\u6784"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-064321.png",alt:"podman-vs-docker-1"})),l.a.createElement("p",null,"Podman\u67b6\u6784"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-064440.png",alt:"podman-vs-docker-2"})),l.a.createElement("h2",{id:"92-podman-\u5b89\u88c5"},l.a.createElement(r["AnchorLink"],{to:"#92-podman-\u5b89\u88c5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9.2 Podman \u5b89\u88c5"),l.a.createElement("p",null,"\u6587\u6863"),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"https://podman.io/getting-started/installation"},"https://podman.io/getting-started/installation")),l.a.createElement("h2",{id:"93-podman-\u521b\u5efa-pod"},l.a.createElement(r["AnchorLink"],{to:"#93-podman-\u521b\u5efa-pod","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9.3 Podman \u521b\u5efa Pod"),l.a.createElement("h2",{id:"94-docker-\u7684\u975e-root-\u6a21\u5f0f"},l.a.createElement(r["AnchorLink"],{to:"#94-docker-\u7684\u975e-root-\u6a21\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9.4 Docker \u7684\u975e root \u6a21\u5f0f"),l.a.createElement("p",null,"\u6587\u6863 ",l.a.createElement(r["Link"],{to:"https://docs.docker.com/engine/security/rootless/"},"https://docs.docker.com/engine/security/rootless/")),l.a.createElement("p",null,"rootless\u5728\u4f7f\u7528\u4e4b\u524d\u9700\u8981"),l.a.createElement(c["a"],{code:"$ export DOCKER_HOST=unix:///run/user/1000/docker.sock",lang:"shell"}),l.a.createElement("h1",{id:"10-docker\u7684\u591a\u67b6\u6784\u652f\u6301"},l.a.createElement(r["AnchorLink"],{to:"#10-docker\u7684\u591a\u67b6\u6784\u652f\u6301","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"10 Docker\u7684\u591a\u67b6\u6784\u652f\u6301"),l.a.createElement("h2",{id:"101-docker\u7684\u591a\u67b6\u6784\u652f\u6301"},l.a.createElement(r["AnchorLink"],{to:"#101-docker\u7684\u591a\u67b6\u6784\u652f\u6301","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"10.1 Docker\u7684\u591a\u67b6\u6784\u652f\u6301"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-072238.png",alt:"docker-arch-intro"})),l.a.createElement("p",null,"\u955c\u50cf"),l.a.createElement("p",null,l.a.createElement("img",{src:"http://wuxiao-tech-doc.oss-cn-hangzhou.aliyuncs.com/2021-12-26-072317.png",alt:"image-arch"})),l.a.createElement("h2",{id:"102-\u4f7f\u7528-buildx-\u6784\u5efa\u591a\u67b6\u6784\u955c\u50cf"},l.a.createElement(r["AnchorLink"],{to:"#102-\u4f7f\u7528-buildx-\u6784\u5efa\u591a\u67b6\u6784\u955c\u50cf","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"10.2 \u4f7f\u7528 buildx \u6784\u5efa\u591a\u67b6\u6784\u955c\u50cf"),l.a.createElement("p",null,"Windows\u548cMac\u7684\u684c\u9762\u7248Docker\u81ea\u5e26buildx\u547d\u4ee4\uff0c\u4f46\u662fLinux\u73af\u5883\u4e0b\u7684Docker\u9700\u8981\u81ea\u884c\u5b89\u88c5buildx \uff08",l.a.createElement(r["Link"],{to:"https://github.com/docker/buildx%EF%BC%89"},"https://github.com/docker/buildx\uff09")),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"https://docs.docker.com/buildx/working-with-buildx/"},"https://docs.docker.com/buildx/working-with-buildx/")),l.a.createElement("p",null,"\u672c\u8282\u8bfe\u4f7f\u7528\u7684\u6e90\u7801 ",l.a.createElement(r["Link"],{to:"https://github.com/xiaopeng163/flask-redis"},"https://github.com/xiaopeng163/flask-redis")),l.a.createElement("p",null,"\u767b\u5f55dockerhub"),l.a.createElement(c["a"],{code:"docker login",lang:"unknown"}),l.a.createElement("p",null,"\u8fdb\u5165\u6e90\u7801\u76ee\u5f55\uff08Dockerfile\u6240\u5728\u76ee\u5f55\uff09"),l.a.createElement(c["a"],{code:"git clone https://github.com/xiaopeng163/flask-redis\ncd flask-redis",lang:"unknown"}),l.a.createElement("p",null,"\u6784\u5efa"),l.a.createElement(c["a"],{code:'PS C:\\Users\\Peng Xiao\\flask-redis> docker login\nAuthenticating with existing credentials...\nLogin Succeeded\nPS C:\\Users\\Peng Xiao\\flask-redis> docker buildx build --push --platform linux/arm/v7,linux/arm64/v8,linux/amd64 -t xiaopeng163/flask-redis:latest .\n[+] Building 0.0s (0/0)\nerror: multiple platforms feature is currently not supported for docker driver. Please switch to a different driver (eg. "docker buildx create --use")\nPS C:\\Users\\Peng Xiao\\flask-redis>\nPS C:\\Users\\Peng Xiao\\flask-redis> docker buildx ls\nNAME/NODE       DRIVER/ENDPOINT STATUS  PLATFORMS\ndesktop-linux   docker\ndesktop-linux desktop-linux   running linux/amd64, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6\ndefault *       docker\ndefault       default         running linux/amd64, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6\nPS C:\\Users\\Peng Xiao\\flask-redis> docker buildx create --name mybuilder --use\nmybuilder\nPS C:\\Users\\Peng Xiao\\flask-redis> docker buildx ls\nNAME/NODE       DRIVER/ENDPOINT                STATUS   PLATFORMS\nmybuilder *     docker-container\nmybuilder0    npipe:////./pipe/docker_engine inactive\ndesktop-linux   docker\ndesktop-linux desktop-linux                  running  linux/amd64, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6\ndefault         docker\ndefault       default                        running  linux/amd64, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6\nPS C:\\Users\\Peng Xiao\\flask-redis> docker buildx build --push --platform linux/arm/v7,linux/arm64/v8,linux/amd64 -t xiaopeng163/flask-redis:latest .',lang:"unknown"})))}));n["default"]=e=>{var n=l.a.useContext(r["context"]),a=n.demos;return l.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.a.createElement(i,{demos:a})}}}]);